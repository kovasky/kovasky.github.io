[{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAlways on the lookout to decrease writes on my consumer SSDs, I stumbled upon the idea of a ramdisk for Plex transcodes. In theory it should offer a performance boost, but in practice I did not really notice any improvements besides lowering SSD writes.\u003c/p\u003e\n\u003ch2 id=\"editing-fstab\"\u003eEditing fstab\u003c/h2\u003e\n\u003cp\u003eNavigate to /etc/fstab and open it for edition. You should see your boot disk and any other mapped media there. Add the following line:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etmpfs /dev/shm tmpfs defaults,noexec,nosuid,size\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;SIZE IN GB\u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe size can be as much as half of your total available RAM. Also, you can technically mount it in any directory, just make sure it exists beforehand. After editing your fstab, you can just issue the command mount -a using a privileged user and the ramdisk will be mounted.\u003c/p\u003e\n\u003ch2 id=\"editing-the-plex-server-config\"\u003eEditing the Plex server config\u003c/h2\u003e\n\u003cp\u003eNavigate to the plex server settings -\u0026gt; transcoder, and under the temporary directory, write the location of your ram disk, e.g. /dev/shm.\u003c/p\u003e\n\u003cp\u003eIt should look like the featured image.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eThe next transcoder playback should utilize the ram disk and avoid unnecesary disk writes!\u003c/p\u003e\n","description":"Set up a ramdisk for Plex to decrease SSD writes.","image":"/images/blogs/plex_ramdisk.webp","permalink":"https://kovasky.me/blogs/plex_ramdisk/","title":"Set up a ramdisk for Plex"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI recently acquired a Dell Poweredge T440, and after installing a GPU the fans skyrocketed. This turned the server into a noise machine. To solve this, I created a script that disables third-party PCI mode and based on a threshold, set the fan speed to 20% or to be controlled by Dell\u0026rsquo;s fan profile. These are the steps I took to make my T440 silent again.\u003c/p\u003e\n\u003ch2 id=\"downgrading-idrac-9-firmware-to-3303030\"\u003eDowngrading iDRAC 9 firmware to 3.30.30.30\u003c/h2\u003e\n\u003cp\u003eFor this whole setup to work, iDRAC needs to be on firmware 3.30.30.30, as later firmware revisions remove the ability to control the fan speed. The firmware can be downloaded from \u003ca href=\"https://www.dell.com/support/home/en-us\"\u003eDell\u0026rsquo;s website\u003c/a\u003e. To downgrade, navigate to your iDRAC\u0026rsquo;s web admin page, and under Maintenance-\u0026gt;System Update you can apply the downgrade. After the downgrade, make sure IPMI over LAN is enabled under iDRAC Settings-\u0026gt;Connectivity-\u0026gt;Network-\u0026gt;IPMI Settings.\u003c/p\u003e\n\u003ch2 id=\"script-to-control-the-fan-speed\"\u003eScript to control the fan speed\u003c/h2\u003e\n\u003cp\u003eOnce iDRAC is on firmware 3.30.30.30 and you can use IPMI over LAN, you can start using my script to control the fan speed. My script first checks that a VM has been up for 60 seconds. I added this check as PfSense is virtualized in my lab and as such needs to wait for it to be up to issue LAN commands. You can remove this check and the script will work as intended. Before running, make sure to fill in the blanks.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echeck_start_time\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local start_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local current_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003edate +%s\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local time_diff\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$((\u003c/span\u003ecurrent_time \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e start_time\u003cspan style=\"color:#66d9ef\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e $time_diff -ge \u003cspan style=\"color:#ae81ff\"\u003e60\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        echo \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        echo \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echeck_temperature\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    temp_lines\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e sdr type temperature 2\u0026gt;/dev/null | grep -e degrees | awk \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{print $(NF-2)}\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    temp_arr\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    readarray -t temp_arr \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$temp_lines\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sorted_temps\u003cspan style=\"color:#f92672\"\u003e=(\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eprintf \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%s\\n\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003etemp_arr[@]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e | sort -nr\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    max_temp\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003esorted_temps[0]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$max_temp\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -le \u003cspan style=\"color:#ae81ff\"\u003e60\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# enable manual fan control\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x01 0x00 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set initial fan to 20%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x02 0xff 0x14 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        CURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$max_temp\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -le \u003cspan style=\"color:#ae81ff\"\u003e65\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL2\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# enable manual fan control\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x01 0x00 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set initial fan to 30%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x02 0xff 0x1e \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set low_to_high used to determine wait time\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        CURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL2\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$max_temp\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -gt \u003cspan style=\"color:#ae81ff\"\u003e65\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;AUTO\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# enable Dell fan control\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x01 0x01 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set low_to_high used to determine wait time\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL2\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        CURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;AUTO\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edisable_third_party_mode \u003cspan style=\"color:#f92672\"\u003e(){\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# disable 3rd party pcie fan mode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    output\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003esshpass -p \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e ssh -o StrictHostKeyChecking\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eno \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e@\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;racadm get system.pcieslotlfm\u0026#34;\u003c/span\u003e 2\u0026gt;/dev/null\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    pcie_ports_count\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$output\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e | grep -c \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;System.pcieslotlfm\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Iterate through each PCIe port and disable third party mode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e((\u003c/span\u003ei\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e1; i\u0026lt;\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epcie_ports_count; i++\u003cspan style=\"color:#f92672\"\u003e))\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sshpass -p \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e ssh -o StrictHostKeyChecking\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eno \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e@\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;racadm set system.pcieslotlfm.\u003c/span\u003e$i\u003cspan style=\"color:#e6db74\"\u003e.lfmmode disabled\u0026#34;\u003c/span\u003e \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHOST\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUSER\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePASS\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVMID\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003estart_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eps -o lstart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e -p \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003ecat /var/run/qemu-server/$VMID.pid\u003cspan style=\"color:#66d9ef\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003estart_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003edate -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$start_time\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e +%s\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003echeck_start_time \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$start_time\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e -eq \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sleep \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edisable_third_party_mode\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e true; \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    check_temperature\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;AUTO\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$LOW_TO_HIGH\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e true\u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sleep \u003cspan style=\"color:#ae81ff\"\u003e180\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sleep \u003cspan style=\"color:#ae81ff\"\u003e60\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"automating-the-launching-of-the-script\"\u003eAutomating the launching of the script\u003c/h2\u003e\n\u003cp\u003eInstead of manually running this every time my server reboots, I created a service. To do so, I used the following service file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eUnit\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDescription\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eUser defined temperature fan control \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e iDrac \u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eService\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eType\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esimple\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/usr/local/sbin/fan_control.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRestart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ealways\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eInstall\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWantedBy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003emulti-user.target\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOn my Proxmox install, the bash script is placed at /usr/local/sbin/fan_control.sh with the appropriate permissions and the service file is at /etc/systemd/system. After these files are created, it takes a \u0026ldquo;systemctl daemon-reload\u0026rdquo; and then a \u0026ldquo;systemctl enable fan_control\u0026rdquo; to start the service and make sure it starts every reboot.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce everything is set up, your Dell server with iDRAC 9 should be extremely quiet.\u003c/p\u003e\n","description":"iDRAC 9 manual fan control on Dell PowerEdge servers","image":"/images/blogs/idrac.webp","permalink":"https://kovasky.me/blogs/fan_control/","title":"iDRAC 9 manual fan control on Dell PowerEdge servers"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIt has always been recommended to give ZFS full disk control, so after placing my raid card in HBA mode, I went ahead and gave full disk control to my TrueNAS vm.\u003c/p\u003e\n\u003ch2 id=\"figuring-out-the-id-of-the-disk\"\u003eFiguring out the id of the disk\u003c/h2\u003e\n\u003cp\u003eTypically, disks are labeled as /dev/sdX, but this can change when adding other drives or moving them around. To circumvent this, it is better to figure out the specific id of the disk to be passed through. To do this, execute the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elshw -class disk -class storage\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWrite down the serial and then issue the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003els /dev/disk/by-id/ | grep \u0026lt;serial\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWrite this down, as it will be needed for the passthrough.\u003c/p\u003e\n\u003ch2 id=\"map-the-drive-to-the-vm\"\u003eMap the drive to the vm\u003c/h2\u003e\n\u003cp\u003eAfter you\u0026rsquo;ve found the id of the disk, you can issue the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eqm set \u0026lt;vm_id\u0026gt; -scsi\u0026lt;disk_number\u0026gt; /dev/disk/by-id/\u0026lt;disk_id\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNavigate to /etc/pve/qemu-server. Locate your vm configuration by vm id and open the file for edition.\u003c/p\u003e\n\u003cp\u003eIt should look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003escsi\u0026lt;disk_number\u0026gt;: /dev/disk/by-id/\u0026lt;disk_id\u0026gt;,size\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;disk_size\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf left untouched and multiple disks are passed through, TrueNAS will complain about duplicate serials. To fix this, you have to add the serial option. It should now look like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003escsi\u0026lt;disk_number\u0026gt;: /dev/disk/by-id/\u0026lt;disk_id\u0026gt;,serial\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;serial\u0026gt;,size\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;disk_size\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will now passthrough the disk with a unique serial.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eReboot the vm and the disk should appear.\u003c/p\u003e\n","description":"Disk passthrough for vms in Proxmox.","image":"/images/blogs/truenas_disk.webp","permalink":"https://kovasky.me/blogs/disk_passthrough/","title":"Disk passthrough for vms in Proxmox"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter setting up the AD trust, every time I logged in the shell defaulted to /bin/sh. To change it to /bin/bash or any other shell of your choice you can do the following.\u003c/p\u003e\n\u003ch2 id=\"editing-sssdconf\"\u003eEditing SSSD.conf\u003c/h2\u003e\n\u003cp\u003eNavigate to /etc/sssd/ and open sssd.conf in an elevated text editor. It should look something like\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com/win.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter each domain, add your override shell. Something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eoverride_shell \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com/win.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eoverride_shell \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"restart-sssd-service\"\u003eRestart SSSD service\u003c/h2\u003e\n\u003cp\u003eAfter the modification has taken place, just restart the service with the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl restart sssd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou\u0026rsquo;re done! Next time you log in with your domain credentials, your default shell will be overriden.\u003c/p\u003e\n","description":"Replace the default shell for domain users on Linux in favour of bash.","image":"/images/blogs/no_domain_login.webp","permalink":"https://kovasky.me/blogs/login_shell/","title":"Replace the default shell for domain users on Linux"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eTo better protect my web accessible services, I decided to use Fail2Ban in conjunction with Cloudflare\u0026rsquo;s WAF to block IPs with more than 3 failed login attempts. I already leverage Cloudflare\u0026rsquo;s CDN and geo-blocking capabilities on my homelab, so I opted to utilize their WAF to block access to potential attackers.\u003c/p\u003e\n\u003cp\u003eOn the free tier, the WAF is limited to 5 rules, which can easily reach their limit. A workaround is to create a rule that uses a blocklist and then with the Lists API, update it as required.\u003c/p\u003e\n\u003ch2 id=\"creating-an-api-key\"\u003eCreating an API key\u003c/h2\u003e\n\u003cp\u003eLog in to Cloudflare and navigate to My Profile -\u0026gt; API Tokens-\u0026gt; Create a Token-\u0026gt; Create a Custom Token. Give your token a name and make sure the permissions are as follows:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blogs/cloudflare_token.webp\" alt=\"cloudflare token\"\u003e\u003c/p\u003e\n\u003cp\u003eKeep this token handy as it will be used later.\u003c/p\u003e\n\u003ch2 id=\"creating-a-list\"\u003eCreating a list\u003c/h2\u003e\n\u003cp\u003eLog in to Cloudflare, navigate to Manage Account -\u0026gt; Configurations -\u0026gt; Lists. Under Lists, create a new list with type IP and name it \u0026ldquo;block_list.\u0026rdquo; It should look something like:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blogs/cloudflare_list.webp\" alt=\"block_list\"\u003e\u003c/p\u003e\n\u003cp\u003eMake sure to write down your user id plus the id of this list. You can get it by clicking edit and taking a look at the url. It should look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ehttps://dash.cloudflare.com/\u0026lt;user id\u0026gt;/configurations/lists/\u0026lt;list id\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"modifying-the-list\"\u003eModifying the list\u003c/h2\u003e\n\u003cp\u003eTo modify the list, I made a small python script which uses some of the details that were recorded before.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/python3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eCalled by entryPoint.py, performs the addition or deletion of an item in a Cloudflare custom list.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eSupport for IPV6 is limited as it blocks the entire /64 subnet.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e requests\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e requests \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e json\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e ipaddress\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetIPList\u003c/span\u003e(apiEndpoint : str, headers : dict) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e json:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estatus_code \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejson()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Failed to fetch existing IP list. Status code: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eresponse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estatus_code\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etext)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexit(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaddIPtoList\u003c/span\u003e(ipAddr : str, apiEndpoint : str, headers : dict) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e Response:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e: ipAddr}]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epost(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders, data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eremoveIPFromList\u003c/span\u003e(ipId : str, apiEndpoint : str, headers : dict) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e Response:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;items\u0026#34;\u003c/span\u003e: [{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: ipId}]}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edelete(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders, data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__main__\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Usage: ./modifyBanList.py \u0026lt;ip\u0026gt; \u0026lt;add|del\u0026gt;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexit(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ipAddr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        addr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ipaddress\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eIPv6Address(ipAddr)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        first_64_bits \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e str(addr\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexploded)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e)[:\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipAddr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(first_64_bits) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;::/64\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003epass\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    action \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    listId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    accountId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    email \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    apiKey \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    apiEndpoint \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://api.cloudflare.com/client/v4/accounts/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eaccountId\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/rules/lists/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003elistId\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/items\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    headers \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;X-Auth-Email\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eemail\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;X-Auth-Key\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eapiKey\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Content-Type\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;application/json\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    existingIpList \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e getIPList(apiEndpoint,headers)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(existingIpList)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e action \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;del\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e existingIpList[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;result\u0026#39;\u003c/span\u003e]:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e item[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ip\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e ipAddr:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                ipId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e item[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;items\u0026#34;\u003c/span\u003e: [{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: ipId}]}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e ipId \u003cspan style=\"color:#f92672\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edelete(apiEndpoint,headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders,data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e any(item[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ip\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e ipAddr \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e existingIpList[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;result\u0026#39;\u003c/span\u003e]):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e: ipAddr\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epost(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders, data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e response \u003cspan style=\"color:#f92672\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estatus_code \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;IP address \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eipAddr\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eaction\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e to the custom IP list successfully.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Failed to \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eaction\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e IP address \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eipAddr\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e to the custom IP list.\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis should add or remove any desired IP from the block list.\u003c/p\u003e\n\u003ch2 id=\"entry-point\"\u003eEntry Point\u003c/h2\u003e\n\u003cp\u003eMy Fail2Ban instance is a container which luckily enough has python. To make sure the script has all required dependencies, I made an entrypoint which then calls the previous script.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/python3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eCreates a virtual environment, installs dependencies, and then calls modifyBanList.py\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e os\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Usage: ./entryPoint.py \u0026lt;ip\u0026gt; \u0026lt;add|del\u0026gt;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexit(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evenv_dir \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;env\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexists(venv_dir):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esystem(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexecutable\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e -m venv \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003evenv_dir\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esystem(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(venv_dir, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bin\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;pip\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e install --upgrade requests ipaddress\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esystem(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(venv_dir, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bin\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;python\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e /data/action.d/modifyBanList.py \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"cloudflareconf\"\u003eCloudflare.conf\u003c/h2\u003e\n\u003cp\u003eTo glue all of it together, a conf file will tell Fail2Ban how to call the script when a ban or unban action needs to take place.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eDefinition\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionban \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /data/action.d/entryPoint.py \u0026lt;ip\u0026gt; add\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionunban \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /data/action.d/entryPoint.py \u0026lt;ip\u0026gt; del\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"jaild\"\u003eJail.d\u003c/h2\u003e\n\u003cp\u003eIn my config, I am directly using the jail.local and it looks something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eDEFAULT\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaction \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e cloudflare\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eSome next steps are to configure a filter, add it to the jail, and later use a VPN to generate some unsuccesful events. Once the ban takes place, it may take a few seconds to propapage on Cloudflare.\u003c/p\u003e\n\u003cp\u003eYou can take a look at these scripts \u003ca href=\"https://git.agrajag.cloud/kova/homelabscripts\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n","description":"Using Fail2Ban with Cloudflare on a free account to block IPs","image":"/images/blogs/cloudflare_fail2ban_logs.webp","permalink":"https://kovasky.me/blogs/cloudflare_fail2ban/","title":"Using Fail2Ban with Cloudflare on a free account"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter creating my domain trust between AD and FreeIPA, I was left wanting to access restricted resources in Linux using my AD accounts. To circumvent this, I mapped a group from AD to FreeIPA and gave it the appropriate permissions.\u003c/p\u003e\n\u003ch2 id=\"create-the-group-in-ad\"\u003eCreate the group in AD\u003c/h2\u003e\n\u003cp\u003eThe first step would be to create a group in AD to which sudo will be mapped. In my case, I created a group named \u0026lsquo;sudo\u0026rsquo; to match the Linux counterpart. To do this, navigate to Server Manager -\u0026gt; Active Directory Users and Computers -\u0026gt; Users. Then, right-click and go to New -\u0026gt; Group. In the name, type \u0026lsquo;sudo\u0026rsquo;. After the item is created, it should look like:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blogs/sudo_group.webp\" alt=\"sudo group in AD\"\u003e\u003c/p\u003e\n\u003ch2 id=\"create-policies\"\u003eCreate policies\u003c/h2\u003e\n\u003cp\u003eNavigate to Policy -\u0026gt; Sudo -\u0026gt; Sudo Rules. Here, you can create a new rule or directly use the \u0026lsquo;All\u0026rsquo; rule. In my case, I created a rule titled \u0026lsquo;sudorule\u0026rsquo;.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blogs/ad_sudo_rule.webp\" alt=\"sudorule in FreeIPA\"\u003e\u003c/p\u003e\n\u003cp\u003eTo allow commands, navigate to \u0026lsquo;Run Commands\u0026rsquo; and click \u0026lsquo;Any Command\u0026rsquo;. This will essentially make users root (very dangerous). It should look something like:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blogs/allow_any_command.webp\" alt=\"allow any command\"\u003e\u003c/p\u003e\n\u003ch2 id=\"add-the-external-group-to-the-sudo-rule\"\u003eAdd the external group to the sudo rule\u003c/h2\u003e\n\u003cp\u003eConnect to your FreeIPA server as an admin. Then issue the command\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eipa sudorule-add-user sudorule --groups \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;sudo@win.mydomain.com\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will map the external AD group to the sudo rule you just created. Navigate to the FreeIPA web interface under Policy -\u0026gt; Sudo -\u0026gt; Sudo Rules -\u0026gt; sudorule and It should look like:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blogs/external_group_sudorule.webp\" alt=\"external group in sudorule\"\u003e\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce everything is set-up, members of this group should be limited/allowed to elements and commands as defined by the policies set in place.\u003c/p\u003e\n","description":"Map Active Directory groups in FreeIPA to control access to resources within Linux environments based on AD group memberships.","image":"/images/blogs/mapping_sudo.webp","permalink":"https://kovasky.me/blogs/mapping_sudo/","title":"Map an Active Directory group to sudo in Linux"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter creating a trust in FreeIPA, I kept having to write the full domain alongside my username whenever I tried to access the system. These are the steps I took to log in only with my username.\u003c/p\u003e\n\u003ch2 id=\"editing-sssdconf\"\u003eEditing SSSD.conf\u003c/h2\u003e\n\u003cp\u003eNavigate to /etc/sssd/ and open sssd.conf in an elevated text editor. It should look something like\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eservices \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e nss, pam, ssh, sudo\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edomains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e lin.mydomain.com\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBefore [sssd], add your trusted domain. Something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com/win.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"restart-sssd-service\"\u003eRestart SSSD service\u003c/h3\u003e\n\u003cp\u003eAfter the modification has taken place, just restart the service with the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl restart sssd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou\u0026rsquo;re done! Next time you log in, you will only have to specify your username.\u003c/p\u003e\n","description":"Access an Active Directory (AD) trusted Linux host without specifying the domain.","image":"/images/blogs/no_domain_login.webp","permalink":"https://kovasky.me/blogs/no_domain_login/","title":"Log in to Linux using AD credentials without specifying the domain"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI\u0026rsquo;ve been playing around with FreeIPA in my homelab for a while and have always wanted to enable seamless authentication between all my hosts regardless of their operating system. I stumbled upon the concept of cross-domain trusts between FreeIPA and Active Directory which allows us to achieve this.\u003c/p\u003e\n\u003cp\u003eThere is a caveat though, and that is that two-way trusts are still not fully implemented in FreeIPA, which means Windows users can authenticate against Linux hosts but Linux users can\u0026rsquo;t do the same the other way around.\u003c/p\u003e\n\u003ch2 id=\"creating-the-trust-on-your-freeipa-server\"\u003eCreating the trust (on your FreeIPA server)\u003c/h2\u003e\n\u003cp\u003eFirst, make sure that your FreeIPA server and your Active Directory do not share the same domain. You can have each of them be on a subdomain of the other or even create custom domains altogether. In my case, I went with lin.mydomain.com for FreeIPA and win.mydomain.com for Active Directory. Once the servers are set up with their respective domains, you can begin setting up the trust.\u003c/p\u003e\n\u003cp\u003eYou should have the following ports open:\nTCP ports: 53, 80, 88, 135, 138, 139, 389, 443, 445, 464, 636, 1024-1300\nUDP ports: 53, 88, 123, 138, 139, 389, 445, 464,\u003c/p\u003e\n\u003cp\u003eMake sure to install the ad trust package for FreeIPA:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eyum install \u003cspan style=\"color:#ae81ff\"\u003e\\*\u003c/span\u003eipa-server-trust-ad\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen proceed to run the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekinit \u0026lt;user with ipa admin privileges\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eipa-adtrust-install\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFollow the on-screen instructions to input your ad domain, domain admin, and password.\u003c/p\u003e\n\u003ch2 id=\"validating-the-trust-on-your-ad-server\"\u003eValidating the Trust (on your AD server)\u003c/h2\u003e\n\u003cp\u003eOn server manager, navigate to tools-\u0026gt;Active Directory Domains and Trusts. Right-click on your domain, and select properties. Click on Trusts, select the incoming trust for your FreeIPA domain, and click validate. Input your domain admin credentials.\u003c/p\u003e\n\u003ch2 id=\"validating-the-trust-on-your-freeipa-server\"\u003eValidating the Trust (on your FreeIPA server)\u003c/h2\u003e\n\u003cp\u003eTry to log in using \u003cem\u003ekinit \u003ca href=\"mailto:user@win.mydomain.local\"\u003euser@win.mydomain.local\u003c/a\u003e\u003c/em\u003e. If everything is right, this should succeed.\u003c/p\u003e\n","description":"Set up a cross-domain trust between FreeIPA and Active Directory to enable Windows authentication on Linux hosts.","image":"/images/blogs/ad_trust.webp","permalink":"https://kovasky.me/blogs/ad_trust/","title":"Setting up a cross-domain trust between FreeIPA and AD"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eOne of the nodes in my lab runs PfSense and if the vm is down, my network is down. This prevents my nodes from reaching quorum, and thus preventing PfSense from starting. To solve this, I needed a way for the vm to start without quorum. This was achieved by creating a oneshot service that runs at system startup.\u003c/p\u003e\n\u003ch2 id=\"create-the-script\"\u003eCreate the script\u003c/h2\u003e\n\u003cp\u003eCreate a script in a folder of your choice, like \u003ccode\u003e/root/startPfSense.sh\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003ePlace the following inside it, replacing the vmID for the id of the vm you want to start:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esleep \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esystemctl stop pve-cluster\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epmxcfs -l\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eqm start $vmID\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esleep \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekillall pmxcfs\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esystemctl start pve-cluster\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this, make sure to give it the proper permissions to make it executable.\u003c/p\u003e\n\u003ch2 id=\"create-the-service-file\"\u003eCreate the service file\u003c/h2\u003e\n\u003cp\u003eNow, create a service file like \u003ccode\u003e/etc/systemd/system/startPfSense.service\u003c/code\u003e and using a text editor add the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eUnit\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDescription\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eStart PfSense without quorum\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAfter\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epve-cluster.service\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eService\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etype\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eoneshot\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/root/startPfSense.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eInstall\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWantedBy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003emulti-user.target\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"enabling-the-service\"\u003eEnabling the service\u003c/h2\u003e\n\u003cp\u003eTo enable the service, you would do \u003ccode\u003esystemctl daemon-reload\u003c/code\u003e and later \u003ccode\u003esystemctl enable startPfSense.service\u003c/code\u003e. To check the status of the service, you would run \u003ccode\u003esystemctl status startPfSense\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eNow, your vm will be started on your next reboot.\u003c/p\u003e\n","description":"Start a vm on boot without quorum.","image":"/images/blogs/oneshot.webp","permalink":"https://kovasky.me/blogs/oneshot/","title":"Starting a VM in Proxmox without Quorum"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eThis is just a post to describe my homelab setup and make it linkable where needed (like in my resume). This is most definitely subject to change at any time as I continue to play with new technologies and keep adding things!\u003c/p\u003e\n\u003cp\u003eCheck out my uptime \u003ca href=\"https://agrajag.cloud\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"hosts\"\u003eHosts\u003c/h2\u003e\n\u003cp\u003eMy homelab consists of a 2 node proxmox cluster + 1 quorum device. The hosts are a 2010 Mac Pro as well as a M910X Thinkcentre Tiny and the qdevice is a nanopi neo.\u003c/p\u003e\n\u003cp\u003eThe specs are:\u003c/p\u003e\n\u003ch5 id=\"mac-pro\"\u003eMac Pro\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003e2x Xeon x5690\u003c/li\u003e\n\u003cli\u003e6x 16GB DDR3 RAM\u003c/li\u003e\n\u003cli\u003e2x 1TB MX500 SSD\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"m910x\"\u003eM910X\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003e1x Core i7-7700\u003c/li\u003e\n\u003cli\u003e2x 16GB DDR4 RAM\u003c/li\u003e\n\u003cli\u003e1x 1TB P5 SSD\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor storage I have a TerraMaster F2-220 running DSM through tinycore with 2x 6TB Ironwolf HDDs.\u003c/p\u003e\n\u003ch2 id=\"use-cases\"\u003eUse Cases\u003c/h2\u003e\n\u003cp\u003eMy homelab is mainly to have fun! I enjoy tinkering and learning new technologies so I put most of my free time in this :)\u003c/p\u003e\n\u003cp\u003eSome cool stuff im doing is the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePfSense directly hooked to my ISPs modem with BIND and Suricata to have control over my local network.\u003c/li\u003e\n\u003cli\u003eHomebridge to have remote access to my custom IP camera built using an ESP32.\u003c/li\u003e\n\u003cli\u003ePlex for viewing my media on the go.\u003c/li\u003e\n\u003cli\u003eWireGuard for outside access to my servers.\u003c/li\u003e\n\u003cli\u003eNginx + Authelia + Fail2Ban to expose services over the web as well as automatically ban unauthorized access attempts at a Cloudflare level.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"what-am-i-running\"\u003eWhat am I running?\u003c/h2\u003e\n\u003cp\u003eVMS:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePfSense\u003c/li\u003e\n\u003cli\u003eNTP Server\u003c/li\u003e\n\u003cli\u003eFreeIPA\u003c/li\u003e\n\u003cli\u003eAnsible\u003c/li\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003cli\u003eHomeBridge\u003c/li\u003e\n\u003cli\u003ePlex\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eContainers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAuthelia\u003c/li\u003e\n\u003cli\u003eDashy\u003c/li\u003e\n\u003cli\u003eFail2ban\u003c/li\u003e\n\u003cli\u003eGuacamole\u003c/li\u003e\n\u003cli\u003eKanboard\u003c/li\u003e\n\u003cli\u003eMariadb\u003c/li\u003e\n\u003cli\u003eMatomo\u003c/li\u003e\n\u003cli\u003eNginx Proxy Manager\u003c/li\u003e\n\u003cli\u003eOpenSpeedTest\u003c/li\u003e\n\u003cli\u003eOverseerr\u003c/li\u003e\n\u003cli\u003ePortioner\u003c/li\u003e\n\u003cli\u003eProwlarr\u003c/li\u003e\n\u003cli\u003eRadarr\u003c/li\u003e\n\u003cli\u003eRedis\u003c/li\u003e\n\u003cli\u003eSonarr\u003c/li\u003e\n\u003cli\u003eTransmission\u003c/li\u003e\n\u003cli\u003eUptime Kuma\u003c/li\u003e\n\u003cli\u003eWatchtower\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"diagram\"\u003eDiagram\u003c/h2\u003e\n\u003cp\u003eI will post a diagram here :)\u003c/p\u003e\n\u003ch2 id=\"full-pic\"\u003eFull pic\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/images/blogs/homelab.webp\" alt=\"\"\u003e\u003c/p\u003e\n","description":"My homelab!","image":"/images/blogs/homelab_thumb.webp","permalink":"https://kovasky.me/blogs/homelab/","title":"Homelab"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter tirelessly looking for a solution in order to dynamically create a whitelist for Suricata based on DNS, I decided to create my own.\u003c/p\u003e\n\u003ch2 id=\"download-the-necessary-files\"\u003eDownload the necessary files\u003c/h2\u003e\n\u003cp\u003eCreate a whitelist file with all the domains you wish whitelisted. A useful starting point is \u003ca href=\"https://github.com/anudeepND/whitelist\"\u003eanudeepND\u0026rsquo;s collection of commonly white listed domains\u003c/a\u003e. After that, download my \u003ca href=\"https://github.com/kovasky/homelabscripts/blob/main/pfSense/suricata/generateRules.py\"\u003egenerateRules.py\u003c/a\u003e script.\u003c/p\u003e\n\u003cp\u003ePlace these files in a directory of your choice on your PfSense host. For simplicity, I just placed them in /root. Finally, make the script executable by \u003ccode\u003echmod +x ./generateRules.py\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"modifying-suricatainc\"\u003eModifying suricata.inc\u003c/h2\u003e\n\u003cp\u003eNavigate to \u003ccode\u003e/usr/local/pkg/suricata/\u003c/code\u003e and using a text editor open \u003ccode\u003esuricata_defs.inc\u003c/code\u003e. Make the following modifications:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edefined\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;SURICATA_DEFAULT_RULES\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003edefine\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;SURICATA_DEFAULT_RULES\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003earray\u003c/span\u003e( \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;whitelist.rules\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;app-layer-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;decoder-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dhcp-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dnp3-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dns-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;files.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http2-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ipsec-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;kerberos-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;modbus-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mqtt-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;nfs-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ntp-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;smb-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;smtp-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ssh-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;stream-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tls-events.rules\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe first element in the array will be our generated \u003ccode\u003ewhitelist.rules\u003c/code\u003e. This file can be named as you wish and it will appear as so in the web gui.\u003c/p\u003e\n\u003ch2 id=\"running-the-script\"\u003eRunning the script\u003c/h2\u003e\n\u003cp\u003eRun the script with the path to the dns whitelist as well as where you want the output file. For example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./generateRules.py /root/dns_list.txt /root/whitelist.rules\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce the script has finished, you can copy/move it to \u003ccode\u003e/usr/local/share/suricata/rules/\u003c/code\u003e. If you open the Suricata web gui and select your interface, the new ruleset should appear. If not, you can try running \u003ccode\u003esuricata-update\u003c/code\u003e in terminal.\u003c/p\u003e\n\u003ch2 id=\"automating-the-generation-of-rules\"\u003eAutomating the generation of rules\u003c/h2\u003e\n\u003cp\u003eSince the IPs can change for any given domain, an easy way to update them would be to set up a cron job. Mine looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e * * * /root/update_rules.py /root/dns_list.txt /root/whitelist.rules\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e35\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e * * * mv /root/whitelist.rules /usr/local/share/suricata/rules/whitelist.rules \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e suricata-update\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter these steps are done, you are good to go and your domains will be whitelisted.\u003c/p\u003e\n","description":"Add a dns whitelist for Suricata in PfSense.","image":"/images/blogs/suricata.webp","permalink":"https://kovasky.me/blogs/whitelist/","title":"Whitelisting in Suricata Package for PfSense"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eWhile setting up my hosts with FreeIPA, I noticed that home directories were not being created when logging in through ssh. Looking online it seems that most people just use NFS shares to keep home directories the same across devices but I did not want to set up NFS home shares. Fixing this in RHEL-based distros is easy with authconfig but debian-based distros do not come with this. To fix this in debian-based distros is as easy as modiyfing the pam.d config file.\u003c/p\u003e\n\u003ch2 id=\"modify-sshd-and-reload-pam\"\u003eModify sshd and reload pam\u003c/h2\u003e\n\u003cp\u003eOpen /etc/pam.d/sshd with your favourite text editor and add the following line:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esession required pam_mkhomedir.so skel\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/etc/skel/ umask\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0022\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this, no reload should be necessary but just in case we execute the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo pam-auth-update --force --package\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter following these steps, our host should automatically create a home directory when logging in through ssh using FreeIPA credentials.\u003c/p\u003e\n","description":"Auto create a local home directory in FreeIPA enrolled hosts.","image":"/images/blogs/freeipa_home.webp","permalink":"https://kovasky.me/blogs/homecreation/","title":"Automatically create local home directory when logging in with FreeIPA"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI wanted to easily synchronize the time between my VMs and decided to set up an ntp server to accomplish this. Since a USB GPS device is relatively inexpensive, I thought it would be a great addition to the project.\u003c/p\u003e\n\u003cp\u003eFor the following examples, I used aptitude and vim.\u003c/p\u003e\n\u003ch2 id=\"prerequisite-packages\"\u003ePrerequisite Packages\u003c/h2\u003e\n\u003cp\u003eRun the following command to ensure we have the necessary packages:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt-get install gpsd gpsd-clients chrony\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"check-dev-for-gps\"\u003eCheck /dev for GPS\u003c/h2\u003e\n\u003cp\u003eOnce the gps is connected to the pc, we need to figure out the assigned device. This can be any of /dev/ttyUSB0, /dev/ttyACM0 or /dev/ttyAMA0.\u003c/p\u003e\n\u003cp\u003eIf unsure of which device it is, we can always run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecat /dev/$device\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe should be able to see a stream with coordinates and strings like \u0026ldquo;GPGGA\u0026rdquo; and \u0026ldquo;GPGSA\u0026rdquo;.\u003c/p\u003e\n\u003ch2 id=\"modify-gpsdconf-and-start-the-service\"\u003eModify gpsd.conf and start the service\u003c/h2\u003e\n\u003cp\u003eAfter getting the correct device, we will need to modify the configuration file located at \u0026ldquo;/etc/default/gpsd\u0026rdquo;. It should contain the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSTART_DAEMON\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUSBAUTO\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDEVICES\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/dev/ttyACM0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGPSD_OPTIONS\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;-n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this we should enable and start the service:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl enable gpsd \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo systemctl start gpsd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"modify-chronyconf-and-start-the-service\"\u003eModify chrony.conf and start the service\u003c/h2\u003e\n\u003cp\u003eThe configuration file will either be in \u0026ldquo;/etc/chrony.conf\u0026rdquo; or \u0026ldquo;/etc/chrony/chrony.conf\u0026rdquo;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edriftfile /var/lib/chrony/chrony/drift\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eallow\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erefclock SHM \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e refid GPS precision 1e-1 offset 0.9999 delay 0.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erefclock SHM \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e refid PPS precision 1e-7\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this we should enable and start the service:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl enable chronyd \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo systemctl start chronyd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"checking-chrony-status\"\u003eChecking chrony status\u003c/h2\u003e\n\u003cp\u003eTheres a few things we can check to see if everything was set up correctly. To see if chrony takes in the gps data, we can run the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echronyc sources\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd to see if it is working as intended, we can run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echronyc tracking\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe output should look similar to the image at the top of this post.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter following these steps, we should have a working ntp server and all that is left is to point any client to the ip of the host running chrony.\u003c/p\u003e\n","description":"Set up an NTP server to keep hosts synchronized.","image":"/images/blogs/chrony.webp","permalink":"https://kovasky.me/blogs/chronyd/","title":"NTP server with GPS and chrony"}]