[{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eSome of my hosted services do not have OIDC support or any sort of authentication out of the box. Since I am already running an instance of Authelia, I decided to use it to secure those services. It was not as straight forward as I thought, specially using HAProxy on pfSense. There are a few outdated guides that accomplish this but they still missed a step or two to get it working right.\u003c/p\u003e\n\u003ch2 id=\"pre-requisites\"\u003ePre-requisites\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003epfSense with haproxy-devel package installed\u003c/li\u003e\n\u003cli\u003eA working Authelia instance already configured and accessible\u003c/li\u003e\n\u003cli\u003eBasic understanding of HAProxy ACLs and actions\u003c/li\u003e\n\u003cli\u003eServices you want to protect must be accessible through HAProxy\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"setting-up-the-lua-scripts\"\u003eSetting up the Lua Scripts\u003c/h2\u003e\n\u003cp\u003eYou need to download 3 scripts into \u003ccode\u003e/usr/local/share/lua/5.3\u003c/code\u003e on your pfsense host.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://raw.githubusercontent.com/rxi/json.lua/refs/heads/master/json.lua\" target=\"_blank\"\u003ejson.luaðŸ”—\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://raw.githubusercontent.com/haproxytech/haproxy-lua-http/refs/heads/master/http.lua\" target=\"_blank\"\u003ehaproxy-lua-http.luaðŸ”—\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://raw.githubusercontent.com/TimWolla/haproxy-auth-request/refs/heads/main/auth-request.lua\" target=\"_blank\"\u003eauth-request.luaðŸ”—\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFirst, you need to add the \u003ccode\u003eauth-request.lua\u003c/code\u003e file via the HAProxy -\u0026gt; Files section, setting the type to Lua Script and the content to the one on the link above. It should look the following screenshot.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/haproxy_pfsense_files-120x%20Gaussian.webp\"\n      \n     height=\"1057\" width=\"1024\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_pfsense_files-270x.webp 270w,\n/images/lazyimg/haproxy_pfsense_files-420x.webp 420w,\n/images/lazyimg/haproxy_pfsense_files-570x.webp 570w,\n/images/lazyimg/haproxy_pfsense_files-720x.webp 720w,\n/images/lazyimg/haproxy_pfsense_files-1024x.webp 1024w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/haproxy_pfsense_files-1024x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"1057\" width=\"1024\" \n   srcset=\"/images/lazyimg/haproxy_pfsense_files-270x.webp 270w,\n/images/lazyimg/haproxy_pfsense_files-420x.webp 420w,\n/images/lazyimg/haproxy_pfsense_files-570x.webp 570w,\n/images/lazyimg/haproxy_pfsense_files-720x.webp 720w,\n/images/lazyimg/haproxy_pfsense_files-1024x.webp 1024w\"\n   alt=\"HAProxy files section in pfSense\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/haproxy_pfsense_files-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/haproxy_pfsense_files-1024x.webp\"\n  class=\"blur-up lazyload\"\n height=\"1057\" width=\"1024\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_pfsense_files-270x.webp 270w,\n/images/lazyimg/haproxy_pfsense_files-420x.webp 420w,\n/images/lazyimg/haproxy_pfsense_files-570x.webp 570w,\n/images/lazyimg/haproxy_pfsense_files-720x.webp 720w,\n/images/lazyimg/haproxy_pfsense_files-1024x.webp 1024w\"\n alt=\"HAProxy files section in pfSense\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eThen, download the 3 files, including the \u003ccode\u003eauth-request.lua\u003c/code\u003e by issuing the following commands.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl https://raw.githubusercontent.com/rxi/json.lua/refs/heads/master/json.lua \u0026gt; /usr/local/share/lua/5.3/json.lua\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl https://raw.githubusercontent.com/haproxytech/haproxy-lua-http/refs/heads/master/http.lua \u0026gt; /usr/local/share/lua/5.3/haproxy-lua-http.lua\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl https://raw.githubusercontent.com/TimWolla/haproxy-auth-request/refs/heads/main/auth-request.lua \u0026gt; /usr/local/share/lua/5.3/auth-request.lua\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter downloading these files, navigate to HAProxy -\u0026gt; Settings -\u0026gt; Global Advance Passthrough and under custom options paste \u003ccode\u003elua-prepend-path /usr/local/share/lua/5.3/haproxy-lua-http.lua\u003c/code\u003e. Click on save.\u003c/p\u003e\n\u003ch2 id=\"configuring-the-backend\"\u003eConfiguring the Backend\u003c/h2\u003e\n\u003cp\u003eOn the backend you want to protect, configure the following Access Control Lists.\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eExpression\u003c/th\u003e\n          \u003cth\u003eValue\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eremote_user_exist\u003c/td\u003e\n          \u003ctd\u003eCustom acl:\u003c/td\u003e\n          \u003ctd\u003evar(req.auth_response_header.remote_user) -m found\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eremote_groups_exist\u003c/td\u003e\n          \u003ctd\u003eCustom acl:\u003c/td\u003e\n          \u003ctd\u003evar(req.auth_response_header.remote_groups) -m found\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eremote_name_exist\u003c/td\u003e\n          \u003ctd\u003eCustom acl:\u003c/td\u003e\n          \u003ctd\u003evar(req.auth_response_header.remote_name) -m found\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eremote_email_exist\u003c/td\u003e\n          \u003ctd\u003eCustom acl:\u003c/td\u003e\n          \u003ctd\u003evar(req.auth_response_header.remote_email) -m found\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eAs well as the following Actions.\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eAction\u003c/th\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003efmt\u003c/th\u003e\n          \u003cth\u003eCondition acl names\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request set-header\u003c/td\u003e\n          \u003ctd\u003eRemote-User\u003c/td\u003e\n          \u003ctd\u003e%[ var(req.auth_response_header.remote_user) ]\u003c/td\u003e\n          \u003ctd\u003eremote_user_exist\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request set-header\u003c/td\u003e\n          \u003ctd\u003eRemote-Groups\u003c/td\u003e\n          \u003ctd\u003e%[ var(req.auth_response_header.remote_groups) ]\u003c/td\u003e\n          \u003ctd\u003eremote_groups_exist\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request set-header\u003c/td\u003e\n          \u003ctd\u003eRemote-Name\u003c/td\u003e\n          \u003ctd\u003e%[ var(req.auth_response_header.remote_name) ]\u003c/td\u003e\n          \u003ctd\u003eremote_name_exist\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request set-header\u003c/td\u003e\n          \u003ctd\u003eRemote-Email\u003c/td\u003e\n          \u003ctd\u003e%[ var(req.auth_response_header.remote_email) ]\u003c/td\u003e\n          \u003ctd\u003eremote_email_exist\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eIt should look something like the following image.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/haproxy_backend_authelia-120x%20Gaussian.webp\"\n      \n     height=\"860\" width=\"1024\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_backend_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_backend_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_backend_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_backend_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_backend_authelia-1024x.webp 1024w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/haproxy_backend_authelia-1024x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"860\" width=\"1024\" \n   srcset=\"/images/lazyimg/haproxy_backend_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_backend_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_backend_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_backend_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_backend_authelia-1024x.webp 1024w\"\n   alt=\"HAProxy backend with Authelia ACL and Actions on pfSense\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/haproxy_backend_authelia-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/haproxy_backend_authelia-1024x.webp\"\n  class=\"blur-up lazyload\"\n height=\"860\" width=\"1024\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_backend_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_backend_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_backend_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_backend_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_backend_authelia-1024x.webp 1024w\"\n alt=\"HAProxy backend with Authelia ACL and Actions on pfSense\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"configuring-the-frontend\"\u003eConfiguring the Frontend\u003c/h2\u003e\n\u003cp\u003eConfigure your frontend like you usually would, adding the appropriate ACLs and actions. Then, add one more ACL as follows.\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003eExpression\u003c/th\u003e\n          \u003cth\u003eValue\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eprotected-frontends\u003c/td\u003e\n          \u003ctd\u003eHost matches\u003c/td\u003e\n          \u003ctd\u003ehost\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eIf you have more than one host, replace the expression with Host regex using a value like \u003ccode\u003e^(app1|app2|app3)\\.mydomain\\.com$\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eIn the Actions section, add the following.\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eAction\u003c/th\u003e\n          \u003cth\u003ecustomaction\u003c/th\u003e\n          \u003cth\u003eCondition acl names\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCustom\u003c/td\u003e\n          \u003ctd\u003ehttp-request set-var(req.scheme) str(https)\u003c/td\u003e\n          \u003ctd\u003e{ ssl_fc }\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCustom\u003c/td\u003e\n          \u003ctd\u003ehttp-request set-var(req.scheme) str(http)\u003c/td\u003e\n          \u003ctd\u003e!{ ssl_fc }\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCustom\u003c/td\u003e\n          \u003ctd\u003ehttp-request set-var(req.questionmark) str(?)\u003c/td\u003e\n          \u003ctd\u003e{ query -m found }\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCustom\u003c/td\u003e\n          \u003ctd\u003ehttp-request lua.auth-intercept \u003cauthelia backend\u003e_ipvANY /api/authz/forward-auth HEAD * remote-user,remote-groups,remote-name,remote-email -\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eRemember to change \u003cauthelia backend\u003e with your Authelia backend name. The suffix ipvANY is necessary as HAProxy in pfSense adds the _ipvANY bit to the name when generating the configuration file. For example, if your Authelia backend is named \u0026ldquo;authelia\u0026rdquo;, use: authelia_ipvANY\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eAction\u003c/th\u003e\n          \u003cth\u003eName\u003c/th\u003e\n          \u003cth\u003efmt\u003c/th\u003e\n          \u003cth\u003eCondition acl names\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request header set\u003c/td\u003e\n          \u003ctd\u003eX-Real-IP\u003c/td\u003e\n          \u003ctd\u003e%[ src ]\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request header set\u003c/td\u003e\n          \u003ctd\u003eX-Forwarded-Method\u003c/td\u003e\n          \u003ctd\u003e%[ var(req.method) ]\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request header set\u003c/td\u003e\n          \u003ctd\u003eX-Forwarded-Proto\u003c/td\u003e\n          \u003ctd\u003e%[ var(req.scheme) ]\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request header set\u003c/td\u003e\n          \u003ctd\u003eX-Forwarded-Host\u003c/td\u003e\n          \u003ctd\u003e%[ req.hdr(Host) ]\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request header set\u003c/td\u003e\n          \u003ctd\u003eX-Forwarded-Uri\u003c/td\u003e\n          \u003ctd\u003e%[ path ]%[ var(req.questionmark) ]%[ query ]\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eAction\u003c/th\u003e\n          \u003cth\u003eRule\u003c/th\u003e\n          \u003cth\u003eCondition acl names\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request redirect\u003c/td\u003e\n          \u003ctd\u003elocation %[var(txn.auth_response_location)]\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends  !{ var(txn.auth_response_successful) -m bool }\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eAction\u003c/th\u003e\n          \u003cth\u003eCondition acl names\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ehttp-request deny\u003c/td\u003e\n          \u003ctd\u003eprotected-frontends !{ var(txn.auth_response_successful) -m bool } { var(txn.auth_response_code) -m int 403 }\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eThe order of rules and actions does not really matter, as they will be re-arranged when the configuration file is auto-generated. It should look something like the following images.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/haproxy_frontend1_authelia-120x%20Gaussian.webp\"\n      \n     height=\"999\" width=\"1024\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_frontend1_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_frontend1_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_frontend1_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_frontend1_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_frontend1_authelia-1024x.webp 1024w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/haproxy_frontend1_authelia-1024x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"999\" width=\"1024\" \n   srcset=\"/images/lazyimg/haproxy_frontend1_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_frontend1_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_frontend1_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_frontend1_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_frontend1_authelia-1024x.webp 1024w\"\n   alt=\"HAProxy frontend1 with Authelia ACL and Actions on pfSense\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/haproxy_frontend1_authelia-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/haproxy_frontend1_authelia-1024x.webp\"\n  class=\"blur-up lazyload\"\n height=\"999\" width=\"1024\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_frontend1_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_frontend1_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_frontend1_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_frontend1_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_frontend1_authelia-1024x.webp 1024w\"\n alt=\"HAProxy frontend1 with Authelia ACL and Actions on pfSense\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/haproxy_frontend2_authelia-120x%20Gaussian.webp\"\n      \n     height=\"999\" width=\"1024\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_frontend2_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_frontend2_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_frontend2_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_frontend2_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_frontend2_authelia-1024x.webp 1024w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/haproxy_frontend2_authelia-1024x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"999\" width=\"1024\" \n   srcset=\"/images/lazyimg/haproxy_frontend2_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_frontend2_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_frontend2_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_frontend2_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_frontend2_authelia-1024x.webp 1024w\"\n   alt=\"HAProxy frontend2 with Authelia ACL and Actions on pfSense\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/haproxy_frontend2_authelia-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/haproxy_frontend2_authelia-1024x.webp\"\n  class=\"blur-up lazyload\"\n height=\"999\" width=\"1024\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/haproxy_frontend2_authelia-270x.webp 270w,\n/images/lazyimg/haproxy_frontend2_authelia-420x.webp 420w,\n/images/lazyimg/haproxy_frontend2_authelia-570x.webp 570w,\n/images/lazyimg/haproxy_frontend2_authelia-720x.webp 720w,\n/images/lazyimg/haproxy_frontend2_authelia-1024x.webp 1024w\"\n alt=\"HAProxy frontend2 with Authelia ACL and Actions on pfSense\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter applying these settings, saving and restarting the HAProxy service, your applications should be protected by Authelia.\u003c/p\u003e\n\u003ch2 id=\"resources\"\u003eResources\u003c/h2\u003e\n\u003cp\u003eThanks to these resources for useful information.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.authelia.com/integration/proxies/haproxy/\" target=\"_blank\"\u003eAuthelia\u0026rsquo;s HAProxy guide\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/authelia/authelia/issues/2696\" target=\"_blank\"\u003eschklom\u0026rsquo;s HAProxy guide\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","description":"Authelia login page using HAProxy.","image":"images/authelia_login.webp","permalink":"https://kovasky.me/blogs/pfsense_haproxy_authelia/","title":"Configure HAProxy with Authelia on pfSense"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eSome of my self-hosted services don\u0026rsquo;t play nicely with Cloudflare proxying. This has led me to use DNS and forgo Cloudflare\u0026rsquo;s protection. Many of the guides out there require pfBlockerNG or the use of scripts that authenticate to pfSense via SSH. This guide will help you integrate Fail2Ban with pfSense using only alias lists.\u003c/p\u003e\n\u003ch2 id=\"serving-the-banlist\"\u003eServing the banlist\u003c/h2\u003e\n\u003cp\u003eYou need a web server configured to serve a txt file. There are multiple ways you can achieve this but in this case, we\u0026rsquo;ll install an Apache server on a Debian-based Docker host.\u003c/p\u003e\n\u003cp\u003eTo do that, you start with the following command: \u003ccode\u003esudo apt-get update \u0026amp;\u0026amp; sudo apt-get install apache2\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThen, modify the default site at \u003ccode\u003e/etc/apache2/sites-available/000-default.conf\u003c/code\u003e and replace its contents with the following.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;VirtualHost *:80\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ServerName banlist.local\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    DocumentRoot /var/www/html\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;Directory \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/var/www/html\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Options Indexes FollowSymLinks\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        AllowOverride None\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Require all granted\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u0026lt;Files \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*.txt\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ForceType text/plain\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            Header set Content-Type \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/plain; charset=utf-8\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u0026lt;/Files\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;/Directory\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;Location \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/banlist.txt\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Header set Cache-Control \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;no-cache, no-store, must-revalidate\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Header set Pragma \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;no-cache\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        Header set Expires \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;/Location\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;Location \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# Only allow GET requests\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u0026lt;LimitExcept GET\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            Require all denied\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u0026lt;/LimitExcept\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;/Location\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/VirtualHost\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfterward, create an empty banlist.txt file, \u003ccode\u003etouch /var/www/html/banlist.txt\u003c/code\u003e and add the appropriate permissions by running \u003ccode\u003echown www-data:www-data /var/www/html/banlist.txt\u003c/code\u003e. Finally, restart the server with \u003ccode\u003esudo systemctl reload apache2\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIf you navigate to \u003ccode\u003ehttp://\u0026lt;your-host\u0026gt;:80/banlist.txt\u003c/code\u003e, you should get an empty file.\u003c/p\u003e\n\u003ch2 id=\"adding-the-fail2ban-action\"\u003eAdding the Fail2Ban Action\u003c/h2\u003e\n\u003cp\u003eFirst, make sure that your Fail2Ban instance has access to the banlist. You can achieve this by adding the volume entry, \u003ccode\u003e- /var/www/html/banlist.txt:/data/banlists.d/banlist.txt\u003c/code\u003e. This maps the banlist.txt file found on the host to \u003ccode\u003e/data/banlists.d/banlist.txt\u003c/code\u003e in the Fail2Ban container.\u003c/p\u003e\n\u003cp\u003eThen, inside \u003ccode\u003eactions.d\u003c/code\u003e, create and edit a new configuration file, like \u003ccode\u003ebanlist.conf\u003c/code\u003e. Copy the following contents into it.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eDefinition\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionstart \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e touch /data/banlists.d/banlist.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionstop \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactioncheck \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionban \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e ! grep -q \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026lt;ip\u0026gt;\u0026#34;\u003c/span\u003e /data/banlists.d/banlist.txt; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e echo \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026lt;ip\u0026gt;\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /data/banlists.d/banlist.txt; \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionunban \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sed -i \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/^\u0026lt;ip\u0026gt;$/d\u0026#39;\u003c/span\u003e /data/banlists.d/banlist.txt\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen modify \u003ccode\u003ejail.d/jail.local\u003c/code\u003e and add the banlist action under the \u003ccode\u003e[DEFAULT]\u003c/code\u003e section. It should look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eDEFAULT\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eignoreip \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e 10.0.0.0/8, 192.168.0.0/16, 127.0.0.1, 172.0.0.0/8\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaction \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e cloudflare\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e         banlist\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFinally, restart your container for the changes to take effect.\u003c/p\u003e\n\u003ch2 id=\"adding-the-alias-in-pfsense\"\u003eAdding the Alias in pfSense\u003c/h2\u003e\n\u003cp\u003eIn your pfSense web interface, navigate to Firewall-\u0026gt;Aliases and click on Add. In the Properties section, enter a name like \u0026ldquo;Fail2Ban\u0026rdquo;, make sure the Type is set to URL Table (IPs). In the URL Table (IPs) section add the host URL, make sure the netmask is set to 128, and optionally add a meaningful description. The end result should look similar to this blog\u0026rsquo;s cover picture.\u003c/p\u003e\n\u003ch2 id=\"adding-the-update-script\"\u003eAdding the update script\u003c/h2\u003e\n\u003cp\u003eBy default, aliases are updated every 24 hours. This is not particularly useful for something like a blocklist, as we want the changes to propagate as fast as possible. To update the alias list on demand, you need to add a script in your pfSense machine. You can create a file under \u003ccode\u003e/usr/local/sbin/update_fail2ban_list.sh\u003c/code\u003e and give it the appropriate permissions by running \u003ccode\u003echmod +x /usr/local/sbin/update_fail2ban_list.sh\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003ePaste the following contents in there.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e/usr/bin/touch -t \u003cspan style=\"color:#ae81ff\"\u003e1001031305\u003c/span\u003e /var/db/aliastables/Fail2Ban.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e/usr/bin/nice -n20 /etc/rc.update_urltables now forceupdate\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou can test this by adding an IP entry to the ban list, checking the alias in pfSense to confirm it hasn\u0026rsquo;t appeared yet, executing the script, and finally checking the alias list again to verify the IP is now present.\u003c/p\u003e\n\u003cp\u003eTo make sure the list is updated constantly, add a cron job under Services-\u0026gt;Cron, matching the configuration as shown in the picture below.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/pfsense_cron_task-120x%20Gaussian.webp\"\n      \n     height=\"583\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pfsense_cron_task-220x.webp 220w,\n/images/lazyimg/pfsense_cron_task-320x.webp 320w,\n/images/lazyimg/pfsense_cron_task-420x.webp 420w,\n/images/lazyimg/pfsense_cron_task-520x.webp 520w,\n/images/lazyimg/pfsense_cron_task-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/pfsense_cron_task-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"583\" width=\"640\" \n   srcset=\"/images/lazyimg/pfsense_cron_task-220x.webp 220w,\n/images/lazyimg/pfsense_cron_task-320x.webp 320w,\n/images/lazyimg/pfsense_cron_task-420x.webp 420w,\n/images/lazyimg/pfsense_cron_task-520x.webp 520w,\n/images/lazyimg/pfsense_cron_task-640x.webp 640w\"\n   alt=\"pfSense cron job to update alias list\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/pfsense_cron_task-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/pfsense_cron_task-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"583\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pfsense_cron_task-220x.webp 220w,\n/images/lazyimg/pfsense_cron_task-320x.webp 320w,\n/images/lazyimg/pfsense_cron_task-420x.webp 420w,\n/images/lazyimg/pfsense_cron_task-520x.webp 520w,\n/images/lazyimg/pfsense_cron_task-640x.webp 640w\"\n alt=\"pfSense cron job to update alias list\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"adding-the-firewall-rule\"\u003eAdding the firewall rule\u003c/h2\u003e\n\u003cp\u003eTo tie it all together, you need a rule that will read the alias list and block traffic coming from any of the IPs listed there. Navigate to Firewall-\u0026gt;Rules and click on Add with the arrow pointing up. Make sure the Action is Block, Interface set to WAN, Address Family set to IPv4, Protocol set to Any, Source set to Address or Alias list with the Fail2Ban alias. Leave everything else as default and click on Save.\u003c/p\u003e\n\u003cp\u003eThe settings should look like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/pfsense_alias_rule_settings-120x%20Gaussian.webp\"\n      \n     height=\"572\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pfsense_alias_rule_settings-220x.webp 220w,\n/images/lazyimg/pfsense_alias_rule_settings-320x.webp 320w,\n/images/lazyimg/pfsense_alias_rule_settings-420x.webp 420w,\n/images/lazyimg/pfsense_alias_rule_settings-520x.webp 520w,\n/images/lazyimg/pfsense_alias_rule_settings-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/pfsense_alias_rule_settings-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"572\" width=\"640\" \n   srcset=\"/images/lazyimg/pfsense_alias_rule_settings-220x.webp 220w,\n/images/lazyimg/pfsense_alias_rule_settings-320x.webp 320w,\n/images/lazyimg/pfsense_alias_rule_settings-420x.webp 420w,\n/images/lazyimg/pfsense_alias_rule_settings-520x.webp 520w,\n/images/lazyimg/pfsense_alias_rule_settings-640x.webp 640w\"\n   alt=\"pfSense Fail2Ban alias list rule settings\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/pfsense_alias_rule_settings-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/pfsense_alias_rule_settings-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"572\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pfsense_alias_rule_settings-220x.webp 220w,\n/images/lazyimg/pfsense_alias_rule_settings-320x.webp 320w,\n/images/lazyimg/pfsense_alias_rule_settings-420x.webp 420w,\n/images/lazyimg/pfsense_alias_rule_settings-520x.webp 520w,\n/images/lazyimg/pfsense_alias_rule_settings-640x.webp 640w\"\n alt=\"pfSense Fail2Ban alias list rule settings\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eThe Firewall Rules page should look like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/pfsense_alias_rule-120x%20Gaussian.webp\"\n      \n     height=\"472\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pfsense_alias_rule-220x.webp 220w,\n/images/lazyimg/pfsense_alias_rule-320x.webp 320w,\n/images/lazyimg/pfsense_alias_rule-420x.webp 420w,\n/images/lazyimg/pfsense_alias_rule-520x.webp 520w,\n/images/lazyimg/pfsense_alias_rule-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/pfsense_alias_rule-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"472\" width=\"640\" \n   srcset=\"/images/lazyimg/pfsense_alias_rule-220x.webp 220w,\n/images/lazyimg/pfsense_alias_rule-320x.webp 320w,\n/images/lazyimg/pfsense_alias_rule-420x.webp 420w,\n/images/lazyimg/pfsense_alias_rule-520x.webp 520w,\n/images/lazyimg/pfsense_alias_rule-640x.webp 640w\"\n   alt=\"pfSense Fail2Ban alias list rule\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/pfsense_alias_rule-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/pfsense_alias_rule-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"472\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pfsense_alias_rule-220x.webp 220w,\n/images/lazyimg/pfsense_alias_rule-320x.webp 320w,\n/images/lazyimg/pfsense_alias_rule-420x.webp 420w,\n/images/lazyimg/pfsense_alias_rule-520x.webp 520w,\n/images/lazyimg/pfsense_alias_rule-640x.webp 640w\"\n alt=\"pfSense Fail2Ban alias list rule\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eNext time Fail2Ban detects an unwanted IP and adds it to the blocklist, pfSense will block traffic to it within 1 minute.\u003c/p\u003e\n","description":"pfSense Fail2Ban url alias.","image":"images/pfsense_alias.webp","permalink":"https://kovasky.me/blogs/pfsense_fail2ban/","title":"Connect Fail2Ban with pfSense"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI recently acquired an RTX 5060 GPU and had to look at multiple sources in order to get passthrough working. This will outline all the steps I took in order to get it working on my Dell Poweredge T440 server.\u003c/p\u003e\n\u003ch2 id=\"update\"\u003eUpdate\u003c/h2\u003e\n\u003cp\u003eAt the time of the post edit, Proxmox 9 has been released. I have updated my host to the new version and used\nthe \u003ca href=\"https://nvidia.custhelp.com/app/answers/detail/a_id/5665/~/nvidia-gpu-uefi-firmware-update-tool-for-rtx-5060-series\" target=\"_blank\"\u003eupdate tool for RTX 5060 seriesðŸ”—\u003c/a\u003e provided by Nvidia. This runs only on Windows so I have passed-through my GPU to a windows VM in order to run the update.\u003c/p\u003e\n\u003cp\u003eI am still not able to enable the ROM BAR or primary GPU options in the VM.\u003c/p\u003e\n\u003ch2 id=\"pre-requisite\"\u003ePre-requisite\u003c/h2\u003e\n\u003cp\u003eI am using an ubuntu 22.04 VM with the official 6.14 kernel update. It is worth noting that I could not get this to work with the latest generic kernel installed through Ubuntu Mainline Kernel Installer. The kernel needs to be provided by canonical.\u003c/p\u003e\n\u003cp\u003eMake sure you have enabled \u003ccode\u003eAbove 4G Decoding\u003c/code\u003e in your BIOS, and if available, also enable ReBAR support.\u003c/p\u003e\n\u003ch2 id=\"1-proxmox-grub-configuration\"\u003e1. Proxmox Grub Configuration\u003c/h2\u003e\n\u003cp\u003eIn your proxmox server, open the grub configuration file \u003ccode\u003e/etc/default/grub\u003c/code\u003e and look for the line \u003ccode\u003eGRUB_CMDLINE_LINUX_DEFAULT\u003c/code\u003e and modify it to look like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGRUB_CMDLINE_LINUX_DEFAULT\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;quiet intel_iommu=on iommu=pt pcie_acs_override=downstream,multifunction nofb nomodeset video=vesafb:off,efifb:off\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf you are using an amd cpu, change \u003ccode\u003eintel_iommu=on\u003c/code\u003e in favour of \u003ccode\u003eamd_iommu=on\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eSave and close it, and issue the command \u003ccode\u003eupdate-grub\u003c/code\u003e. To ensure IOMMU has been enabled successfully, reboot your server and issue the command \u003ccode\u003edmesg | grep -e DMAR -e IOMMU\u003c/code\u003e, you should see a line akin to:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e    0.537225\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e DMAR: IOMMU enabled\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"2-proxmox-vfio-kernel-modules\"\u003e2. Proxmox VFIO Kernel Modules\u003c/h2\u003e\n\u003cp\u003eEdit \u003ccode\u003e/etc/modules\u003c/code\u003e and add the following lines to the end of the file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio_iommu_type1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio_pci\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio_virqfd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"3-configure-proxmox-vfio-options\"\u003e3. Configure Proxmox VFIO Options\u003c/h2\u003e\n\u003cp\u003eIssue the following commands:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;options vfio_iommu_type1 allow_unsafe_interrupts=1\u0026#34;\u003c/span\u003e \u0026gt; /etc/modprobe.d/iommu_unsafe_interrupts.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;options kvm ignore_msrs=1\u0026#34;\u003c/span\u003e \u0026gt; /etc/modprobe.d/kvm.conf\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThese options help VFIO handle interrupt mapping and MSR access for GPU passthrough.\u003c/p\u003e\n\u003ch2 id=\"4-blacklist-nvidia-drivers\"\u003e4. Blacklist NVIDIA drivers\u003c/h2\u003e\n\u003cp\u003eIssue the following commands:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;blacklist nouveau\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/modprobe.d/blacklist.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;blacklist nvidia*\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/modprobe.d/blacklist.conf\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"5-bind-the-gpu-to-vfio\"\u003e5. Bind the GPU to VFIO\u003c/h2\u003e\n\u003cp\u003eNow, we need to tell Proxmox to bind the VFIO driver to our GPU. To do this, first you need to find out the gpu ids.\u003c/p\u003e\n\u003cp\u003eIssue the command \u003ccode\u003elspci -nn | grep NVIDIA\u003c/code\u003e. You should get an output like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@pve:~# lspci -nn | grep NVIDIA\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaf:00.0 VGA compatible controller \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e0300\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: NVIDIA Corporation Device \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e10de:2d05\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003erev a1\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaf:00.1 Audio device \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e0403\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: NVIDIA Corporation Device \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e10de:22eb\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003erev a1\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNote down the PCI IDs, particularly: \u003ccode\u003e10de:2d05\u003c/code\u003e and \u003ccode\u003e10de:22eb\u003c/code\u003e. These hex values identify your specific GPU model and audio controller.\u003c/p\u003e\n\u003cp\u003eIssue the command \u003ccode\u003eecho \u0026quot;options vfio-pci ids=10de:2d05,10de:22eb\u0026quot; \u0026gt; /etc/modprobe.d/vfio.conf\u003c/code\u003e, replacing the IDs appropriately.\u003c/p\u003e\n\u003cp\u003eAfterwards, run \u003ccode\u003eupdate-initramfs -u\u003c/code\u003e and reboot your server.\u003c/p\u003e\n\u003ch2 id=\"6-attaching-the-gpu-to-the-vm\"\u003e6. Attaching the GPU to the VM\u003c/h2\u003e\n\u003cp\u003eFirst, ensure your VM is off. Then, to attach the GPU to the VM, navigate to the Hardware settings and select Add -\u0026gt; PCI Device. Click on Raw Device and search for the GPU in the dropdown. It should look as follows:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/vm_gpu_selection-120x%20Gaussian.webp\"\n      \n     height=\"328\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vm_gpu_selection-220x.webp 220w,\n/images/lazyimg/vm_gpu_selection-320x.webp 320w,\n/images/lazyimg/vm_gpu_selection-420x.webp 420w,\n/images/lazyimg/vm_gpu_selection-520x.webp 520w,\n/images/lazyimg/vm_gpu_selection-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/vm_gpu_selection-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"328\" width=\"640\" \n   srcset=\"/images/lazyimg/vm_gpu_selection-220x.webp 220w,\n/images/lazyimg/vm_gpu_selection-320x.webp 320w,\n/images/lazyimg/vm_gpu_selection-420x.webp 420w,\n/images/lazyimg/vm_gpu_selection-520x.webp 520w,\n/images/lazyimg/vm_gpu_selection-640x.webp 640w\"\n   alt=\"Proxmox PCI Device Hardware Selection\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/vm_gpu_selection-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/vm_gpu_selection-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"328\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vm_gpu_selection-220x.webp 220w,\n/images/lazyimg/vm_gpu_selection-320x.webp 320w,\n/images/lazyimg/vm_gpu_selection-420x.webp 420w,\n/images/lazyimg/vm_gpu_selection-520x.webp 520w,\n/images/lazyimg/vm_gpu_selection-640x.webp 640w\"\n alt=\"Proxmox PCI Device Hardware Selection\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eMake sure to Enable All Functions and PCI-Express while keeping ROM-Bar and Primary GPU unchecked.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/vm_gpu_options-120x%20Gaussian.webp\"\n      \n     height=\"373\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vm_gpu_options-220x.webp 220w,\n/images/lazyimg/vm_gpu_options-320x.webp 320w,\n/images/lazyimg/vm_gpu_options-420x.webp 420w,\n/images/lazyimg/vm_gpu_options-520x.webp 520w,\n/images/lazyimg/vm_gpu_options-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/vm_gpu_options-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"373\" width=\"640\" \n   srcset=\"/images/lazyimg/vm_gpu_options-220x.webp 220w,\n/images/lazyimg/vm_gpu_options-320x.webp 320w,\n/images/lazyimg/vm_gpu_options-420x.webp 420w,\n/images/lazyimg/vm_gpu_options-520x.webp 520w,\n/images/lazyimg/vm_gpu_options-640x.webp 640w\"\n   alt=\"NVIDIA RTX 5000 Hardware Passthrough Options.\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/vm_gpu_options-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/vm_gpu_options-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"373\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vm_gpu_options-220x.webp 220w,\n/images/lazyimg/vm_gpu_options-320x.webp 320w,\n/images/lazyimg/vm_gpu_options-420x.webp 420w,\n/images/lazyimg/vm_gpu_options-520x.webp 520w,\n/images/lazyimg/vm_gpu_options-640x.webp 640w\"\n alt=\"NVIDIA RTX 5000 Hardware Passthrough Options.\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eIf you prefer GUI access to your system, make sure Display is set to default.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/vm_display_selection-120x%20Gaussian.webp\"\n      \n     height=\"397\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vm_display_selection-220x.webp 220w,\n/images/lazyimg/vm_display_selection-320x.webp 320w,\n/images/lazyimg/vm_display_selection-420x.webp 420w,\n/images/lazyimg/vm_display_selection-520x.webp 520w,\n/images/lazyimg/vm_display_selection-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/vm_display_selection-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"397\" width=\"640\" \n   srcset=\"/images/lazyimg/vm_display_selection-220x.webp 220w,\n/images/lazyimg/vm_display_selection-320x.webp 320w,\n/images/lazyimg/vm_display_selection-420x.webp 420w,\n/images/lazyimg/vm_display_selection-520x.webp 520w,\n/images/lazyimg/vm_display_selection-640x.webp 640w\"\n   alt=\"NVIDIA RTX 5000 Hardware Passtrough Options.\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/vm_display_selection-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/vm_display_selection-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"397\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vm_display_selection-220x.webp 220w,\n/images/lazyimg/vm_display_selection-320x.webp 320w,\n/images/lazyimg/vm_display_selection-420x.webp 420w,\n/images/lazyimg/vm_display_selection-520x.webp 520w,\n/images/lazyimg/vm_display_selection-640x.webp 640w\"\n alt=\"NVIDIA RTX 5000 Hardware Passtrough Options.\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eNow, turn on your vm.\u003c/p\u003e\n\u003ch2 id=\"7-install-the-nvidia-drivers\"\u003e7. Install the NVIDIA Drivers\u003c/h2\u003e\n\u003cp\u003eFor the card to work correctly, you need to install the latest nvidia-open drivers (575 at the time of writing this).\u003c/p\u003e\n\u003cp\u003eFirst, uninstall any old drivers:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get remove --purge \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;^nvidia-.*\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt autoremove\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ereboot\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen, install some dependencies:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt install pkg-config libglvnd-dev dkms build-essential libegl-dev libegl1 libgl-dev libgl1 libgles-dev libgles1 libglvnd-core-dev libglx-dev libopengl-dev gcc make \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFinally, install the drivers and reboot:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo add-apt-repository ppa:graphics-drivers/ppa\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt update \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt install nvidia-driver-575-open\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ereboot\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo confirm everything works as intended, run \u003ccode\u003envidia-smi\u003c/code\u003e. You should see a screen like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/5060_nvidia_smi-120x%20Gaussian.webp\"\n      \n     height=\"425\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/5060_nvidia_smi-220x.webp 220w,\n/images/lazyimg/5060_nvidia_smi-320x.webp 320w,\n/images/lazyimg/5060_nvidia_smi-420x.webp 420w,\n/images/lazyimg/5060_nvidia_smi-520x.webp 520w,\n/images/lazyimg/5060_nvidia_smi-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/5060_nvidia_smi-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"425\" width=\"640\" \n   srcset=\"/images/lazyimg/5060_nvidia_smi-220x.webp 220w,\n/images/lazyimg/5060_nvidia_smi-320x.webp 320w,\n/images/lazyimg/5060_nvidia_smi-420x.webp 420w,\n/images/lazyimg/5060_nvidia_smi-520x.webp 520w,\n/images/lazyimg/5060_nvidia_smi-640x.webp 640w\"\n   alt=\"NVIDIA RTX 5000 Hardware Passtrough Options.\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/5060_nvidia_smi-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/5060_nvidia_smi-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"425\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/5060_nvidia_smi-220x.webp 220w,\n/images/lazyimg/5060_nvidia_smi-320x.webp 320w,\n/images/lazyimg/5060_nvidia_smi-420x.webp 420w,\n/images/lazyimg/5060_nvidia_smi-520x.webp 520w,\n/images/lazyimg/5060_nvidia_smi-640x.webp 640w\"\n alt=\"NVIDIA RTX 5000 Hardware Passtrough Options.\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eMake sure to disable the default display so that the system uses the NVIDIA GPU as its primary GPU. It is worth noting that ROMBar and Primary GPU options under the hardware tab should be disabled, otherwise the system will be prevented from booting up.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eIf all the steps have succeeded, you should have passed through your RTX 5000 series GPU.\u003c/p\u003e\n\u003ch2 id=\"resources\"\u003eResources\u003c/h2\u003e\n\u003cp\u003eThanks to these resources for useful information.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.reddit.com/r/homelab/comments/b5xpua/the_ultimate_beginners_guide_to_gpu_passthrough/\" target=\"_blank\"\u003eu/cjalas\u0026rsquo; guide to passthrough\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/oddmario/NVIDIA-Ubuntu-Driver-Guide\" target=\"_blank\"\u003eoddmario\u0026rsquo;s nvidia ubuntu driver guide\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://forum.proxmox.com/threads/nvidia-5000-series-passthrough-failing-miserably.165456/\" target=\"_blank\"\u003eNvidia 5000 series passthrough proxmox thread\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","description":"RTX 5060 in a Dell T440.","image":"images/5060.webp","permalink":"https://kovasky.me/blogs/rtx_5000_passthrough/","title":"How to passthrough an RTX 5000 series GPU to Proxmox"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI had a few PowerShell tasks set up in my server with no way of knowing their status unless I checked for logs. Logging in and searching for logs easily becomes a hassle when you have more than one VM. I needed a less time consuming method, so I found a way to send push alerts to my mobile phone using ntfy.\u003c/p\u003e\n\u003ch2 id=\"pre-requisites\"\u003ePre-requisites\u003c/h2\u003e\n\u003cp\u003eFor this setup to work, you should have a running instance of ntfy.sh. You can find the installation instructions \u003ca href=\"https://docs.ntfy.sh/install/\"\u003ehere\u003c/a\u003e. You can find my personal docker compose file \u003ca href=\"/blogs/proxmox_ntfy/\"\u003ehere\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI am running the stock PowerShell version installed in Windows Server 2016 and encountered some issues reaching my ntfy endpoint due to certificate validation failures. To avoid this, I added the following in my script.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAdd-Type \u003cspan style=\"color:#e6db74\"\u003e@\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eusing System.Net;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eusing System.Security.Cryptography.X509Certificates;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003epublic class TrustAllCertsPolicy : ICertificatePolicy {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e    public bool CheckValidationResult(\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e    ServicePoint srvPoint, X509Certificate certificate,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e    WebRequest request, int certificateProblem) {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e        return true;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;@\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e[\u003cspan style=\"color:#66d9ef\"\u003eSystem.Net.ServicePointManager\u003c/span\u003e]::CertificatePolicy = New-Object TrustAllCertsPolicy\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$allProtocols = [\u003cspan style=\"color:#66d9ef\"\u003eSystem.Net.SecurityProtocolType\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Ssl3,Tls,Tls11,Tls12\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e[\u003cspan style=\"color:#66d9ef\"\u003eSystem.Net.ServicePointManager\u003c/span\u003e]::SecurityProtocol = $allProtocols\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"powershell-script\"\u003ePowershell Script\u003c/h2\u003e\n\u003cp\u003eTo send a message to ntfy, you just have to add a POST request to your script as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-powershell\" data-lang=\"powershell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$bearerToken=\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;your encoded token\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e$Request = @{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  Method = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;POST\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  URI = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://ntfy.yourdomain.com/scripts?auth=\u003c/span\u003e$bearerToken\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  Headers = @{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Title = $title \u003cspan style=\"color:#75715e\"\u003e# title is the notification header\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  Body = $body \u003cspan style=\"color:#75715e\"\u003e# body is the content of your notification\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eInvoke-RestMethod @Request\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo get an access token, log into your ntfy web interface and navigate to your account settings. Create an access token and make sure to select \u003ccode\u003eToken never expires\u003c/code\u003e for convenience. Once created, copy the token and format it as \u003ccode\u003eBearer tk_token\u003c/code\u003e. Finally, encode this entire string in base64 using an online tool like \u003ca href=\"https://www.base64encode.org/\"\u003ethis one\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eIf everything is set up correctly, you will be able to receive status information from your scripts directly to your phone.\u003c/p\u003e\n","description":"Send push notifications to your mobile phone with ntfy.sh via PowerShell.","image":"images/powershell_ntfy.webp","permalink":"https://kovasky.me/blogs/powershell_ntfy/","title":"Send push notifications to your mobile phone with ntfy.sh via PowerShell"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAt the time of writing this post, I found no guide on setting up Authelia as a social provider for ERPNext. These are the steps I took to link them.\u003c/p\u003e\n\u003ch2 id=\"authelia\"\u003eAuthelia\u003c/h2\u003e\n\u003cp\u003eIf you have an LDAP server configured, you have to make sure the correct attributes are retrieved. The attributes section should look like follows.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eauthentication_backend\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eldap\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimplementation\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ecustom\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eaddress\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eldap://\u0026lt;server ip address\u0026gt;:389\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003estart_tls\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003etls\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eskip_verify\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eminimum_version\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eTLS1.2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ebase_dn\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eDC=mydomain,DC=com\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eattributes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eusername\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003esAMAccountName\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003egroup_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ecn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003email\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003email\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003edisplay_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003edisplayname\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003egiven_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003egivenName\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003efamily_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003esn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eusers_filter\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e(\u0026amp;(|({username_attribute}={input})({mail_attribute}={input}))(objectCategory=person)(objectClass=user)(!userAccountControl:1.2.840.113556.1.4.803:=2)(!pwdLastSet=0))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003egroups_filter\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e(\u0026amp;(member:1.2.840.113556.1.4.1941:={dn})(objectClass=group)(objectCategory=group))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003euser\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eCN=\u0026lt;bind account username\u0026gt;,CN=Users,DC=mydomain,DC=com\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003epassword\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;bind account password\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce the ldap section is correct, you should proceed to the identity providers section to configure the ERPNext client. The client configuration for erpnext should look as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eidentity_providers\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eoidc\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eclients\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    - \u003cspan style=\"color:#f92672\"\u003eclient_id\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eerpnext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eclient_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eerpnext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eclient_secret\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;$pbkdf2-sha512$310000$OYxF/9Lo7Rv1K30g3UH0bg$nH9ZVUX9zEYGPHnHHFbueWz6TbpHsdvjx.WgYGGwd31sRV.CIgGXz4EW0fwOuPpI9fiv2G8cyowb/zD8A8LiCg\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003epublic\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eauthorization_policy\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eone_factor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eredirect_uris\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003ehttps://\u0026lt;erpnext domain\u0026gt;/api/method/frappe.integrations.oauth2_logins.custom/authelia\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003escopes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eopenid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eprofile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eemail\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003egroups\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003euserinfo_signed_response_alg\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003enone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003econsent_mode\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eimplicit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003etoken_endpoint_auth_method\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;client_secret_post\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo generate the client secret, you will have to issue the command \u003ccode\u003edocker run --rm authelia/authelia:latest authelia crypto hash generate pbkdf2 --variant sha512 --random --random.length 72 --random.charset rfc3986\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThe output should look like follows.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/authelia_client_digest-120x%20Gaussian.webp\"\n      \n     height=\"479\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/authelia_client_digest-220x.webp 220w,\n/images/lazyimg/authelia_client_digest-320x.webp 320w,\n/images/lazyimg/authelia_client_digest-420x.webp 420w,\n/images/lazyimg/authelia_client_digest-520x.webp 520w,\n/images/lazyimg/authelia_client_digest-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/authelia_client_digest-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"479\" width=\"640\" \n   srcset=\"/images/lazyimg/authelia_client_digest-220x.webp 220w,\n/images/lazyimg/authelia_client_digest-320x.webp 320w,\n/images/lazyimg/authelia_client_digest-420x.webp 420w,\n/images/lazyimg/authelia_client_digest-520x.webp 520w,\n/images/lazyimg/authelia_client_digest-640x.webp 640w\"\n   alt=\"Generate a random password and digest for client configuration using Authelia\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/authelia_client_digest-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/authelia_client_digest-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"479\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/authelia_client_digest-220x.webp 220w,\n/images/lazyimg/authelia_client_digest-320x.webp 320w,\n/images/lazyimg/authelia_client_digest-420x.webp 420w,\n/images/lazyimg/authelia_client_digest-520x.webp 520w,\n/images/lazyimg/authelia_client_digest-640x.webp 640w\"\n alt=\"Generate a random password and digest for client configuration using Authelia\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eThe digest will be used in the Authelia client configuration, as shown above. Copy the random password and keep it handy, as that will be used in the ERPNext configuration. Restart Authelia for the changes to take effect.\u003c/p\u003e\n\u003ch2 id=\"erpnext-configuration\"\u003eERPNext Configuration\u003c/h2\u003e\n\u003cp\u003eIn the dashboard, navigate to Integrations -\u0026gt; Social Login Key -\u0026gt; Add Social Login Key. The form can be filled as follows:\u003c/p\u003e\n\u003ch5 id=\"client-credentials\"\u003eClient Credentials\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003eSocial Login Provider: Custom\u003c/li\u003e\n\u003cli\u003eProvider Name: Authelia\u003c/li\u003e\n\u003cli\u003eClient ID: erpnext or whatever client id you used in the Authelia configuration\u003c/li\u003e\n\u003cli\u003eClient Secret: paste the random password generated in the previous step\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"identity-details\"\u003eIdentity Details\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003eIcon: can leave blank or provide a url for an Authelia icon\u003c/li\u003e\n\u003cli\u003eBase URL: https://\u0026lt;authelia domain\u0026gt;\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"configuration\"\u003eConfiguration\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003eSign Ups: Allow\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"client-urls\"\u003eClient URLs\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003eAuthorize URL: /api/oidc/authorization\u003c/li\u003e\n\u003cli\u003eRedirect URL: https://\u0026lt;erpnext domain\u0026gt;/api/method/frappe.integrations.oauth2_logins.custom/authelia\u003c/li\u003e\n\u003cli\u003eAccess Token URL: /api/oidc/token\u003c/li\u003e\n\u003cli\u003eAPI Endpoint: /api/oidc/userinfo\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch5 id=\"client-information\"\u003eClient Information\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003eAPI Endpoint Args: empty\u003c/li\u003e\n\u003cli\u003eAuth URL Data:\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\u003cspan style=\"color:#f92672\"\u003e\u0026#34;scope\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;openid profile email\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026#34;response_type\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;code\u0026#34;\u003c/span\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003eUser ID Property: email\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eMake sure to click Enable Social Login and click on Save. If you wish to disable regular username login, navigate to System Settings -\u0026gt; Login and check Disable Username/Password Login. Click Save\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eIf everything is set up correctly, you will be able to login with Authelia.\u003c/p\u003e\n","description":"Use Authelia as a social login provider for ERPNext.","image":"images/erpnext_authelia.webp","permalink":"https://kovasky.me/blogs/erpnext_authelia/","title":"Use Authelia as a social login provider for ERPNext"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI took a leap of faith by buying an Intel Alchemist series GPU, even after countless people online advised against purchasing one if the target system doesn\u0026rsquo;t support Resizable BAR. Still, AV1 at this price point felt too compelling to pass up, even if it meant subpar graphical performance. My main intent was transcoding media, so I didn\u0026rsquo;t think I would mind.\u003c/p\u003e\n\u003cp\u003eI didn\u0026rsquo;t expect much, but the Intel Arc A380 performed surprisingly well for my needs, showing results close to a GTX 1650. Best of all, converting my media to AV1 has already saved over 9TB of storage space (more than a 50% reduction in space usage).\u003c/p\u003e\n\u003cp\u003eIn this blog, I\u0026rsquo;ll share my results.\u003c/p\u003e\n\u003ch2 id=\"system-specs\"\u003eSystem specs\u003c/h2\u003e\n\u003cp\u003eThe GPU is passed through to my Plex VM, which has the following configuration:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e16 cores, Xeon Gold 6126\u003c/li\u003e\n\u003cli\u003e16GiB of RAM\u003c/li\u003e\n\u003cli\u003eUbuntu 24.04.2\u003c/li\u003e\n\u003cli\u003eKernel 6.8.0-54-generic\u003c/li\u003e\n\u003cli\u003eMesa 25.0.0 (Kisak\u0026rsquo;s PPA)\u003c/li\u003e\n\u003cli\u003eVulkan 1.4.305\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIt is worth noting that the host has 4G decoding enabled.\u003c/p\u003e\n\u003ch2 id=\"graphics-performance\"\u003eGraphics Performance\u003c/h2\u003e\n\u003cp\u003eI was originally planning to use Unigine benchmarking tools but quickly realized they lack of Vulkan support. I then turned to GravityMark, a very capable benchmarking tool with Vulkan support. There aren\u0026rsquo;t many submissions to GravityMark, so these results should be taken with caution. Click \u003ca href=\"https://gravitymark.tellusim.com/leaderboard/\" target=\"_blank\"\u003ehere\u003c/a\u003e to view the GravityMark leaderboard.\u003c/p\u003e\n\u003cp\u003eOpenGL performance for this card is abysmal. I don\u0026rsquo;t know if its due to my setup, but it is significantly worse than Vulkan. I did not find many relevant results from GravityMark, so I have only compared it against a GTX 1070.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/opengl_graph-120x%20Gaussian.webp\"\n      \n     height=\"386\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/opengl_graph-220x.webp 220w,\n/images/lazyimg/opengl_graph-320x.webp 320w,\n/images/lazyimg/opengl_graph-420x.webp 420w,\n/images/lazyimg/opengl_graph-520x.webp 520w,\n/images/lazyimg/opengl_graph-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/opengl_graph-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"386\" width=\"640\" \n   srcset=\"/images/lazyimg/opengl_graph-220x.webp 220w,\n/images/lazyimg/opengl_graph-320x.webp 320w,\n/images/lazyimg/opengl_graph-420x.webp 420w,\n/images/lazyimg/opengl_graph-520x.webp 520w,\n/images/lazyimg/opengl_graph-640x.webp 640w\"\n   alt=\"OpenGL performance comparison\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/opengl_graph-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/opengl_graph-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"386\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/opengl_graph-220x.webp 220w,\n/images/lazyimg/opengl_graph-320x.webp 320w,\n/images/lazyimg/opengl_graph-420x.webp 420w,\n/images/lazyimg/opengl_graph-520x.webp 520w,\n/images/lazyimg/opengl_graph-640x.webp 640w\"\n alt=\"OpenGL performance comparison\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eVulkan on the other hand, performed great. The Intel Arc A380 seems to sit between an AMD RX 580 and a GTX 1650 \u0026ndash;not too bad.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/vulkan_graph-120x%20Gaussian.webp\"\n      \n     height=\"385\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vulkan_graph-220x.webp 220w,\n/images/lazyimg/vulkan_graph-320x.webp 320w,\n/images/lazyimg/vulkan_graph-420x.webp 420w,\n/images/lazyimg/vulkan_graph-520x.webp 520w,\n/images/lazyimg/vulkan_graph-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/vulkan_graph-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"385\" width=\"640\" \n   srcset=\"/images/lazyimg/vulkan_graph-220x.webp 220w,\n/images/lazyimg/vulkan_graph-320x.webp 320w,\n/images/lazyimg/vulkan_graph-420x.webp 420w,\n/images/lazyimg/vulkan_graph-520x.webp 520w,\n/images/lazyimg/vulkan_graph-640x.webp 640w\"\n   alt=\"Vulkan performance comparison\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/vulkan_graph-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/vulkan_graph-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"385\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/vulkan_graph-220x.webp 220w,\n/images/lazyimg/vulkan_graph-320x.webp 320w,\n/images/lazyimg/vulkan_graph-420x.webp 420w,\n/images/lazyimg/vulkan_graph-520x.webp 520w,\n/images/lazyimg/vulkan_graph-640x.webp 640w\"\n alt=\"Vulkan performance comparison\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/a380_gravitymark_opengl-120x%20Gaussian.webp\"\n      \n     height=\"558\" width=\"940\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/a380_gravitymark_opengl-270x.webp 270w,\n/images/lazyimg/a380_gravitymark_opengl-420x.webp 420w,\n/images/lazyimg/a380_gravitymark_opengl-570x.webp 570w,\n/images/lazyimg/a380_gravitymark_opengl-720x.webp 720w,\n/images/lazyimg/a380_gravitymark_opengl-940x.webp 940w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/a380_gravitymark_opengl-940x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"558\" width=\"940\" \n   srcset=\"/images/lazyimg/a380_gravitymark_opengl-270x.webp 270w,\n/images/lazyimg/a380_gravitymark_opengl-420x.webp 420w,\n/images/lazyimg/a380_gravitymark_opengl-570x.webp 570w,\n/images/lazyimg/a380_gravitymark_opengl-720x.webp 720w,\n/images/lazyimg/a380_gravitymark_opengl-940x.webp 940w\"\n   alt=\"Vulkan performance comparison\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/a380_gravitymark_opengl-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/a380_gravitymark_opengl-940x.webp\"\n  class=\"blur-up lazyload\"\n height=\"558\" width=\"940\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/a380_gravitymark_opengl-270x.webp 270w,\n/images/lazyimg/a380_gravitymark_opengl-420x.webp 420w,\n/images/lazyimg/a380_gravitymark_opengl-570x.webp 570w,\n/images/lazyimg/a380_gravitymark_opengl-720x.webp 720w,\n/images/lazyimg/a380_gravitymark_opengl-940x.webp 940w\"\n alt=\"Vulkan performance comparison\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/a380_gravitymark_vulkan-120x%20Gaussian.webp\"\n      \n     height=\"558\" width=\"940\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/a380_gravitymark_vulkan-270x.webp 270w,\n/images/lazyimg/a380_gravitymark_vulkan-420x.webp 420w,\n/images/lazyimg/a380_gravitymark_vulkan-570x.webp 570w,\n/images/lazyimg/a380_gravitymark_vulkan-720x.webp 720w,\n/images/lazyimg/a380_gravitymark_vulkan-940x.webp 940w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/a380_gravitymark_vulkan-940x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"558\" width=\"940\" \n   srcset=\"/images/lazyimg/a380_gravitymark_vulkan-270x.webp 270w,\n/images/lazyimg/a380_gravitymark_vulkan-420x.webp 420w,\n/images/lazyimg/a380_gravitymark_vulkan-570x.webp 570w,\n/images/lazyimg/a380_gravitymark_vulkan-720x.webp 720w,\n/images/lazyimg/a380_gravitymark_vulkan-940x.webp 940w\"\n   alt=\"Vulkan performance comparison\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/a380_gravitymark_vulkan-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/a380_gravitymark_vulkan-940x.webp\"\n  class=\"blur-up lazyload\"\n height=\"558\" width=\"940\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/a380_gravitymark_vulkan-270x.webp 270w,\n/images/lazyimg/a380_gravitymark_vulkan-420x.webp 420w,\n/images/lazyimg/a380_gravitymark_vulkan-570x.webp 570w,\n/images/lazyimg/a380_gravitymark_vulkan-720x.webp 720w,\n/images/lazyimg/a380_gravitymark_vulkan-940x.webp 940w\"\n alt=\"Vulkan performance comparison\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"transcoding-performance\"\u003eTranscoding Performance\u003c/h2\u003e\n\u003cp\u003eTranscoding using HandBrake with the QSV profile wasn\u0026rsquo;t very performant. A 4K test movie averaged about 34FPS.\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/handbrake-120x%20Gaussian.webp\"\n      \n     height=\"495\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/handbrake-220x.webp 220w,\n/images/lazyimg/handbrake-320x.webp 320w,\n/images/lazyimg/handbrake-420x.webp 420w,\n/images/lazyimg/handbrake-520x.webp 520w,\n/images/lazyimg/handbrake-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/handbrake-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"495\" width=\"640\" \n   srcset=\"/images/lazyimg/handbrake-220x.webp 220w,\n/images/lazyimg/handbrake-320x.webp 320w,\n/images/lazyimg/handbrake-420x.webp 420w,\n/images/lazyimg/handbrake-520x.webp 520w,\n/images/lazyimg/handbrake-640x.webp 640w\"\n   alt=\"Intel Arc A380 handbrake qsv performance\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/handbrake-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/handbrake-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"495\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/handbrake-220x.webp 220w,\n/images/lazyimg/handbrake-320x.webp 320w,\n/images/lazyimg/handbrake-420x.webp 420w,\n/images/lazyimg/handbrake-520x.webp 520w,\n/images/lazyimg/handbrake-640x.webp 640w\"\n alt=\"Intel Arc A380 handbrake qsv performance\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\u003c/p\u003e\n\u003cp\u003eOn the other hand, Plex transcoding performance was great. On avg, I achieved about 5x the speed on a 4K-to-4K conversion, 7x on a 4K-to-1080p conversion and 13x on a 1080p-to-1080p conversion. This leaves plenty of room for devices that can\u0026rsquo;t yet play AV1 directly. The results are shown below.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/plex4k-120x%20Gaussian.webp\"\n      \n     height=\"451\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/plex4k-220x.webp 220w,\n/images/lazyimg/plex4k-320x.webp 320w,\n/images/lazyimg/plex4k-420x.webp 420w,\n/images/lazyimg/plex4k-520x.webp 520w,\n/images/lazyimg/plex4k-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/plex4k-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"451\" width=\"640\" \n   srcset=\"/images/lazyimg/plex4k-220x.webp 220w,\n/images/lazyimg/plex4k-320x.webp 320w,\n/images/lazyimg/plex4k-420x.webp 420w,\n/images/lazyimg/plex4k-520x.webp 520w,\n/images/lazyimg/plex4k-640x.webp 640w\"\n   alt=\"Intel Arc A380 plex 4k to 4k performance\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/plex4k-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/plex4k-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"451\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/plex4k-220x.webp 220w,\n/images/lazyimg/plex4k-320x.webp 320w,\n/images/lazyimg/plex4k-420x.webp 420w,\n/images/lazyimg/plex4k-520x.webp 520w,\n/images/lazyimg/plex4k-640x.webp 640w\"\n alt=\"Intel Arc A380 plex 4k to 4k performance\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/plex4k1080p-120x%20Gaussian.webp\"\n      \n     height=\"451\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/plex4k1080p-220x.webp 220w,\n/images/lazyimg/plex4k1080p-320x.webp 320w,\n/images/lazyimg/plex4k1080p-420x.webp 420w,\n/images/lazyimg/plex4k1080p-520x.webp 520w,\n/images/lazyimg/plex4k1080p-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/plex4k1080p-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"451\" width=\"640\" \n   srcset=\"/images/lazyimg/plex4k1080p-220x.webp 220w,\n/images/lazyimg/plex4k1080p-320x.webp 320w,\n/images/lazyimg/plex4k1080p-420x.webp 420w,\n/images/lazyimg/plex4k1080p-520x.webp 520w,\n/images/lazyimg/plex4k1080p-640x.webp 640w\"\n   alt=\"Intel Arc A380 plex 4k to 1080p performance\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/plex4k1080p-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/plex4k1080p-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"451\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/plex4k1080p-220x.webp 220w,\n/images/lazyimg/plex4k1080p-320x.webp 320w,\n/images/lazyimg/plex4k1080p-420x.webp 420w,\n/images/lazyimg/plex4k1080p-520x.webp 520w,\n/images/lazyimg/plex4k1080p-640x.webp 640w\"\n alt=\"Intel Arc A380 plex 4k to 1080p performance\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/plex1080p-120x%20Gaussian.webp\"\n      \n     height=\"451\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/plex1080p-220x.webp 220w,\n/images/lazyimg/plex1080p-320x.webp 320w,\n/images/lazyimg/plex1080p-420x.webp 420w,\n/images/lazyimg/plex1080p-520x.webp 520w,\n/images/lazyimg/plex1080p-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/plex1080p-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"451\" width=\"640\" \n   srcset=\"/images/lazyimg/plex1080p-220x.webp 220w,\n/images/lazyimg/plex1080p-320x.webp 320w,\n/images/lazyimg/plex1080p-420x.webp 420w,\n/images/lazyimg/plex1080p-520x.webp 520w,\n/images/lazyimg/plex1080p-640x.webp 640w\"\n   alt=\"Intel Arc A380 plex 4k to 1080p performance\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/plex1080p-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/plex1080p-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"451\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/plex1080p-220x.webp 220w,\n/images/lazyimg/plex1080p-320x.webp 320w,\n/images/lazyimg/plex1080p-420x.webp 420w,\n/images/lazyimg/plex1080p-520x.webp 520w,\n/images/lazyimg/plex1080p-640x.webp 640w\"\n alt=\"Intel Arc A380 plex 4k to 1080p performance\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"ai-performance\"\u003eAI Performance\u003c/h2\u003e\n\u003cp\u003eFor AI testing, I used an ollama version compiled with a Vulkan backend, built using \u003ca href=\"/blogs/ollama_vulkan_intel/\" target=\"_blank\"\u003ethis guide\u003c/a\u003e. You can find my results below.\u003c/p\u003e\n\u003cp\u003eThe first prompt was a simple \u0026ldquo;hello\u0026rdquo;.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/ollama_hello-120x%20Gaussian.webp\"\n      \n     height=\"469\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ollama_hello-220x.webp 220w,\n/images/lazyimg/ollama_hello-320x.webp 320w,\n/images/lazyimg/ollama_hello-420x.webp 420w,\n/images/lazyimg/ollama_hello-520x.webp 520w,\n/images/lazyimg/ollama_hello-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/ollama_hello-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"469\" width=\"640\" \n   srcset=\"/images/lazyimg/ollama_hello-220x.webp 220w,\n/images/lazyimg/ollama_hello-320x.webp 320w,\n/images/lazyimg/ollama_hello-420x.webp 420w,\n/images/lazyimg/ollama_hello-520x.webp 520w,\n/images/lazyimg/ollama_hello-640x.webp 640w\"\n   alt=\"Intel Arc A380 ollama hello prompt\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/ollama_hello-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/ollama_hello-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"469\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ollama_hello-220x.webp 220w,\n/images/lazyimg/ollama_hello-320x.webp 320w,\n/images/lazyimg/ollama_hello-420x.webp 420w,\n/images/lazyimg/ollama_hello-520x.webp 520w,\n/images/lazyimg/ollama_hello-640x.webp 640w\"\n alt=\"Intel Arc A380 ollama hello prompt\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eThe second prompt was \u0026ldquo;write me a 300 word short story\u0026rdquo;.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/ollama_write-120x%20Gaussian.webp\"\n      \n     height=\"469\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ollama_write-220x.webp 220w,\n/images/lazyimg/ollama_write-320x.webp 320w,\n/images/lazyimg/ollama_write-420x.webp 420w,\n/images/lazyimg/ollama_write-520x.webp 520w,\n/images/lazyimg/ollama_write-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/ollama_write-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"469\" width=\"640\" \n   srcset=\"/images/lazyimg/ollama_write-220x.webp 220w,\n/images/lazyimg/ollama_write-320x.webp 320w,\n/images/lazyimg/ollama_write-420x.webp 420w,\n/images/lazyimg/ollama_write-520x.webp 520w,\n/images/lazyimg/ollama_write-640x.webp 640w\"\n   alt=\"Intel Arc A380 ollama write prompt\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/ollama_write-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/ollama_write-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"469\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ollama_write-220x.webp 220w,\n/images/lazyimg/ollama_write-320x.webp 320w,\n/images/lazyimg/ollama_write-420x.webp 420w,\n/images/lazyimg/ollama_write-520x.webp 520w,\n/images/lazyimg/ollama_write-640x.webp 640w\"\n alt=\"Intel Arc A380 ollama write prompt\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eFor the third prompt, I pasted a different short story and asked it comprehension questions.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/ollama_analyze-120x%20Gaussian.webp\"\n      \n     height=\"469\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ollama_analyze-220x.webp 220w,\n/images/lazyimg/ollama_analyze-320x.webp 320w,\n/images/lazyimg/ollama_analyze-420x.webp 420w,\n/images/lazyimg/ollama_analyze-520x.webp 520w,\n/images/lazyimg/ollama_analyze-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/ollama_analyze-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"469\" width=\"640\" \n   srcset=\"/images/lazyimg/ollama_analyze-220x.webp 220w,\n/images/lazyimg/ollama_analyze-320x.webp 320w,\n/images/lazyimg/ollama_analyze-420x.webp 420w,\n/images/lazyimg/ollama_analyze-520x.webp 520w,\n/images/lazyimg/ollama_analyze-640x.webp 640w\"\n   alt=\"Intel Arc A380 ollama analyze prompt\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/ollama_analyze-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/ollama_analyze-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"469\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ollama_analyze-220x.webp 220w,\n/images/lazyimg/ollama_analyze-320x.webp 320w,\n/images/lazyimg/ollama_analyze-420x.webp 420w,\n/images/lazyimg/ollama_analyze-520x.webp 520w,\n/images/lazyimg/ollama_analyze-640x.webp 640w\"\n alt=\"Intel Arc A380 ollama analyze prompt\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"end\"\u003eEnd\u003c/h2\u003e\n\u003cp\u003eThe Intel Arc A380 hasn\u0026rsquo;t disappointed me, even with ReBAR disabled. I\u0026rsquo;m also able to stream games through Sunshine and play at a comfortable framerate. I\u0026rsquo;d recommend anyone looking to get AV1 support at a reasonable price to still consider purchasing an Intel Arc GPU, even if your motherboard doesn\u0026rsquo;t support ReBAR.\u003c/p\u003e\n\u003cp\u003eKeep in mind that synthetic benchmarks rarely reflect real-world usage.\u003c/p\u003e\n","description":"Intel Arc A380 with ReBar disabled on a Dell Poweredge T440.","image":"images/gpu_install_t440.webp","permalink":"https://kovasky.me/blogs/intel_arc_no_rebar/","title":"Intel Arc A380 performance benchmark with no Resizable BAR in a Dell Poweredge T440"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI have an Intel Arc A380 in my Dell T440 server for Plex and remote gaming through Sunshine. I set up \u003ca href=\"https://hoarder.app\"\u003eHoarder\u003c/a\u003e and wanted a way to use the AI features without paying for OpenAI tokens. This proved extremely difficult, as none of the readily available solutions seemed to work.\u003c/p\u003e\n\u003cp\u003eThis was until I tried LMStudio. LMStudio worked out of the box, but launching it in a headless manner on boot is not possible (at least for me), not to mention the incompatibility of its OpenAPI implementation with Hoarder. I later learned that LMStudio uses a vulkan backend, and went on a quest to find an ollama version with vulkan support.\u003c/p\u003e\n\u003cp\u003eOllama does not currently support Vulkan and it looks like it won\u0026rsquo;t any time soon, (read about that \u003ca href=\"https://github.com/ollama/ollama/pull/5059#issuecomment-2629465081\"\u003ehere\u003c/a\u003e) but there is an actively developed fork  by \u003ca href=\"https://github.com/whyvl\"\u003e@Whyvl\u003c/a\u003e, \u003ca href=\"https://github.com/whyvl/ollama-vulkan\"\u003eollama-vulkan\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eBelow are the steps needed to build and run ollama with a vulkan backend.\u003c/p\u003e\n\u003ch2 id=\"pre-requisites\"\u003ePre-requisites\u003c/h2\u003e\n\u003cp\u003eI used an Ubuntu 24.04 (Noble Numbat) host, so your mileage may vary under different distros.\u003c/p\u003e\n\u003cp\u003eTo install the required packages, issue the following commands:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt install git cmake wget libcap-dev golang-go \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo install the vulkan-sdk, you need to run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewget -qO- https://packages.lunarg.com/lunarg-signing-key-pub.asc | sudo tee /etc/apt/trusted.gpg.d/lunarg.asc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo wget -qO /etc/apt/sources.list.d/lunarg-vulkan-noble.list http://packages.lunarg.com/vulkan/lunarg-vulkan-noble.list\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt install vulkan-sdk\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou also need this file: \u003ca href=\"https://github.com/user-attachments/files/18783263/0002-fix-fix-vulkan-building.patch\" target=\"_blank\"\u003efix-vulkan-building.patch\u003c/a\u003e. Save it somewhere easily accessible (like your downloads folder).\u003c/p\u003e\n\u003ch2 id=\"setting-up-the-repo\"\u003eSetting up the repo\u003c/h2\u003e\n\u003cp\u003eNext, you need to set up the repositories and apply the patch you downloaded. Use:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit clone -b vulkan https://github.com/whyvl/ollama-vulkan.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd ollama-vulkan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit remote add ollama_vanilla https://github.com/ollama/ollama.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit fetch ollama_vanilla --tags\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# the latest release as of now is 0.5.11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit checkout tags/v0.5.11 -b ollama_vanilla_stable\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit checkout vulkan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit merge ollama_vanilla_stable --allow-unrelated-histories --no-edit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epatch -p1 -N \u0026lt; \u0026lt;path to patch file\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"building-ollama\"\u003eBuilding Ollama\u003c/h2\u003e\n\u003cp\u003eAfter downloading the repo and applying the patches, its time to build!\u003c/p\u003e\n\u003cp\u003eRun:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake -f Makefile.sync clean sync\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# CPU libraries\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --preset CPU\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --build --parallel --preset CPU\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --install build --component CPU --strip\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Vulkan libraries\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --preset Vulkan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --build --parallel --preset Vulkan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --install build --component Vulkan --strip\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Binary\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esource scripts/env.sh \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e true\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir -p dist/bin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego build -trimpath -buildmode\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epie -o dist/bin/ollama .\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce the build is finished, run the server with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eOLLAMA_HOST\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e0.0.0.0:11434 ./dist/bin/ollama serve\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf you get the error \u0026ldquo;Please enable CAP_PERFMON or run as root to use Vulkan.\u0026rdquo;, you have to run the binary as root.\u003c/p\u003e\n\u003ch2 id=\"automated-script\"\u003eAutomated Script\u003c/h2\u003e\n\u003cp\u003eIf you donâ€™t want to run all the steps manually, you can use this script:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport CGO_ENABLED\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport LDFLAGS\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e-s\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Pre-requisites\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewget -qO- https://packages.lunarg.com/lunarg-signing-key-pub.asc | sudo tee /etc/apt/trusted.gpg.d/lunarg.asc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo wget -qO /etc/apt/sources.list.d/lunarg-vulkan-noble.list http://packages.lunarg.com/vulkan/lunarg-vulkan-noble.list\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt install -y git vulkan-sdk cmake wget libcap-dev golang-go \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir -p /tmp/patches\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewget -O /tmp/patches/0002-fix-fix-vulkan-building.patch https://github.com/user-attachments/files/18783263/0002-fix-fix-vulkan-building.patch\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Downloading repos and applying patches\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Cloning and setting up ollama-vulkan repository...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eREPO_DIR\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/tmp/ollama-vulkan-git\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erm -rf \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eREPO_DIR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e 2\u0026gt;/dev/null \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e true\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit clone -b vulkan https://github.com/whyvl/ollama-vulkan.git \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eREPO_DIR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eREPO_DIR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit remote add ollama_vanilla https://github.com/ollama/ollama.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit fetch ollama_vanilla --tags\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit checkout tags/v0.5.11 -b ollama_vanilla_stable\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit checkout vulkan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit merge ollama_vanilla_stable --allow-unrelated-histories --no-edit\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epatch -p1 -N \u0026lt; /tmp/patches/0002-fix-fix-vulkan-building.patch\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake -f Makefile.sync clean sync\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Building\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Building CPU variant...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --preset CPU\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --build --parallel --preset CPU\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --install build --component CPU --strip\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Building Vulkan variant...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --preset Vulkan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --build --parallel --preset Vulkan\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecmake --install build --component Vulkan --strip\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Building final ollama binary...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecd \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eREPO_DIR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esource scripts/env.sh \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e true\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir -p dist/bin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ego build -trimpath -buildmode\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epie -o dist/bin/ollama .\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Done!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Build completed.\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;CPU libraries are in:      \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eREPO_DIR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/dist/lib/ollama\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Vulkan libraries are in:   \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eREPO_DIR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/dist/lib/ollama/vulkan\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ollama binary is in:       \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eREPO_DIR\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/dist/bin/ollama\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eYou should now be able to load models using vulkan, leveraging your Intel GPU.\u003c/p\u003e\n\u003ch2 id=\"resources\"\u003eResources\u003c/h2\u003e\n\u003cp\u003eSpecial thanks to \u003ca href=\"https://github.com/McBane87\"\u003e@McBane87\u003c/a\u003e for a DockerFile that helped me build the project locally and to \u003ca href=\"https://github.com/Dts0\"\u003e@Dts0\u003c/a\u003e for the patch.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/whyvl/ollama-vulkan\" target=\"_blank\"\u003eollama-vulkan\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/whyvl/ollama-vulkan/issues/7\" target=\"_blank\"\u003eollama-vulkan/issues/7\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/ollama/ollama\" target=\"_blank\"\u003eollama\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/ollama/ollama/pull/5059\" target=\"_blank\"\u003eollama/pull/5059\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","description":"Build and run ollama with vulkan support to enable local inference on Intel Arc GPUs.","image":"images/ollama_service.webp","permalink":"https://kovasky.me/blogs/ollama_vulkan_intel/","title":"Build and run ollama with vulkan support to enable local inference on Intel Arc GPUs"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI was tired of entering my password every time I SSH\u0026rsquo;d to my VMs, but setting up SSH keys would mean manually copying my public key to each host I wanted to connect to. I then read about one key feature of FreeIPA, which is serving as a centralized key repository.\u003c/p\u003e\n\u003cp\u003eThis posed another problem: I donâ€™t have any users in FreeIPA, as I mainly use my AD credentials (FreeIPA is one way only, and many services interact directly with Active Directory). Hereâ€™s how I generated and stored my AD userâ€™s public key in FreeIPA, which allows me to remote into any enrolled device without manually distributing the keys.\u003c/p\u003e\n\u003ch2 id=\"pre-requisite\"\u003ePre-requisite\u003c/h2\u003e\n\u003cp\u003eTo store public keys for AD users, an external trust must be configured. You can check out my instructions to configure that \u003ca href=\"https://kovasky.me/blogs/ad_trust\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"creating-the-key-pair\"\u003eCreating the key pair\u003c/h2\u003e\n\u003cp\u003eTo start the key pair generation, you can issue the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh-keygen -o\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will prompt you if you want to change the default file name, \u003ccode\u003e~/.ssh/id_rsa\u003c/code\u003e, and if you want to add a passphrase. If you choose the defaults, the public key will be located at \u003ccode\u003e~/.ssh/id_rsa.pub\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eAlternatively, for added security, you can use a hardware key (like a Yubikey or, in my case, a Thetis). After plugging in your key, you can issue the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003essh-keygen -t ecdsa-sk -f ~/.ssh/id_ecdsa_sk -C \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;user@domain\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will create an ecdsa-sk key and store the private key in your FIDO authenticator. The \u003ccode\u003e-C\u003c/code\u003e option is used to specify a comment, typically the username associated with the key. Your public key will be located at \u003ccode\u003e~/.ssh/id_ecdsa_sk.pub\u003c/code\u003e. It is highly recommended to have a secondary hardware key kept in a secure place, in case your main one gets misplaced.\u003c/p\u003e\n\u003cp\u003eAfter you\u0026rsquo;ve created your key pair, do a \u003ccode\u003ecat ~/.ssh/\u0026lt;key\u0026gt;.pub\u003c/code\u003e and copy the output. This text will be copied into FreeIPA in the next section.\u003c/p\u003e\n\u003ch2 id=\"adding-the-ssh-key-to-freeipa\"\u003eAdding the SSH key to FreeIPA\u003c/h2\u003e\n\u003cp\u003eLog in to the web portal of your FreeIPA instance as an administrator. Navigate to Identity -\u0026gt; ID Views -\u0026gt; Default Trust View.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/default_trust_view-120x%20Gaussian.webp\"\n      \n     height=\"567\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/default_trust_view-220x.webp 220w,\n/images/lazyimg/default_trust_view-320x.webp 320w,\n/images/lazyimg/default_trust_view-420x.webp 420w,\n/images/lazyimg/default_trust_view-520x.webp 520w,\n/images/lazyimg/default_trust_view-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/default_trust_view-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"567\" width=\"640\" \n   srcset=\"/images/lazyimg/default_trust_view-220x.webp 220w,\n/images/lazyimg/default_trust_view-320x.webp 320w,\n/images/lazyimg/default_trust_view-420x.webp 420w,\n/images/lazyimg/default_trust_view-520x.webp 520w,\n/images/lazyimg/default_trust_view-640x.webp 640w\"\n   alt=\"FreeIPA Default Trust View\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/default_trust_view-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/default_trust_view-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"567\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/default_trust_view-220x.webp 220w,\n/images/lazyimg/default_trust_view-320x.webp 320w,\n/images/lazyimg/default_trust_view-420x.webp 420w,\n/images/lazyimg/default_trust_view-520x.webp 520w,\n/images/lazyimg/default_trust_view-640x.webp 640w\"\n alt=\"FreeIPA Default Trust View\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eHere, you will click Add and fill out your \u003ccode\u003eusername@domain\u003c/code\u003e as well as paste the previously copied key into the SSH public key field. Then click on Add. This will create your user entry.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/adding_key-120x%20Gaussian.webp\"\n      \n     height=\"567\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/adding_key-220x.webp 220w,\n/images/lazyimg/adding_key-320x.webp 320w,\n/images/lazyimg/adding_key-420x.webp 420w,\n/images/lazyimg/adding_key-520x.webp 520w,\n/images/lazyimg/adding_key-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/adding_key-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"567\" width=\"640\" \n   srcset=\"/images/lazyimg/adding_key-220x.webp 220w,\n/images/lazyimg/adding_key-320x.webp 320w,\n/images/lazyimg/adding_key-420x.webp 420w,\n/images/lazyimg/adding_key-520x.webp 520w,\n/images/lazyimg/adding_key-640x.webp 640w\"\n   alt=\"Adding an external user and a public key to FreeIPA\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/adding_key-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/adding_key-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"567\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/adding_key-220x.webp 220w,\n/images/lazyimg/adding_key-320x.webp 320w,\n/images/lazyimg/adding_key-420x.webp 420w,\n/images/lazyimg/adding_key-520x.webp 520w,\n/images/lazyimg/adding_key-640x.webp 640w\"\n alt=\"Adding an external user and a public key to FreeIPA\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eClick on the user; it should look something like this:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/key_added-120x%20Gaussian.webp\"\n      \n     height=\"567\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/key_added-220x.webp 220w,\n/images/lazyimg/key_added-320x.webp 320w,\n/images/lazyimg/key_added-420x.webp 420w,\n/images/lazyimg/key_added-520x.webp 520w,\n/images/lazyimg/key_added-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/key_added-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"567\" width=\"640\" \n   srcset=\"/images/lazyimg/key_added-220x.webp 220w,\n/images/lazyimg/key_added-320x.webp 320w,\n/images/lazyimg/key_added-420x.webp 420w,\n/images/lazyimg/key_added-520x.webp 520w,\n/images/lazyimg/key_added-640x.webp 640w\"\n   alt=\"FreeIPA user profile after adding a public SSH key\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/key_added-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/key_added-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"567\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/key_added-220x.webp 220w,\n/images/lazyimg/key_added-320x.webp 320w,\n/images/lazyimg/key_added-420x.webp 420w,\n/images/lazyimg/key_added-520x.webp 520w,\n/images/lazyimg/key_added-640x.webp 640w\"\n alt=\"FreeIPA user profile after adding a public SSH key\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"testing-out-the-connection\"\u003eTesting out the connection\u003c/h2\u003e\n\u003cp\u003eNow, all that is left to do is to open a terminal and SSH to your FreeIPA-enrolled host as your user. If you use a hardware key, it will prompt you to press the button in your security key; otherwise, it will just log in automatically.\u003c/p\u003e\n","description":"Set up centralized SSH key storage for external Active Directory users in FreeIPA (including FIDO2 hardware keys).","image":"images/profile_key_added.webp","permalink":"https://kovasky.me/blogs/ad_trust_ssh/","title":"Set up centralized SSH key storage for external Active Directory users in FreeIPA (including FIDO2 hardware keys)"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI set up scrutiny to monitor the drives in my Proxmox host. I like having access to all the SMART data in my drives in one single spot, so I decided to include my NAS\u0026rsquo; drives as well. This is how I did it.\u003c/p\u003e\n\u003ch2 id=\"pre-requisites\"\u003ePre-requisites\u003c/h2\u003e\n\u003cp\u003eScrutiny depends on smartctl v7+ which, unfortunately, my NAS did not have. To check the version of smartctl that your NAS has installed, SSH into it and issue the command \u003ccode\u003e/usr/bin/smartctl -i\u003c/code\u003e. If your smartctl version is lower than 7, you will need to install Entware. For instructions to do so, please visit this \u003ca href=\"https://github.com/Entware/Entware/wiki/Install-on-Synology-NAS\"\u003elink\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"installing-an-updated-version-of-smartctl\"\u003eInstalling an updated version of smartctl\u003c/h2\u003e\n\u003cp\u003eTo install an updated version of smartctl, SSH into your NAS and as root execute the command \u003ccode\u003eopkg install smartmontools\u003c/code\u003e. After this, you will find smartctl under \u003ccode\u003e/opt/sbin/smartctl\u003c/code\u003e. You can call it with the -i flag to make sure the version installed is at least 7.\u003c/p\u003e\n\u003ch2 id=\"downloading-the-collector\"\u003eDownloading the collector\u003c/h2\u003e\n\u003cp\u003eTo download the latest binary, you can head over \u003ca href=\"https://github.com/AnalogJ/scrutiny/releases/\"\u003ehere\u003c/a\u003e and copy the link for the appropriate architecture. To find your architecture, you can issue the command \u003ccode\u003euname -m\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eAfter copying the link, SSH back into your NAS. Create the appropriate folder structure, like \u003ccode\u003e/opt/scrutiny/bin\u003c/code\u003e. Keep in mind that if you have not installed Entware, your \u003ccode\u003e/opt\u003c/code\u003e directory may get overwritten with future system updates. Now, cd into the newly created directory and issue the command \u003ccode\u003ewget \u0026lt;binary link\u0026gt;\u003c/code\u003e. After its downloaded, you should give it the appropraite permissions by executing \u003ccode\u003echmod +x \u0026lt;binary\u0026gt;\u003c/code\u003e. You may need to issue these commands as root.\u003c/p\u003e\n\u003ch2 id=\"configuration-file\"\u003eConfiguration file\u003c/h2\u003e\n\u003cp\u003eYou will need to create a configuration file, \u003ccode\u003ecollector.yaml\u003c/code\u003e, inside \u003ccode\u003e/opt/scrutiny/config\u003c/code\u003e. This is to replace which smartctl binary will be used, as the one shipped with DSM lives under \u003ccode\u003e/sbin\u003c/code\u003e and the one installed by Entware is under \u003ccode\u003e/opt\u003c/code\u003e. You can take a look at all the configuraiton options in the example configuration \u003ca href=\"https://github.com/AnalogJ/scrutiny/blob/master/example.collector.yaml\"\u003ehere\u003c/a\u003e. My configuration looks like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eversion: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ehost:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  id: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;nas\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eapi:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e endpoint: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;http://\u0026lt;master ip\u0026gt;:\u0026lt;port\u0026gt;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecommands:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  metrics_smartctl_bin: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/opt/sbin/smartctl\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou can test your configuration by executing the command \u003ccode\u003e/opt/scrutiny/bin/\u0026lt;collector binary\u0026gt; run --config /opt/scrutiny/config/collector.yaml\u003c/code\u003e. If everything was set up correctly, your device should appear in the scrutiny dashboard.\u003c/p\u003e\n\u003ch2 id=\"setting-up-the-scheduled-task\"\u003eSetting up the scheduled task\u003c/h2\u003e\n\u003cp\u003eEnter the WEB GUI and navigate to Control Panel -\u0026gt; Task Scheduler. In here select Create -\u0026gt; Scheduled Task -\u0026gt; User-defined script. Under General, name it something like \u0026ldquo;scrutiny\u0026rdquo; and make sure enabled is checked. Under Schedule, make sure its run daily and its run every 15 minutes. Under task settings, paste the following in the command textbox.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e. /opt/etc/profile; /opt/scrutiny/bin/\u0026lt;collector binary\u0026gt; run --config /opt/scrutiny/config/collector.yaml\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYour settings should look like:\u003c/p\u003e\n\u003cp\u003e\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/task1-120x%20Gaussian.webp\"\n      \n     height=\"584\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/task1-220x.webp 220w,\n/images/lazyimg/task1-320x.webp 320w,\n/images/lazyimg/task1-420x.webp 420w,\n/images/lazyimg/task1-520x.webp 520w,\n/images/lazyimg/task1-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/task1-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"584\" width=\"640\" \n   srcset=\"/images/lazyimg/task1-220x.webp 220w,\n/images/lazyimg/task1-320x.webp 320w,\n/images/lazyimg/task1-420x.webp 420w,\n/images/lazyimg/task1-520x.webp 520w,\n/images/lazyimg/task1-640x.webp 640w\"\n   alt=\"General settings of a scheduled task in Synology DSM\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/task1-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/task1-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"584\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/task1-220x.webp 220w,\n/images/lazyimg/task1-320x.webp 320w,\n/images/lazyimg/task1-420x.webp 420w,\n/images/lazyimg/task1-520x.webp 520w,\n/images/lazyimg/task1-640x.webp 640w\"\n alt=\"General settings of a scheduled task in Synology DSM\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/task2-120x%20Gaussian.webp\"\n      \n     height=\"587\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/task2-220x.webp 220w,\n/images/lazyimg/task2-320x.webp 320w,\n/images/lazyimg/task2-420x.webp 420w,\n/images/lazyimg/task2-520x.webp 520w,\n/images/lazyimg/task2-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/task2-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"587\" width=\"640\" \n   srcset=\"/images/lazyimg/task2-220x.webp 220w,\n/images/lazyimg/task2-320x.webp 320w,\n/images/lazyimg/task2-420x.webp 420w,\n/images/lazyimg/task2-520x.webp 520w,\n/images/lazyimg/task2-640x.webp 640w\"\n   alt=\"Schedule settings of a scheduled task in Synology DSM\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/task2-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/task2-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"587\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/task2-220x.webp 220w,\n/images/lazyimg/task2-320x.webp 320w,\n/images/lazyimg/task2-420x.webp 420w,\n/images/lazyimg/task2-520x.webp 520w,\n/images/lazyimg/task2-640x.webp 640w\"\n alt=\"Schedule settings of a scheduled task in Synology DSM\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/task3-120x%20Gaussian.webp\"\n      \n     height=\"587\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/task3-220x.webp 220w,\n/images/lazyimg/task3-320x.webp 320w,\n/images/lazyimg/task3-420x.webp 420w,\n/images/lazyimg/task3-520x.webp 520w,\n/images/lazyimg/task3-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/task3-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"587\" width=\"640\" \n   srcset=\"/images/lazyimg/task3-220x.webp 220w,\n/images/lazyimg/task3-320x.webp 320w,\n/images/lazyimg/task3-420x.webp 420w,\n/images/lazyimg/task3-520x.webp 520w,\n/images/lazyimg/task3-640x.webp 640w\"\n   alt=\"Task settings of a scheduled task in Synology DSM\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/task3-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/task3-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"587\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/task3-220x.webp 220w,\n/images/lazyimg/task3-320x.webp 320w,\n/images/lazyimg/task3-420x.webp 420w,\n/images/lazyimg/task3-520x.webp 520w,\n/images/lazyimg/task3-640x.webp 640w\"\n alt=\"Task settings of a scheduled task in Synology DSM\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce everything is set up, the collector installed in your NAS will update your server with smart data every 15 minutes.\u003c/p\u003e\n","description":"Install the scrutiny collector in a Synology NAS to view historical trends in your drives' health.","image":"images/scrutiny.webp","permalink":"https://kovasky.me/blogs/synology_scrutiny/","title":"Install the scrutiny collector in a Synology NAS to view historical trends in your drives' health"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eMy Synology NAS sends weekly (quick tests) and monthly (extended tests) health reports of its hard drives to my email. I wanted to add this functionality to my Proxmox server to keep an eye on my drives. After some trial and error, I successfully achieved this functionality. Now, I receive these notifications on my phone with the help of ntfy.sh. Here are the steps I took to make it work.\u003c/p\u003e\n\u003ch2 id=\"pre-requisites\"\u003ePre-requisites\u003c/h2\u003e\n\u003cp\u003eFor this setup to work, you should have a running instance of ntfy.sh. You can find the installation instructions \u003ca href=\"https://docs.ntfy.sh/install/\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eMy compose file looks something like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003entfy\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebinwiederhier/ntfy:latest\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003entfy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ecommand\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eserve\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e3780\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e80\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eTZ\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eCanada/Toronto\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_BASE_URL\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ehttps://ntfy.\u0026lt;domain\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_UPSTREAM_BASE_URL\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ehttps://ntfy.sh\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_CACHE_FILE\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e/var/lib/ntfy/cache.db\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_AUTH_FILE\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e/var/lib/ntfy/auth.db\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_AUTH_DEFAULT_ACCESS\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003edeny-all\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_BEHIND_PROXY\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_ATTACHMENT_CACHE_DIR\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e/var/lib/ntfy/attachments\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_ENABLE_LOGIN\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_SMTP_SERVER_LISTEN\u003c/span\u003e: :\u003cspan style=\"color:#ae81ff\"\u003e25\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eNTFY_SMTP_SERVER_DOMAIN\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;domain\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003elib:/var/lib/ntfy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ecache:/var/cache/ntfy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eetc:/etc/ntfy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003elib\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ecache\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eetc\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou will need a topic to which you can subscribe and an API token. Make sure to keep them handy, as they will be needed when configuring notifications in Proxmox.\u003c/p\u003e\n\u003ch2 id=\"configuring-postfix\"\u003eConfiguring Postfix\u003c/h2\u003e\n\u003cp\u003eProxmox can dispatch notifications straight to email. To make use of it, you would be required to use a dedicated email account from a provider like Google, use third party services like smtp2go, or even set up your own mail server.\u003c/p\u003e\n\u003cp\u003eLuckily, Proxmox comes with Postfix, a mail transfer agent, pre-installed. We can configure Postfix to forward emails to ntfy.sh, where emails will be processed and pushed to your mobile devices. To do this, you need to modify the configuration file \u003ccode\u003e/etc/postfix/main.cf\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eLocate the line with \u003ccode\u003erelayhost =\u003c/code\u003e, or if it doesn\u0026rsquo;t exist, insert it at the end of the file and specify the ntfy.sh host with its SMTP port. It should look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erelayhost \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u0026lt;ntfy.sh IP or Hostname\u0026gt;:\u0026lt;SMTP PORT\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen the changes are made, you can restart it by issuing the command \u003ccode\u003esystemctl restart postfix\u003c/code\u003e. Now all emails coming from Proxmox will use ntfy.sh as their server.\u003c/p\u003e\n\u003ch2 id=\"configuring-smartd\"\u003eConfiguring smartd\u003c/h2\u003e\n\u003cp\u003eProxmox comes with smartmontools pre-installed. This package contains the smartd utility which you\u0026rsquo;ll use for monitoring and reporting on the health of your installed drives. The configuration file is located at \u003ccode\u003e/etc/smartd.conf\u003c/code\u003e. You can read about smartd and its directives \u003ca href=\"https://linux.die.net/man/5/smartd.conf\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eYou can either list your drives one by one or let smartd detect them by using the DEVICESCAN directive. My file looks something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDEVICESCAN -H -f -u -p -l error -l selftest -n standby,24,q \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-I \u003cspan style=\"color:#ae81ff\"\u003e194\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-I \u003cspan style=\"color:#ae81ff\"\u003e190\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-W 5,55,60 \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-i \u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-R 5! \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-C \u003cspan style=\"color:#ae81ff\"\u003e197\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-U \u003cspan style=\"color:#ae81ff\"\u003e198\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-o on -S on -s \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eS/../../../02|L/../01/./04\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-m \u0026lt;topic\u0026gt;+\u0026lt;key\u0026gt;@\u0026lt;domain\u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-M test \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-M exec /usr/share/smartmontools/smartd-runner\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe most important lines are:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e-o on -S on -s \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eS/../../../02|L/../01/./04\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e-m \u0026lt;topic\u0026gt;+\u0026lt;key\u0026gt;@\u0026lt;domain\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003e-o\u003c/code\u003e line tells smartd to run short tests every day at 2 am and an extended test on the first day of every month at 4 am. The \u003ccode\u003e-m\u003c/code\u003e line tells smartd to send notifications to an email. This email address must follow the format: the topic you created in the pre-requisite step + the token @ the domain you assigned to ntfy.sh.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eProxmox will now send SMART notifications to your ntfy.sh server, which will then forward them to your phone.\u003c/p\u003e\n\u003cp\u003eNote: Since you\u0026rsquo;ve configured your ntfy.sh server as your relay server, other notifications, such as those from backup tasks, will also be sent to ntfy.sh and pushed to your phone when configured with the appropriate topic+token@domain.\u003c/p\u003e\n","description":"Set up scheduled SMART tests on Proxmox and send alerts via push notifications to your mobile phone with ntfy.sh.","image":"images/ntfy_app.webp","permalink":"https://kovasky.me/blogs/proxmox_ntfy/","title":"Set up scheduled SMART tests on Proxmox and send alerts via push notifications to your mobile phone"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eEvery now and again I would wake up to my internet being down while my local network being fine. This usually happened when my ISP renewed my assigned IP overnight. The only solution was to reboot my pfSense VM to force the IP lease renewal. Searching the web I discovered it was not uncommon for people to experience this with certain types of modems and virtualized pfSense instances. Here\u0026rsquo;s how I resolved it in my homelab.\u003c/p\u003e\n\u003ch2 id=\"wan-renew-script\"\u003eWAN renew script\u003c/h2\u003e\n\u003cp\u003eIn your pfSense instance, create a file named wan_renew.sh in /usr/local/sbin with the contents below and make it executable. This script pings two external IPs, and if 50% of them fail, it renews the lease on the WAN interface:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eIP1\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;8.8.8.8\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eIP2\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1.1.1.1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLOGFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/var/log/wan_renew.log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eping_test\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local ip\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e$1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local count\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eping -c \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e $ip | awk -F\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;, \u0026#39;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/received/ {print $2}\u0026#39;\u003c/span\u003e | awk \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{print $1}\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e $count -lt \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e ! ping_test $IP1 \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e ! ping_test $IP2; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Replace vtnet0 with your WAN interface\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    /usr/local/sbin/dhclient -4 -d -r -lf /var/db/dhclient.leases.vtnet0 -cf /var/etc/dhclient_wan.conf -sf /usr/local/sbin/pfSense-dhclient-script\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    php -r \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;require \u0026#39;interfaces.inc\u0026#39;; interface_bring_down(\u0026#39;wan\u0026#39;); interface_configure(\u0026#39;wan\u0026#39;);\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    echo \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003edate\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e: Pings to \u003c/span\u003e$IP1\u003cspan style=\"color:#e6db74\"\u003e and \u003c/span\u003e$IP2\u003cspan style=\"color:#e6db74\"\u003e failed. Lease on wan vtnet0 has been renewed.\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; $LOGFILE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"adding-the-script-to-the-cron-service\"\u003eAdding the script to the cron service\u003c/h2\u003e\n\u003cp\u003eEnsure the cron package installed. Navigate to Services-\u0026gt;Cron and click on Add. Set the settings as shown in the cover picture at the top of this page.\u003c/p\u003e\n\u003ch2 id=\"all-done\"\u003eAll done!\u003c/h2\u003e\n\u003cp\u003eAfter applying all settings, your WAN lease should be automatically renewed without having to restart your firewall.\u003c/p\u003e\n","description":"Automatically renew WAN lease on pfSense without rebooting.","image":"images/pfsense_cron.webp","permalink":"https://kovasky.me/blogs/pfsense_wan_update/","title":"Automatically renew WAN lease on pfSense without rebooting"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI recently acquired a second domain for one of my projects and wanted to set this up behind the HAProxy instance in my firewall. The problem was that I was already serving my primary domain with it, so I was looking to serve my secondary one as well. It was not as straightforward as I thought but after a bit of Googling and some trial and error, I could proxy multiple domains sharing the same public IP. Here\u0026rsquo;s how I did it!\u003c/p\u003e\n\u003ch2 id=\"create-a-shared-frontend\"\u003eCreate a shared frontend\u003c/h2\u003e\n\u003cp\u003eIn the HAProxy Frontend settings, create a new front end with the name shared_frontend; status Active; external address to WAN address, port to 443, and tick SSL Offloading. The type should be http / https (offloading). It should look as follows:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/shared_frontend-120x%20Gaussian.webp\"\n      \n     height=\"470\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/shared_frontend-220x.webp 220w,\n/images/lazyimg/shared_frontend-320x.webp 320w,\n/images/lazyimg/shared_frontend-420x.webp 420w,\n/images/lazyimg/shared_frontend-520x.webp 520w,\n/images/lazyimg/shared_frontend-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/shared_frontend-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"470\" width=\"640\" \n   srcset=\"/images/lazyimg/shared_frontend-220x.webp 220w,\n/images/lazyimg/shared_frontend-320x.webp 320w,\n/images/lazyimg/shared_frontend-420x.webp 420w,\n/images/lazyimg/shared_frontend-520x.webp 520w,\n/images/lazyimg/shared_frontend-640x.webp 640w\"\n   alt=\"Shared Frontend creation page\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/shared_frontend-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/shared_frontend-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"470\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/shared_frontend-220x.webp 220w,\n/images/lazyimg/shared_frontend-320x.webp 320w,\n/images/lazyimg/shared_frontend-420x.webp 420w,\n/images/lazyimg/shared_frontend-520x.webp 520w,\n/images/lazyimg/shared_frontend-640x.webp 640w\"\n alt=\"Shared Frontend creation page\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eScroll down to the SSL Offloading section and select your default certificate. Include SNI filters like \u0026ldquo;*.mydomain.com !mydomain2.com\u0026rdquo; to apply the correct certificate for each domain. In the Additional certificates setting, add your secondary domain certificate. Make sure that the Add ACL option is checked for both of them. It should look like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/ssl_offloading-120x%20Gaussian.webp\"\n      \n     height=\"507\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ssl_offloading-220x.webp 220w,\n/images/lazyimg/ssl_offloading-320x.webp 320w,\n/images/lazyimg/ssl_offloading-420x.webp 420w,\n/images/lazyimg/ssl_offloading-520x.webp 520w,\n/images/lazyimg/ssl_offloading-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/ssl_offloading-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"507\" width=\"640\" \n   srcset=\"/images/lazyimg/ssl_offloading-220x.webp 220w,\n/images/lazyimg/ssl_offloading-320x.webp 320w,\n/images/lazyimg/ssl_offloading-420x.webp 420w,\n/images/lazyimg/ssl_offloading-520x.webp 520w,\n/images/lazyimg/ssl_offloading-640x.webp 640w\"\n   alt=\"Applying a SNI filter to the shared frontend\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/ssl_offloading-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/ssl_offloading-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"507\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ssl_offloading-220x.webp 220w,\n/images/lazyimg/ssl_offloading-320x.webp 320w,\n/images/lazyimg/ssl_offloading-420x.webp 420w,\n/images/lazyimg/ssl_offloading-520x.webp 520w,\n/images/lazyimg/ssl_offloading-640x.webp 640w\"\n alt=\"Applying a SNI filter to the shared frontend\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eAll other settings can be left as defaults.\u003c/p\u003e\n\u003ch2 id=\"create-your-secondary-frontends\"\u003eCreate your secondary frontends\u003c/h2\u003e\n\u003cp\u003eCreate two frontends for each domain and attach the corresponding ACLs and Actions. Click Shared Frontend and set the Primary frontend to the shared_frontend created in the previous step. This looks like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/secondary_frontend-120x%20Gaussian.webp\"\n      \n     height=\"289\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/secondary_frontend-220x.webp 220w,\n/images/lazyimg/secondary_frontend-320x.webp 320w,\n/images/lazyimg/secondary_frontend-420x.webp 420w,\n/images/lazyimg/secondary_frontend-520x.webp 520w,\n/images/lazyimg/secondary_frontend-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/secondary_frontend-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"289\" width=\"640\" \n   srcset=\"/images/lazyimg/secondary_frontend-220x.webp 220w,\n/images/lazyimg/secondary_frontend-320x.webp 320w,\n/images/lazyimg/secondary_frontend-420x.webp 420w,\n/images/lazyimg/secondary_frontend-520x.webp 520w,\n/images/lazyimg/secondary_frontend-640x.webp 640w\"\n   alt=\"Creating a secondary frontend\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/secondary_frontend-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/secondary_frontend-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"289\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/secondary_frontend-220x.webp 220w,\n/images/lazyimg/secondary_frontend-320x.webp 320w,\n/images/lazyimg/secondary_frontend-420x.webp 420w,\n/images/lazyimg/secondary_frontend-520x.webp 520w,\n/images/lazyimg/secondary_frontend-640x.webp 640w\"\n alt=\"Creating a secondary frontend\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eNote that you will not set your certificate here, as that will be handled by the shared_frontend.\u003c/p\u003e\n\u003ch2 id=\"all-done\"\u003eAll done!\u003c/h2\u003e\n\u003cp\u003eAfter applying all settings and restarting HAProxy, both domains should be handled under the same public IP. Your Frontend page will look like like the cover image in this post. Happy homelabbing!\u003c/p\u003e\n","description":"Set up different domains on one public IP using HAProxy on pfSense.","image":"images/frontend_page.webp","permalink":"https://kovasky.me/blogs/haproxy_multi_domain/","title":"Set up multiple domains on one public IP using HAProxy on pfSense"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIn the quest to get more performance out of my inter-vm communication, I stumbled upon SR-IOV and virtual functions. I then purchased a 10gbe X540-T2 from a Chinese seller on eBay making sure to get one with a fan, as reports of this specific card say it runs quite hot. After setting everything up, I increased my network performance from 2.5gbps on a vSwitch to 14gbps with virtual function passthrough.\u003c/p\u003e\n\u003ch2 id=\"pre-requisites\"\u003ePre-requisites\u003c/h2\u003e\n\u003cp\u003eBefore proceeding, make sure to enable IOMMU by editing \u003ccode\u003e/etc/default/grub\u003c/code\u003e and replacing the \u003ccode\u003eGUB_CMDLINE_LINUX_DEFAULT\u003c/code\u003e lines as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGRUB_CMDLINE_LINUX_DEFAULT\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;quiet intel_iommu=on iommu=pt\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce the edit is in place, run the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eupdate grub\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow, you have to enable some VFIO modules by editing the file \u003ccode\u003e/etc/modules\u003c/code\u003e and adding these lines at the end of the file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio_iommu_type1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio_pci\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evfio_virqfd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo make sure these modules are loaded on the next boot you have to issue the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eupdate-initramfs -u -k all\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAll that is left is to reboot the system to make sure IOMMU and corresponding VFIO modules are enabled.\u003c/p\u003e\n\u003ch2 id=\"testing-sr-iov\"\u003eTesting SR-IOV\u003c/h2\u003e\n\u003cp\u003eBefore issuing the commands to enable SR-IOV, you need to find out which network interfaces are associated with the network card. There are several approaches to this, including using the web GUI. In my case, I just issued the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edmesg | grep eth\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen, I looked for lines that resemble the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e    4.602387\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e ixgbe 0000:5f:00.0 ens5f0: renamed from eth0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e    4.686386\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e ixgbe 0000:5f:00.1 ens5f1: renamed from eth1\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAn easy way to test out SR-IOV is to issue the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho N \u0026gt; /sys/class/net/\u0026lt;NIC\u0026gt;/device/sriov_numvfs\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn my case, the command would look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e \u0026gt; /sys/class/net/ens5f1/device/sriov_numvfs\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo make sure this is working, you can issue \u003ccode\u003eip link show NIC\u003c/code\u003e and if everything is working as it should the output should be something similar to this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@pve:~# ip link show ens5f1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e5: ens5f1: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu \u003cspan style=\"color:#ae81ff\"\u003e9000\u003c/span\u003e qdisc mq state UP mode DEFAULT group default qlen \u003cspan style=\"color:#ae81ff\"\u003e1000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e link/ether XX:XX:XX:XX:XX:XX brd ff:ff:ff:ff:ff:ff\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e vf \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off, query_rss off\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e vf \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off, query_rss off\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e altname enp95s0f1\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"automating-the-virtual-function-generation\"\u003eAutomating the virtual function generation\u003c/h2\u003e\n\u003cp\u003eThe changes performed in the previous step are not saved across reboots. To circumvent this, you can create a systemd service that runs on boot and tells the system to create the virtual functions as well as assign a MAC address to them. You need to create and edit the file \u003ccode\u003e/etc/systemd/system/sriov_nic.service\u003c/code\u003e. It should contain something similar to:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eUnit\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDescription\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eEnables SR-IOV and assigns MAC Addresses to the virtual functions\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eService\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eType\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eoneshot\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/usr/bin/bash -c \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/usr/bin/echo 2 \u0026gt; /sys/class/net/ens5f1/device/sriov_numvfs\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/usr/bin/bash -c \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/usr/bin/ip link set ens5f1 vf 0 mac 82:ea:27:28:e8:d5\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/usr/bin/bash -c \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/usr/bin/ip link set ens5f1 vf 1 mac 6e:e2:6a:a8:99:64\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eInstall\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWantedBy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003emulti-user.target\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter the file is created, you need to run \u003ccode\u003esystemctl daemon-reload\u003c/code\u003e and then \u003ccode\u003esystemctl enable --now sriov_nic\u003c/code\u003e to start the service at every boot.\u0026quot;\u003c/p\u003e\n\u003ch2 id=\"autostarting-the-network-cards\"\u003eAutostarting the Network Cards\u003c/h2\u003e\n\u003cp\u003eIt\u0026rsquo;s important to note that the physical NIC needs to be set to autostart; otherwise, the creation of virtual functions will fail. To do this navigate to the web GUI and under network, click edit on the appropriate card, tick the box autostart, and click on ok to apply the changes.\u003c/p\u003e\n\u003ch2 id=\"assign-virtual-functions-to-vms\"\u003eAssign Virtual Functions to VMs\u003c/h2\u003e\n\u003cp\u003eTo assign the virtual functions to the VMs, you first need to blacklist the driver so that the host does not take control of them. To do this you need to edit \u003ccode\u003e/etc/modprobe.d/pve-blacklist.conf\u003c/code\u003e and add the following line at the end of the file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eblacklist ixgbevf\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen you have to run \u003ccode\u003eupdate-initramfs -u -k all\u003c/code\u003e to make sure the changes are applied on every boot.\u003c/p\u003e\n\u003cp\u003eNext, proceed to your chosen VM, and click on hardware -\u0026gt; Add -\u0026gt; PCI Device. Here, click on Raw Device and select a virtual function. Make sure that the options ROM-Bar is selected and PCI-Express is unselected.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/pci_device-120x%20Gaussian.webp\"\n      \n     height=\"481\" width=\"920\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pci_device-270x.webp 270w,\n/images/lazyimg/pci_device-420x.webp 420w,\n/images/lazyimg/pci_device-570x.webp 570w,\n/images/lazyimg/pci_device-720x.webp 720w,\n/images/lazyimg/pci_device-920x.webp 920w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/pci_device-920x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"481\" width=\"920\" \n   srcset=\"/images/lazyimg/pci_device-270x.webp 270w,\n/images/lazyimg/pci_device-420x.webp 420w,\n/images/lazyimg/pci_device-570x.webp 570w,\n/images/lazyimg/pci_device-720x.webp 720w,\n/images/lazyimg/pci_device-920x.webp 920w\"\n   alt=\"pci device selection screen with virtual functions\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/pci_device-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/pci_device-920x.webp\"\n  class=\"blur-up lazyload\"\n height=\"481\" width=\"920\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/pci_device-270x.webp 270w,\n/images/lazyimg/pci_device-420x.webp 420w,\n/images/lazyimg/pci_device-570x.webp 570w,\n/images/lazyimg/pci_device-720x.webp 720w,\n/images/lazyimg/pci_device-920x.webp 920w\"\n alt=\"pci device selection screen with virtual functions\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"windows-hosts\"\u003eWindows hosts\u003c/h2\u003e\n\u003cp\u003eIn my case, the network card was not automatically detected by my Windows Server 2019 VM. I had to download the appropriate drivers for my setup, which can be found \u003ca href=\"https://www.intel.com/content/www/us/en/download/19372/intel-network-adapter-driver-for-windows-server-2019.html\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce everything is set up, you will be able to benefit from network hardware acceleration!\u003c/p\u003e\n","description":"Enabling SR-IOV for an Intel X540-T2 on a Dell Poweredge T440 running Proxmox 8.","image":"images/iperf.webp","permalink":"https://kovasky.me/blogs/sr_iov/","title":"Enabling SR-IOV for an Intel X540-T2 on Proxmox 8"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter deploying the MeshCentral agents to my VMs, I noticed that some of them produced an error screen complaining about Xwayland. This was as simple as modifying a config file and restarting a service.\u003c/p\u003e\n\u003ch2 id=\"modifying-customconf\"\u003eModifying custom.conf\u003c/h2\u003e\n\u003cp\u003eDepending on your system, you will have to navigate to /etc/gdm or /etc/gdm3. Inside this folder you will find a file named custom.conf. It will look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# GDM configuration storage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edaemon\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Uncomment the line below to force the login screen to use Xorg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#WaylandEnable=false\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esecurity\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003exdmcp\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003echooser\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edebug\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Uncomment the line below to turn on debugging\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Enable=true\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAll you have to do, is uncomment the line WaylandEnable=false. After doing so, it should look like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# GDM configuration storage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edaemon\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Uncomment the line below to force the login screen to use Xorg\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWaylandEnable\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esecurity\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003exdmcp\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003echooser\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edebug\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Uncomment the line below to turn on debugging\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Enable=true\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"restarting-the-gdm-service\"\u003eRestarting the gdm service\u003c/h2\u003e\n\u003cp\u003eOnce the modification is in place, you just have to issue the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eservice gdm restart\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter restarting gdm, you will be able to access the VM\u0026rsquo;s desktop using MeshCentral.\u003c/p\u003e\n","description":"How to Fix 'This platform is configured to use Xwayland please modify config to use Xorg' in MeshCentral clients.","image":"images/error.webp","permalink":"https://kovasky.me/blogs/meshcentral_xorg/","title":"How to configure a MeshCentral client to replace Xwayland with Xorg "},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eEnabling SSO for all self-hosted services that support it has been one of the best decisions in my homelab. It has created a seamless \u0026ldquo;ecosystem\u0026rdquo; experience for my friends and family (mainly myself ðŸ¥²). The problem is that every time I logged in to my services, it prompted me with a consent form which I quickly grew tired of. To remove this consent page in all my connected OIDC clients, I enabled implicit consent.\u003c/p\u003e\n\u003ch2 id=\"client-configuration\"\u003eClient Configuration\u003c/h2\u003e\n\u003cp\u003eA typical client configuration may look like:\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eidentity_providers\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eoidc\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eissuer_private_key\u003c/span\u003e: |\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e      \u0026lt;private_key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eclients\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e     - \u003cspan style=\"color:#f92672\"\u003eid\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;id\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003edescription\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;description\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003esecret\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;secret\u0026gt;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003epublic\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eauthorization_policy\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003etwo_factor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eredirect_uris\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;redirect_url\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003escopes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eopenid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eemail\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eprofile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003euserinfo_signing_algorithm\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003enone\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/p\u003e\n\u003cp\u003eTo enable implicit consent, you just have to add one line to the client config, like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eidentity_providers\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eoidc\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eissuer_private_key\u003c/span\u003e: |\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e      \u0026lt;private_key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eclients\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e     - \u003cspan style=\"color:#f92672\"\u003eid\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;id\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003edescription\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;description\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003esecret\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026lt;secret\u0026gt;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003epublic\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eauthorization_policy\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003etwo_factor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eredirect_uris\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003e\u0026lt;redirect_url\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003escopes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eopenid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eemail\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eprofile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003euserinfo_signing_algorithm\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003enone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003econsent_mode\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eimplicit\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter restarting Authelia, you will no longer be prompted to provide consent.\u003c/p\u003e\n","description":"Remove the consent page for OIDC clients by enabling implicit consent in Authelia.","image":"images/consent_form.webp","permalink":"https://kovasky.me/blogs/no_consent/","title":"Enable implicit consent for clients using Authelia OIDC"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIn the search for an open-source Google Analytics alternative, two options stood out Matomo and Plausible. I wanted the tool to be privacy-friendly and that it did not require cookies, avoiding those pesky consent prompts. I did not find a straightforward guide to self-host Plausible with a Google Search Console integration which led me to create this post.\u003c/p\u003e\n\u003ch2 id=\"pre-requisite\"\u003ePre-requisite\u003c/h2\u003e\n\u003cp\u003eEnsure that your domain\u0026rsquo;s ownership is confirmed in the Google Search Console. To do this, take a look at Google\u0026rsquo;s guide \u003ca href=\"https://support.google.com/webmasters/answer/34592?hl=en\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"google-cloud-console\"\u003eGoogle Cloud Console\u003c/h2\u003e\n\u003cp\u003eTo enable your Plausible instance to access site data, a client ID and key must be issued by the Google Cloud Console. This is completely free.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eYou start by navigating to the cloud console \u003ca href=\"https://console.cloud.google.com/welcome\"\u003ehere\u003c/a\u003e and clicking \u0026ldquo;create or select a project\u0026rdquo;.\u003c/li\u003e\n\u003c/ol\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/cloud_console_landing-120x%20Gaussian.webp\"\n      \n     height=\"451\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_landing-220x.webp 220w,\n/images/lazyimg/cloud_console_landing-320x.webp 320w,\n/images/lazyimg/cloud_console_landing-420x.webp 420w,\n/images/lazyimg/cloud_console_landing-520x.webp 520w,\n/images/lazyimg/cloud_console_landing-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/cloud_console_landing-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"451\" width=\"640\" \n   srcset=\"/images/lazyimg/cloud_console_landing-220x.webp 220w,\n/images/lazyimg/cloud_console_landing-320x.webp 320w,\n/images/lazyimg/cloud_console_landing-420x.webp 420w,\n/images/lazyimg/cloud_console_landing-520x.webp 520w,\n/images/lazyimg/cloud_console_landing-640x.webp 640w\"\n   alt=\"google cloud console welcome page\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/cloud_console_landing-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/cloud_console_landing-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"451\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_landing-220x.webp 220w,\n/images/lazyimg/cloud_console_landing-320x.webp 320w,\n/images/lazyimg/cloud_console_landing-420x.webp 420w,\n/images/lazyimg/cloud_console_landing-520x.webp 520w,\n/images/lazyimg/cloud_console_landing-640x.webp 640w\"\n alt=\"google cloud console welcome page\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003col start=\"2\"\u003e\n\u003cli\u003eA pop-up should appear prompting you to select a project. Click \u0026ldquo;new project\u0026rdquo; on the top right corner.\u003c/li\u003e\n\u003c/ol\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        srcset=\"data:image/webp;base64,UklGRowFAABXRUJQVlA4IIAFAACQHACdASp4AF4AABgAJ6QDXHY29C3DY7eoDbjeYD\u0026#43;AfyD9sffF9AHkAdZL6AH6AemJ7D37Xfs77LFMxe7fkPxclZPyM/Jn77/tn\u0026#43;n3wb8y/ib\u0026#43;UnI08d/nP9z/I78gOkf6y/5b0L/5z\u0026#43;VXOnzI/5r/qPuj\u0026#43;QP\u0026#43;S83P0Z/xvcJ/k39I/yn5Xf3z/7/\u0026#43;byG\u0026#43;gx\u0026#43;t52aTq57iu0cX2rF3G6vediwIcqmt7if4ZTj9JWtkLK5e7eVspDn\u0026#43;7GYcQmY3HyKYbYR/NCPD11Cyy5TRRpWP5EmKoPw8VtZ7r1B5sAO0Y5wbnpkcx9T4KlX8gAAA/v/\u0026#43;8Se/9bD9m6nhbz5lCo/ajKheuzBd2jHSHJEeKCT4WSApv6UaLVX9fyAeLalbzfSFaYen\u0026#43;fzv7DzYAyhGA3fF7xM/xVqk2jlR\u0026#43;28zeMGzJcpXSdovGhV40Pm06f3GxpDdnGL9lsvAuXRlnrEffc/RuYMT35yF1/rzn3DDJ6\u0026#43;Tclm80vmF3DjbsK3DoRKRqHnhP2OcLLrySo\u0026#43;zj/o9Qr1Gt\u0026#43;uLd0IYK8prhuOTFxVlTC/Ho3ifSvOI5R6BanYXAzgOkrHagY8eaziynsbKlOmi7o/h5JB3\u0026#43;ebuizP0rNYJvI8AV8gwBWJBUfNMUoF0jKEvF6n8ihjoR9mn4HbVEkqGU4urbF2exIRrhU2fWG\u0026#43;9KBDZnC/dHCkdrdDcLs0xRIVlZ4xdGw5UiBymK/d\u0026#43;EIUvq\u0026#43;dNADTEzLgEqW4R8eSvf1aNtzVb7cZbIutjA5vwJq/Q2kAuP6/mQ23PxyzjocQQ024rBur9Jxx6/SIAOXmY\u0026#43;OMFoQnXBD56XSVG0Ho7WoteRcU\u0026#43;FECw3TjjDnIts/4877tZiWzHe\u0026#43;wd5Vg4OPvV\u0026#43;7kd9Srr9ywuUzPOvq/D3Kd5LS0T/FZRxIv\u0026#43;HsZFoRE4Guf//vffdcQf3wz333WCiiYJNtjkDm58RnVbB1kb6MDcNIBw8kyEAgsCvSyApFXt1Y1Tgv3ohW/gq7mhMgmKPh/L1TNfuIQ6QM\u0026#43;fnzJidUAoctywTAAh1TytlzajgDgPMSM6u3pNDxdhZbwC2Ci48xcE0EBZqrfEI0k6GHdpiLipRKdVMT9CfkBP8JlOS36abpXsZdc\u0026#43;T05eJUxJkvRogynRev/KqsbDSQLtF\u0026#43;TyXMFW/59MtEidOfTxEWREIrD4l0U\u0026#43;8vQ2CCH8Ouwj7BUA9ykimp0QqSw\u0026#43;Xb4DcGsFmx/j/qKJoi7HAWuxr/AuS6CAYMtzqiWtAzEZ2ndXWtUdF0zzE\u0026#43;VrAb8k4LgPNrqeSPOeAEHN9iogMUb7kq3T9ebE5OwGg40llLYI/afyOb62trQWMMyVuryP/uCrwu2tzGJICpK2H/8pHubDQgxaKmoUILr96awdH7VfFLUaclcDThFj/4jNkMvuBtp1nBTo1gNMBzOfPiDgA\u0026#43;E8YBB44lLARpuNwW4ior8MT9cLEMYX1b6N6eRdHEJpOQozNv/fCKBtANNMSInvuL2X0zmtwYvPwoOdm82djOeCi8lsmUupCOzxhojC0/qw2X\u0026#43;yMVegDRg3lx462F/0gO\u0026#43;9AdtoImWfnXO9sEZo\u0026#43;SKK3rTFkPsew7UE1wnOE4qnRQkQGZX3WwDonIpJ9vHpuLoDxJAWMgFnEA4PRKwLwYTgRyl3XRpxt54ep7nH2fv2Ca9HCBiPS/4AQ0uiZInJrNqEOX\u0026#43;C7lC4VNnCd12YFSDLfv6L\u0026#43;iaz5CSRBeqAjXpKLyyzhXDa5EZRuXWEAReigUOp2Axv\u0026#43;B\u0026#43;8RwqP/0jP\u0026#43;OYJ3GiJpQAhygfcqsowHDD/sE26xXcNtyReCgnZCRwTfJ5g/ueJNj/qxAOR1wedUWbK/yVXAMJ4/IAerxuhnv/is\u0026#43;TftWrzFVyhWnOf4lfJXpDbZOMIAAAA\"\n      \n     height=\"502\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_popup-220x.webp 220w,\n/images/lazyimg/cloud_console_popup-320x.webp 320w,\n/images/lazyimg/cloud_console_popup-420x.webp 420w,\n/images/lazyimg/cloud_console_popup-520x.webp 520w,\n/images/lazyimg/cloud_console_popup-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/cloud_console_popup-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"502\" width=\"640\" \n   srcset=\"/images/lazyimg/cloud_console_popup-220x.webp 220w,\n/images/lazyimg/cloud_console_popup-320x.webp 320w,\n/images/lazyimg/cloud_console_popup-420x.webp 420w,\n/images/lazyimg/cloud_console_popup-520x.webp 520w,\n/images/lazyimg/cloud_console_popup-640x.webp 640w\"\n   alt=\"google cloud console pop up\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    src=\"data:image/webp;base64,UklGRowFAABXRUJQVlA4IIAFAACQHACdASp4AF4AABgAJ6QDXHY29C3DY7eoDbjeYD\u0026#43;AfyD9sffF9AHkAdZL6AH6AemJ7D37Xfs77LFMxe7fkPxclZPyM/Jn77/tn\u0026#43;n3wb8y/ib\u0026#43;UnI08d/nP9z/I78gOkf6y/5b0L/5z\u0026#43;VXOnzI/5r/qPuj\u0026#43;QP\u0026#43;S83P0Z/xvcJ/k39I/yn5Xf3z/7/\u0026#43;byG\u0026#43;gx\u0026#43;t52aTq57iu0cX2rF3G6vediwIcqmt7if4ZTj9JWtkLK5e7eVspDn\u0026#43;7GYcQmY3HyKYbYR/NCPD11Cyy5TRRpWP5EmKoPw8VtZ7r1B5sAO0Y5wbnpkcx9T4KlX8gAAA/v/\u0026#43;8Se/9bD9m6nhbz5lCo/ajKheuzBd2jHSHJEeKCT4WSApv6UaLVX9fyAeLalbzfSFaYen\u0026#43;fzv7DzYAyhGA3fF7xM/xVqk2jlR\u0026#43;28zeMGzJcpXSdovGhV40Pm06f3GxpDdnGL9lsvAuXRlnrEffc/RuYMT35yF1/rzn3DDJ6\u0026#43;Tclm80vmF3DjbsK3DoRKRqHnhP2OcLLrySo\u0026#43;zj/o9Qr1Gt\u0026#43;uLd0IYK8prhuOTFxVlTC/Ho3ifSvOI5R6BanYXAzgOkrHagY8eaziynsbKlOmi7o/h5JB3\u0026#43;ebuizP0rNYJvI8AV8gwBWJBUfNMUoF0jKEvF6n8ihjoR9mn4HbVEkqGU4urbF2exIRrhU2fWG\u0026#43;9KBDZnC/dHCkdrdDcLs0xRIVlZ4xdGw5UiBymK/d\u0026#43;EIUvq\u0026#43;dNADTEzLgEqW4R8eSvf1aNtzVb7cZbIutjA5vwJq/Q2kAuP6/mQ23PxyzjocQQ024rBur9Jxx6/SIAOXmY\u0026#43;OMFoQnXBD56XSVG0Ho7WoteRcU\u0026#43;FECw3TjjDnIts/4877tZiWzHe\u0026#43;wd5Vg4OPvV\u0026#43;7kd9Srr9ywuUzPOvq/D3Kd5LS0T/FZRxIv\u0026#43;HsZFoRE4Guf//vffdcQf3wz333WCiiYJNtjkDm58RnVbB1kb6MDcNIBw8kyEAgsCvSyApFXt1Y1Tgv3ohW/gq7mhMgmKPh/L1TNfuIQ6QM\u0026#43;fnzJidUAoctywTAAh1TytlzajgDgPMSM6u3pNDxdhZbwC2Ci48xcE0EBZqrfEI0k6GHdpiLipRKdVMT9CfkBP8JlOS36abpXsZdc\u0026#43;T05eJUxJkvRogynRev/KqsbDSQLtF\u0026#43;TyXMFW/59MtEidOfTxEWREIrD4l0U\u0026#43;8vQ2CCH8Ouwj7BUA9ykimp0QqSw\u0026#43;Xb4DcGsFmx/j/qKJoi7HAWuxr/AuS6CAYMtzqiWtAzEZ2ndXWtUdF0zzE\u0026#43;VrAb8k4LgPNrqeSPOeAEHN9iogMUb7kq3T9ebE5OwGg40llLYI/afyOb62trQWMMyVuryP/uCrwu2tzGJICpK2H/8pHubDQgxaKmoUILr96awdH7VfFLUaclcDThFj/4jNkMvuBtp1nBTo1gNMBzOfPiDgA\u0026#43;E8YBB44lLARpuNwW4ior8MT9cLEMYX1b6N6eRdHEJpOQozNv/fCKBtANNMSInvuL2X0zmtwYvPwoOdm82djOeCi8lsmUupCOzxhojC0/qw2X\u0026#43;yMVegDRg3lx462F/0gO\u0026#43;9AdtoImWfnXO9sEZo\u0026#43;SKK3rTFkPsew7UE1wnOE4qnRQkQGZX3WwDonIpJ9vHpuLoDxJAWMgFnEA4PRKwLwYTgRyl3XRpxt54ep7nH2fv2Ca9HCBiPS/4AQ0uiZInJrNqEOX\u0026#43;C7lC4VNnCd12YFSDLfv6L\u0026#43;iaz5CSRBeqAjXpKLyyzhXDa5EZRuXWEAReigUOp2Axv\u0026#43;B\u0026#43;8RwqP/0jP\u0026#43;OYJ3GiJpQAhygfcqsowHDD/sE26xXcNtyReCgnZCRwTfJ5g/ueJNj/qxAOR1wedUWbK/yVXAMJ4/IAerxuhnv/is\u0026#43;TftWrzFVyhWnOf4lfJXpDbZOMIAAAA\"\n  \n  data-src=\"/images/lazyimg/cloud_console_popup-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"502\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_popup-220x.webp 220w,\n/images/lazyimg/cloud_console_popup-320x.webp 320w,\n/images/lazyimg/cloud_console_popup-420x.webp 420w,\n/images/lazyimg/cloud_console_popup-520x.webp 520w,\n/images/lazyimg/cloud_console_popup-640x.webp 640w\"\n alt=\"google cloud console pop up\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003col start=\"3\"\u003e\n\u003cli\u003eEnter a suitable project name (like Plausible), leave Location as \u0026ldquo;No organization\u0026rdquo;, and click \u0026ldquo;Create\u0026rdquo;. After the project is created, a notification will appear allowing you to \u0026ldquo;Select Project\u0026rdquo;. Just like this:\u003c/li\u003e\n\u003c/ol\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/cloud_console_notification-120x%20Gaussian.webp\"\n      \n     height=\"502\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_notification-220x.webp 220w,\n/images/lazyimg/cloud_console_notification-320x.webp 320w,\n/images/lazyimg/cloud_console_notification-420x.webp 420w,\n/images/lazyimg/cloud_console_notification-520x.webp 520w,\n/images/lazyimg/cloud_console_notification-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/cloud_console_notification-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"502\" width=\"640\" \n   srcset=\"/images/lazyimg/cloud_console_notification-220x.webp 220w,\n/images/lazyimg/cloud_console_notification-320x.webp 320w,\n/images/lazyimg/cloud_console_notification-420x.webp 420w,\n/images/lazyimg/cloud_console_notification-520x.webp 520w,\n/images/lazyimg/cloud_console_notification-640x.webp 640w\"\n   alt=\"google cloud console notification\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/cloud_console_notification-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/cloud_console_notification-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"502\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_notification-220x.webp 220w,\n/images/lazyimg/cloud_console_notification-320x.webp 320w,\n/images/lazyimg/cloud_console_notification-420x.webp 420w,\n/images/lazyimg/cloud_console_notification-520x.webp 520w,\n/images/lazyimg/cloud_console_notification-640x.webp 640w\"\n alt=\"google cloud console notification\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003col start=\"4\"\u003e\n\u003cli\u003eAfter clicking \u0026ldquo;Select Project\u0026rdquo;, navigate to \u0026ldquo;APIs \u0026amp; Services\u0026rdquo; and click on \u0026ldquo;API Library\u0026rdquo;. In the API Library, search for \u0026ldquo;Google Search Console API\u0026rdquo;, select it, and click enable.\u003c/li\u003e\n\u003c/ol\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/cloud_console_api-120x%20Gaussian.webp\"\n      \n     height=\"413\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_api-220x.webp 220w,\n/images/lazyimg/cloud_console_api-320x.webp 320w,\n/images/lazyimg/cloud_console_api-420x.webp 420w,\n/images/lazyimg/cloud_console_api-520x.webp 520w,\n/images/lazyimg/cloud_console_api-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/cloud_console_api-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"413\" width=\"640\" \n   srcset=\"/images/lazyimg/cloud_console_api-220x.webp 220w,\n/images/lazyimg/cloud_console_api-320x.webp 320w,\n/images/lazyimg/cloud_console_api-420x.webp 420w,\n/images/lazyimg/cloud_console_api-520x.webp 520w,\n/images/lazyimg/cloud_console_api-640x.webp 640w\"\n   alt=\"google cloud console api selection\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/cloud_console_api-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/cloud_console_api-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"413\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_api-220x.webp 220w,\n/images/lazyimg/cloud_console_api-320x.webp 320w,\n/images/lazyimg/cloud_console_api-420x.webp 420w,\n/images/lazyimg/cloud_console_api-520x.webp 520w,\n/images/lazyimg/cloud_console_api-640x.webp 640w\"\n alt=\"google cloud console api selection\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003col start=\"5\"\u003e\n\u003cli\u003eOnce enabled, go back to the menu and select the \u0026ldquo;OAuth consent screen\u0026rdquo;. On the OAuth consent screen, select \u0026ldquo;External\u0026rdquo; as \u0026ldquo;User Type\u0026rdquo; and click \u0026ldquo;Create\u0026rdquo;. Give your app a name, enter a support email (preferably your Gmail account), set your app domain, add an authorized domain, add a developer contact, and click save and continue. After this step, it will lead to the Scopes section. Under this section, click \u0026ldquo;ADD OR REMOVE SCOPES\u0026rdquo;. A popup will appear and you should select the \u0026ldquo;Google Search Console API\u0026rdquo; with read-only capabilities.\u003c/li\u003e\n\u003c/ol\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/cloud_console_api_popup-120x%20Gaussian.webp\"\n      \n     height=\"393\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_api_popup-220x.webp 220w,\n/images/lazyimg/cloud_console_api_popup-320x.webp 320w,\n/images/lazyimg/cloud_console_api_popup-420x.webp 420w,\n/images/lazyimg/cloud_console_api_popup-520x.webp 520w,\n/images/lazyimg/cloud_console_api_popup-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/cloud_console_api_popup-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"393\" width=\"640\" \n   srcset=\"/images/lazyimg/cloud_console_api_popup-220x.webp 220w,\n/images/lazyimg/cloud_console_api_popup-320x.webp 320w,\n/images/lazyimg/cloud_console_api_popup-420x.webp 420w,\n/images/lazyimg/cloud_console_api_popup-520x.webp 520w,\n/images/lazyimg/cloud_console_api_popup-640x.webp 640w\"\n   alt=\"google cloud console api pop up\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/cloud_console_api_popup-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/cloud_console_api_popup-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"393\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloud_console_api_popup-220x.webp 220w,\n/images/lazyimg/cloud_console_api_popup-320x.webp 320w,\n/images/lazyimg/cloud_console_api_popup-420x.webp 420w,\n/images/lazyimg/cloud_console_api_popup-520x.webp 520w,\n/images/lazyimg/cloud_console_api_popup-640x.webp 640w\"\n alt=\"google cloud console api pop up\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003col start=\"6\"\u003e\n\u003cli\u003e\n\u003cp\u003eAfter clicking update, the popup will close. Click on \u0026ldquo;SAVE AND CONTINUE\u0026rdquo; and add a test user (preferably your same Gmail account). After clicking \u0026ldquo;SAVE AND CONTINUE\u0026rdquo; you can then navigate to the left menu and click on \u0026ldquo;Credentials\u0026rdquo;. In the Credentials pane, on the top left click on \u0026ldquo;CREATE CREDENTIALS\u0026rdquo; and select \u0026ldquo;OAuth client ID\u0026rdquo;. Under Application type, select \u0026ldquo;Web Application\u0026rdquo; and give it an appropriate name. Under \u0026ldquo;Authorized redirect URIs\u0026rdquo;, make sure to enter \u0026ldquo;https://\u0026lt;plausible_domain\u0026gt;/auth/google/callback\u0026rdquo;.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAfter clicking Create, copy the \u0026ldquo;Client ID\u0026rdquo; and \u0026ldquo;Client Secret\u0026rdquo; which will be used in the next section.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"plausible-compose-file\"\u003ePlausible Compose File\u003c/h2\u003e\n\u003cp\u003eWith the prerequisites complete, you can go ahead and create your Plausible instance. This is my example compose file.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003email\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eplausible_mail\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebytemark/smtp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eMAILNAME=$MAILER_EMAIL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eRELAY_HOST=$SMTP_HOST_ADDR\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eRELAY_PORT=587\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eRELAY_USERNAME=$SMTP_USER_NAME\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eRELAY_PASSWORD=$SMTP_USER_PWD\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eplausible_db\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eplausible_db\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003epostgres:14-alpine\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003edb-data:/var/lib/postgresql/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ePOSTGRES_PASSWORD=postgres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eplausible_events_db\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eplausible_events_db\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eclickhouse/clickhouse-server:23.3.7.5-alpine\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eevent-data:/var/lib/clickhouse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eevent-logs:/var/log/clickhouse-server\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      -  \u003cspan style=\"color:#ae81ff\"\u003eevent-config:/etc/clickhouse-server/config.d\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eevent-user-config:/etc/clickhouse-server/users.d\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eulimits\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003enofile\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003esoft\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e262144\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003ehard\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e262144\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eplausible\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eplausible\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eplausible/community-edition:latest\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ecommand\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003esh -c \u0026#34;sleep 10 \u0026amp;\u0026amp; /entrypoint.sh db createdb \u0026amp;\u0026amp; /entrypoint.sh db migrate \u0026amp;\u0026amp; /entrypoint.sh run\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edepends_on\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eplausible_db\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eplausible_events_db\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003email\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e8480\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e8000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eBASE_URL=$BASE_URL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSECRET_KEY_BASE=$SECRET_KEY_BASE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eTOTP_VAULT_KEY=$TOTP_VAULT_KEY\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eGOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eGOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eMAILER_EMAIL=$MAILER_EMAIL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eCRON_ENABLED=true\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003edb-data\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eevent-data\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eevent-logs\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eevent-user-config\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eevent-config\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe mail section is only required when you want to send emails for weekly reports or password recovery.\u003c/p\u003e\n\u003cp\u003eHere is how you populate the other variables:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e${BASE_URL}, where plausible will be accessed (like a reverse proxy address)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${SECRET_KEY_BASE}, generated using \u0026lsquo;openssl rand -base64 48\u0026rsquo;\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${TOTP_VAULT_KEY}, generated using \u0026lsquo;openssl rand -base64 32\u0026rsquo;\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${GOOGLE_CLIENT_ID}, the ID that we got from the previous step\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${GOOGLE_CLIENT_SECRET}, the secret that we got from the previous step\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"plausible-config\"\u003ePlausible config\u003c/h2\u003e\n\u003cp\u003eAfter deploying Plausible, log in to configure a domain. Navigate to the settings page for that domain and link it with your Google Account specified as a Test User in the OAuth setup.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce set up with these steps and configs, Plausible should be integrated with Google\u0026rsquo;s Search Console, providing you with a privacy-focused analytics tool.\u003c/p\u003e\n","description":"Set up Plausible Analytics Community Edition (self-hosted) with Google search console support.","image":"images/plausible_google.webp","permalink":"https://kovasky.me/blogs/plausible/","title":"Set up Plausible Analytics Community Edition (self-hosted)"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI started using Notion\u0026rsquo;s free tier as a knowledge bank for a side project. It\u0026rsquo;s measley 1000 blocks were capped quickly and searching for an alternative lead to Outline. Outline is 100% free, selfhostable, and has a very similar featureset.\u003c/p\u003e\n\u003cp\u003eMost of the guides out there configure Outline with an S3 store for object storage, but I do not really have a need for it. Also, I wanted to integrate Outline with Authelia for integration with my Active Directory server as well as Fail2Ban.\u003c/p\u003e\n\u003ch2 id=\"docker-compose\"\u003eDocker Compose\u003c/h2\u003e\n\u003cp\u003eAfter some trial and error, this was the resuting compose file that spins up Outline with OIDC and local object storage.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eversion\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3.1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eredis\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eredis\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eredis\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003enetworks\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003einternal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003epostgres\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003epostgres:latest\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003epostgres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ePOSTGRES_PASSWORD=${POSTGRES_PASSWORD}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ePOSTGRES_USER=outline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ePOSTGRES_DB=outline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003enetworks\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003einternal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003edb:/var/lib/postgresql/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eoutline\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eoutlinewiki/outline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003euser\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eroot\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003erestart\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eunless-stopped\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eoutline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ecommand\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003esh -c \u0026#34;yarn start --env=production-ssl-disabled\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edepends_on\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003epostgres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eredis\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ePGSSLMODE=disable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSECRET_KEY=${SECRET_KEY}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eUTILS_SECRET=${UTILS_SECRET}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eDATABASE_URL=postgres://outline:${POSTGRES_PASSWORD}@postgres:5432/outline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eREDIS_URL=redis://redis:6379\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eURL=${WIKI_URL}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ePORT=3000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eFORCE_HTTPS=false\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_CLIENT_ID=outline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_CLIENT_SECRET=${OIDC_SECRET}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_AUTH_URI=${AUTH_URI}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_TOKEN_URI=${AUTH_TOKEN}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_USERINFO_URI=${AUTH_USERINFO}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_USERNAME_CLAIM=preferred_username\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_DISPLAY_NAME=Authelia\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eOIDC_SCOPES=openid email groups profile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eFILE_STORAGE=local\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eFILE_STORAGE_UPLOAD_MAX_SIZE=26214400\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eFILE_STORAGE_IMPORT_MAX_SIZE=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eFILE_STORAGE_WORKSPACE_IMPORT_MAX_SIZE=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSMTP_HOST=$SMTP_HOST\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSMTP_PORT=$SMTP_PORT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSMTP_USERNAME=$SMTP_USER\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSMTP_PASSWORD=$SMTP_PASSWORD\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSMTP_FROM_EMAIL=$SMTP_FROM\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSMTP_TLS_CIPHERS=TLSv1.2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003eSMTP_SECURE=false\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003edata:/var/lib/outline/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e10300\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e3000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003enetworks\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003einternal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003enetworks\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003einternal\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003edb\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003edata\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edriver\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003elocal\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere is how you populate the variables:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e${SECRET_KEY}, can be any random string (the longer the better)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${UTILS_SECRET}, can be any random string (the longer the better)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${POSTGRES_PASSWORD}, can be any random string (the longer the better)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${WIKI_URL}, where outline will be accessed (like a reverse proxy address)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${OIDC_SECRET}, a random jwt token\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${OIDC_AUTH_URI}=${AUTH_URI}, https://\u0026lt;authelia_domain\u0026gt;/api/oidc/authorization\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${OIDC_TOKEN_URI}=${AUTH_TOKEN}, https://\u0026lt;authelia_domain\u0026gt;/api/oidc/token\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${OIDC_USERINFO_URI}=https://\u0026lt;authelia_domain\u0026gt;/api/oidc/userinfo\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"authelia-configuration\"\u003eAuthelia configuration\u003c/h2\u003e\n\u003cp\u003eThis is how the configuration.yml for Authelia should look like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eidentity_providers\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eoidc\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eissuer_private_key\u003c/span\u003e: |\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e      \u0026lt;private_key\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eclients\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    - \u003cspan style=\"color:#f92672\"\u003eid\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eoutline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003edescription\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eOutline Wiki\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003esecret\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;$plaintext$\u0026lt;OIDC_SECRET\u0026gt;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003epublic\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eauthorization_policy\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003etwo_factor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eredirect_uris\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003ehttps://\u0026lt;WIKI_URL\u0026gt;/auth/oidc.callback\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003escopes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eopenid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eprofile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eemail\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003egroups\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eresponse_types\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003ecode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003egrant_types\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003erefresh_token\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eauthorization_code\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eresponse_modes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003eform_post\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003equery\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        - \u003cspan style=\"color:#ae81ff\"\u003efragment\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003euserinfo_signing_algorithm\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003enone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003etoken_endpoint_auth_method\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eclient_secret_post\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003econsent_mode\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eimplicit\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere is how you populate the variables:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e${WIKI_URL}, where outline will be accessed (like a reverse proxy address)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e${OIDC_SECRET}, jwt token used in the docker compose file\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eprivate_key, please visit the authelia guide located \u003ca href=\"https://www.authelia.com/reference/guides/generating-secure-values/#generating-an-rsa-keypair\"\u003ehere\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce set up with these config settings, outline should be up and running. You can take a look at this compose file, as well as others \u003ca href=\"https://git.agrajag.cloud/kova/homelabscripts\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n","description":"Set up Outline Wiki with local object storage and OIDC integration.","image":"images/outline_wiki.webp","permalink":"https://kovasky.me/blogs/get_outline/","title":"Set up Outline Wiki with local object storage and OIDC integration"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAlways on the lookout to decrease writes on my consumer SSDs, I stumbled upon the idea of a ramdisk for Plex transcodes. In theory it should offer a performance boost, but in practice I did not really notice any improvements besides lowering SSD writes.\u003c/p\u003e\n\u003ch2 id=\"editing-fstab\"\u003eEditing fstab\u003c/h2\u003e\n\u003cp\u003eNavigate to /etc/fstab and open it for edition. You should see your boot disk and any other mapped media there. Add the following line:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etmpfs /dev/shm tmpfs defaults,noexec,nosuid,size\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;SIZE IN GB\u0026gt; \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe size can be as much as half of your total available RAM. Also, you can technically mount it in any directory, just make sure it exists beforehand. After editing your fstab, you can just issue the command mount -a using a privileged user and the ramdisk will be mounted.\u003c/p\u003e\n\u003ch2 id=\"editing-the-plex-server-config\"\u003eEditing the Plex server config\u003c/h2\u003e\n\u003cp\u003eNavigate to the plex server settings -\u0026gt; transcoder, and under the temporary directory, write the location of your ram disk, e.g. /dev/shm.\u003c/p\u003e\n\u003cp\u003eIt should look like the featured image.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eThe next transcoder playback should utilize the ram disk and avoid unnecesary disk writes!\u003c/p\u003e\n","description":"Set up a ramdisk for Plex to decrease SSD writes.","image":"images/plex_ramdisk.webp","permalink":"https://kovasky.me/blogs/plex_ramdisk/","title":"Set up a ramdisk for Plex"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI recently acquired a Dell Poweredge T440, and after installing a GPU the fans skyrocketed. This turned the server into a noise machine. To solve this, I created a script that disables third-party PCI mode and based on a threshold, set the fan speed to 20% or to be controlled by Dell\u0026rsquo;s fan profile. These are the steps I took to make my T440 silent again.\u003c/p\u003e\n\u003ch2 id=\"downgrading-idrac-9-firmware-to-3303030\"\u003eDowngrading iDRAC 9 firmware to 3.30.30.30\u003c/h2\u003e\n\u003cp\u003eFor this whole setup to work, iDRAC needs to be on firmware 3.30.30.30, as later firmware revisions remove the ability to control the fan speed. The firmware can be downloaded from \u003ca href=\"https://www.dell.com/support/home/en-us\"\u003eDell\u0026rsquo;s website\u003c/a\u003e. To downgrade, navigate to your iDRAC\u0026rsquo;s web admin page, and under Maintenance-\u0026gt;System Update you can apply the downgrade. After the downgrade, make sure IPMI over LAN is enabled under iDRAC Settings-\u0026gt;Connectivity-\u0026gt;Network-\u0026gt;IPMI Settings.\u003c/p\u003e\n\u003ch2 id=\"script-to-control-the-fan-speed\"\u003eScript to control the fan speed\u003c/h2\u003e\n\u003cp\u003eOnce iDRAC is on firmware 3.30.30.30 and you can use IPMI over LAN, you can start using my script to control the fan speed. My script first checks that a VM has been up for 60 seconds. I added this check as pfSense is virtualized in my lab and as such needs to wait for it to be up to issue LAN commands. You can remove this check and the script will work as intended. Before running, make sure to fill in the blanks.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echeck_start_time\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local start_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$1\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local current_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003edate +%s\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    local time_diff\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$((\u003c/span\u003ecurrent_time \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e start_time\u003cspan style=\"color:#66d9ef\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e $time_diff -ge \u003cspan style=\"color:#ae81ff\"\u003e60\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        echo \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        echo \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echeck_temperature\u003cspan style=\"color:#f92672\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    temp_lines\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e sdr type temperature 2\u0026gt;/dev/null | grep -e degrees | awk \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;{print $(NF-2)}\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    temp_arr\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    readarray -t temp_arr \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$temp_lines\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sorted_temps\u003cspan style=\"color:#f92672\"\u003e=(\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eprintf \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%s\\n\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003etemp_arr[@]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e | sort -nr\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    max_temp\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003esorted_temps[0]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$max_temp\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -le \u003cspan style=\"color:#ae81ff\"\u003e60\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# enable manual fan control\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x01 0x00 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set initial fan to 20%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x02 0xff 0x14 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        CURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$max_temp\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -le \u003cspan style=\"color:#ae81ff\"\u003e65\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL2\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# enable manual fan control\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x01 0x00 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set initial fan to 30%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x02 0xff 0x1e \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set low_to_high used to determine wait time\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        CURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL2\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$max_temp\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -gt \u003cspan style=\"color:#ae81ff\"\u003e65\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e !\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;AUTO\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# enable Dell fan control\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipmitool -I lanplus -H \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -U \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e -P \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e raw 0x30 0x30 0x01 0x01 \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# set low_to_high used to determine wait time\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;MANUAL2\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            LOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        CURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;AUTO\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edisable_third_party_mode \u003cspan style=\"color:#f92672\"\u003e(){\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# disable 3rd party pcie fan mode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    output\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003esshpass -p \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e ssh -o StrictHostKeyChecking\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eno \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e@\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;racadm get system.pcieslotlfm\u0026#34;\u003c/span\u003e 2\u0026gt;/dev/null\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    pcie_ports_count\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$output\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e | grep -c \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;System.pcieslotlfm\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Iterate through each PCIe port and disable third party mode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e((\u003c/span\u003ei\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e1; i\u0026lt;\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epcie_ports_count; i++\u003cspan style=\"color:#f92672\"\u003e))\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sshpass -p \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$PASS\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e ssh -o StrictHostKeyChecking\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eno \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$USER\u003cspan style=\"color:#e6db74\"\u003e@\u003c/span\u003e$HOST\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;racadm set system.pcieslotlfm.\u003c/span\u003e$i\u003cspan style=\"color:#e6db74\"\u003e.lfmmode disabled\u0026#34;\u003c/span\u003e \u0026amp;\u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHOST\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUSER\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePASS\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVMID\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCURRENT_PROFILE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLOW_TO_HIGH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003efalse\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003estart_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eps -o lstart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e -p \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003ecat /var/run/qemu-server/$VMID.pid\u003cspan style=\"color:#66d9ef\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003estart_time\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003edate -d \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$start_time\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e +%s\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003echeck_start_time \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$start_time\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e -eq \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sleep \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edisable_third_party_mode\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e true; \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    check_temperature\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[[\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CURRENT_PROFILE\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;AUTO\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$LOW_TO_HIGH\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e true\u003cspan style=\"color:#f92672\"\u003e]]\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ethen\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sleep \u003cspan style=\"color:#ae81ff\"\u003e180\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sleep \u003cspan style=\"color:#ae81ff\"\u003e60\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edone\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"automating-the-launching-of-the-script\"\u003eAutomating the launching of the script\u003c/h2\u003e\n\u003cp\u003eInstead of manually running this every time my server reboots, I created a service. To do so, I used the following service file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eUnit\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDescription\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eUser defined temperature fan control \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e iDrac \u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eService\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eType\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esimple\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/usr/local/sbin/fan_control.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRestart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ealways\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eInstall\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWantedBy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003emulti-user.target\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOn my Proxmox install, the bash script is placed at /usr/local/sbin/fan_control.sh with the appropriate permissions and the service file is at /etc/systemd/system. After these files are created, it takes a \u0026ldquo;systemctl daemon-reload\u0026rdquo; and then a \u0026ldquo;systemctl enable fan_control\u0026rdquo; to start the service and make sure it starts every reboot.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce everything is set up, your Dell server with iDRAC 9 should be extremely quiet.\u003c/p\u003e\n","description":"iDRAC 9 manual fan control on Dell PowerEdge servers","image":"images/idrac.webp","permalink":"https://kovasky.me/blogs/fan_control/","title":"iDRAC 9 manual fan control on Dell PowerEdge servers"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIt has always been recommended to give ZFS full disk control, so after placing my raid card in HBA mode, I went ahead and gave full disk control to my TrueNAS vm.\u003c/p\u003e\n\u003ch2 id=\"figuring-out-the-id-of-the-disk\"\u003eFiguring out the id of the disk\u003c/h2\u003e\n\u003cp\u003eTypically, disks are labeled as /dev/sdX, but this can change when adding other drives or moving them around. To circumvent this, it is better to figure out the specific id of the disk to be passed through. To do this, execute the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elshw -class disk -class storage\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWrite down the serial and then issue the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003els /dev/disk/by-id/ | grep \u0026lt;serial\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWrite this down, as it will be needed for the passthrough.\u003c/p\u003e\n\u003ch2 id=\"map-the-drive-to-the-vm\"\u003eMap the drive to the vm\u003c/h2\u003e\n\u003cp\u003eAfter you\u0026rsquo;ve found the id of the disk, you can issue the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eqm set \u0026lt;vm_id\u0026gt; -scsi\u0026lt;disk_number\u0026gt; /dev/disk/by-id/\u0026lt;disk_id\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNavigate to /etc/pve/qemu-server. Locate your vm configuration by vm id and open the file for edition.\u003c/p\u003e\n\u003cp\u003eIt should look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003escsi\u0026lt;disk_number\u0026gt;: /dev/disk/by-id/\u0026lt;disk_id\u0026gt;,size\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;disk_size\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf left untouched and multiple disks are passed through, TrueNAS will complain about duplicate serials. To fix this, you have to add the serial option. It should now look like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003escsi\u0026lt;disk_number\u0026gt;: /dev/disk/by-id/\u0026lt;disk_id\u0026gt;,serial\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;serial\u0026gt;,size\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u0026lt;disk_size\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will now passthrough the disk with a unique serial.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eReboot the vm and the disk should appear.\u003c/p\u003e\n","description":"Disk passthrough for vms in Proxmox.","image":"images/truenas_disk.webp","permalink":"https://kovasky.me/blogs/disk_passthrough/","title":"Disk passthrough for vms in Proxmox"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter setting up the AD trust, every time I logged in the shell defaulted to /bin/sh. To change it to /bin/bash or any other shell of your choice you can do the following.\u003c/p\u003e\n\u003ch2 id=\"editing-sssdconf\"\u003eEditing SSSD.conf\u003c/h2\u003e\n\u003cp\u003eNavigate to /etc/sssd/ and open sssd.conf in an elevated text editor. It should look something like\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com/win.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter each domain, add your override shell. Something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eoverride_shell \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com/win.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eoverride_shell \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"restart-sssd-service\"\u003eRestart SSSD service\u003c/h2\u003e\n\u003cp\u003eAfter the modification has taken place, just restart the service with the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl restart sssd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou\u0026rsquo;re done! Next time you log in with your domain credentials, your default shell will be overriden.\u003c/p\u003e\n","description":"Replace the default shell for domain users on Linux in favour of bash.","image":"images/no_domain_login.webp","permalink":"https://kovasky.me/blogs/login_shell/","title":"Replace the default shell for domain users on Linux"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eTo better protect my web accessible services, I decided to use Fail2Ban in conjunction with Cloudflare\u0026rsquo;s WAF to block IPs with more than 3 failed login attempts. I already leverage Cloudflare\u0026rsquo;s CDN and geo-blocking capabilities on my homelab, so I opted to utilize their WAF to block access to potential attackers.\u003c/p\u003e\n\u003cp\u003eOn the free tier, the WAF is limited to 5 rules, which can easily reach their limit. A workaround is to create a rule that uses a blocklist and then with the Lists API, update it as required.\u003c/p\u003e\n\u003ch2 id=\"creating-an-api-key\"\u003eCreating an API key\u003c/h2\u003e\n\u003cp\u003eLog in to Cloudflare and navigate to My Profile -\u0026gt; API Tokens-\u0026gt; Create a Token-\u0026gt; Create a Custom Token. Give your token a name and make sure the permissions are as follows:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        srcset=\"data:image/webp;base64,UklGRkYFAABXRUJQVlA4IDoFAACwGgCdASp4ADoAABgAJ6QB3xBA2wD\u0026#43;Ae2BdAHuFZFyt3\u0026#43;wfj35u\u0026#43;I7zPGpuH\u0026#43;l35X8p/Tn/JeAPuD/ZvJL/e/xu/JD2wbQF6WfJf8R\u0026#43;Z39Y9IKRC/zfqX/oPEC\u0026#43;hf2T1IP5v/0fSI/rf8N\u0026#43;WntH\u0026#43;av97/hfgI/kv9B/0/9//d3\u0026#43;0f//w2/tf7Fn7HnjziQ\u0026#43;4qfbXolzYaZ/CPY0qaLBCbS0GMQc03R2cqGaKVKklCZOOukgw7Mt6bkYXOgLjHyFIdvtEuwUX2nFSesclT3FCfD1AOp7L44erWkvReStwAA/v//6BrT2zul9tA6RK51gg9U48dNRHel1/Hi2G0NXCa81gztfoPH/V//2aV9i\u0026#43;fh6lvjAYFTCTyngxLrs07Vy6n8LFt8M8Hrn0MBhSlfRPfr/5t\u0026#43;ZuQP44ZR3d/c7LMP5RJpABVYMQjH8HrIAATy6tDfrAcKwUqPcxjSDwlYhvhmVF/m8ORAtCogMb\u0026#43;6lC69uR4wgzrL/n3G0f\u0026#43;0xPaPeoO9//8CJ\u0026#43;2owXg6y6QgE2DigvPx56yKKab8k\u0026#43;Bo2mLR\u0026#43;fHWv4oi3OxmRjHUF1Q/uOHpfD1UEAVWAoDIDBuOuVTJn9Tk0v7Yh8t2AJr6cp924MduupZhpTJb2ni5PO/DWIaUSsuRRGfp\u0026#43;0Qb99Gwf1H9YDmNgnfXmMZoGun4dsK6fNVKm\u0026#43;dtygjadplDATD7gvZE86xSvtV3zyJR3K7Zu3Jb4QNLr71pKJpRPojUVnHBtet4dE3AAFuSO\u0026#43;wbN8uvp8XeuCLeKXVRVcX4IKIUmajblqMfH5JbUvnRw8bg/jZixLyt1gN/fVkaDpuMkCva6P46zB1dCAptZpbKIaXpzIlhMAKv\u0026#43;piUT7jyl5F\u0026#43;Fp7Z4nOlpGPhWjad6fbeHod65hFnOXTi0W8TDK/18kbWUOEm/KxBF3tYx4dcLgr2On7N4tUTWSeh2o5O76ZtNGZruqjoVKlq0sjSf21tPkSKXbu5JV1UXGmwrGG8/\u0026#43;JgVkmjd3Gvdbma2cv1O4Q4o9LOd/iByvZULRf3sMTZhsmsL4lzTBvlZkJ6AVGAn62qfS82Bzmw6Qf6tQUminZORXRW/qHNbfgTTI32e3kzsLUgEJ6v\u0026#43;hYDer3V36sKTUFhmebXoVQZwiC7aFvH\u0026#43;whkig/OJVWPBpmlcyFEiQM3hRQjR7akt\u0026#43;RzmMY/8pI7xe05QQW41hcvdmbHeF6jylNfF/GyFW0PEfGpsT3ByxPsArrGbMw0p\u0026#43;pDpc/qgP5/BoCiJj8yg58qbZjfbeJvdzC5rtIa0vFoZbwkK5LQtoyEExcmLS0wHNmJiWcwJMTdmwQhwCdT/z2UB\u0026#43;ddQXCbc9X\u0026#43;m/kJpE8N/K1OTaNzDs3nG5g5ZTLRX0l0XRq0RSNtsx5FVI1bA7IGPQC/fWEAcCLJPFgYESwNmQcGsIpBndbeCd7taR8a6NP/6i7Vy5tIf1HZkIVvJdoxuzHG2gKnr1L\u0026#43;DL7evroHFGs8ODKHpdAw/6KsYGJFQ5OiybyVZZOoJrhdNf1wyoWCwE23joeL0hLy6JPE4QByFGfxUhdQVKzzACAYAzZwSKbPwdVRfb1jp2LtQwMXruunA33Cv623NBWllNAzHLKOkxj1Xt/5xDy3\u0026#43;quh6vc7QyAtxHV/tgmeV\u0026#43;K7F\u0026#43;C4lw7bk0R1\u0026#43;zKmL/Zx\u0026#43;2\u0026#43;fIM9TgJUtlIvB70jGDaTmku1dsmTBdUD7WLSDTr1s2CfewjlCoQGzk95J3nw1QEoAOo4D3LAxOjr3I4xMVRkPxvgw0QnHAOSGH\u0026#43;JRfuxXUtQOiWBUl3\u0026#43;ZeOAAAAA=\"\n      \n     height=\"309\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloudflare_token-220x.webp 220w,\n/images/lazyimg/cloudflare_token-320x.webp 320w,\n/images/lazyimg/cloudflare_token-420x.webp 420w,\n/images/lazyimg/cloudflare_token-520x.webp 520w,\n/images/lazyimg/cloudflare_token-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/cloudflare_token-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"309\" width=\"640\" \n   srcset=\"/images/lazyimg/cloudflare_token-220x.webp 220w,\n/images/lazyimg/cloudflare_token-320x.webp 320w,\n/images/lazyimg/cloudflare_token-420x.webp 420w,\n/images/lazyimg/cloudflare_token-520x.webp 520w,\n/images/lazyimg/cloudflare_token-640x.webp 640w\"\n   alt=\"cloudflare token\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    src=\"data:image/webp;base64,UklGRkYFAABXRUJQVlA4IDoFAACwGgCdASp4ADoAABgAJ6QB3xBA2wD\u0026#43;Ae2BdAHuFZFyt3\u0026#43;wfj35u\u0026#43;I7zPGpuH\u0026#43;l35X8p/Tn/JeAPuD/ZvJL/e/xu/JD2wbQF6WfJf8R\u0026#43;Z39Y9IKRC/zfqX/oPEC\u0026#43;hf2T1IP5v/0fSI/rf8N\u0026#43;WntH\u0026#43;av97/hfgI/kv9B/0/9//d3\u0026#43;0f//w2/tf7Fn7HnjziQ\u0026#43;4qfbXolzYaZ/CPY0qaLBCbS0GMQc03R2cqGaKVKklCZOOukgw7Mt6bkYXOgLjHyFIdvtEuwUX2nFSesclT3FCfD1AOp7L44erWkvReStwAA/v//6BrT2zul9tA6RK51gg9U48dNRHel1/Hi2G0NXCa81gztfoPH/V//2aV9i\u0026#43;fh6lvjAYFTCTyngxLrs07Vy6n8LFt8M8Hrn0MBhSlfRPfr/5t\u0026#43;ZuQP44ZR3d/c7LMP5RJpABVYMQjH8HrIAATy6tDfrAcKwUqPcxjSDwlYhvhmVF/m8ORAtCogMb\u0026#43;6lC69uR4wgzrL/n3G0f\u0026#43;0xPaPeoO9//8CJ\u0026#43;2owXg6y6QgE2DigvPx56yKKab8k\u0026#43;Bo2mLR\u0026#43;fHWv4oi3OxmRjHUF1Q/uOHpfD1UEAVWAoDIDBuOuVTJn9Tk0v7Yh8t2AJr6cp924MduupZhpTJb2ni5PO/DWIaUSsuRRGfp\u0026#43;0Qb99Gwf1H9YDmNgnfXmMZoGun4dsK6fNVKm\u0026#43;dtygjadplDATD7gvZE86xSvtV3zyJR3K7Zu3Jb4QNLr71pKJpRPojUVnHBtet4dE3AAFuSO\u0026#43;wbN8uvp8XeuCLeKXVRVcX4IKIUmajblqMfH5JbUvnRw8bg/jZixLyt1gN/fVkaDpuMkCva6P46zB1dCAptZpbKIaXpzIlhMAKv\u0026#43;piUT7jyl5F\u0026#43;Fp7Z4nOlpGPhWjad6fbeHod65hFnOXTi0W8TDK/18kbWUOEm/KxBF3tYx4dcLgr2On7N4tUTWSeh2o5O76ZtNGZruqjoVKlq0sjSf21tPkSKXbu5JV1UXGmwrGG8/\u0026#43;JgVkmjd3Gvdbma2cv1O4Q4o9LOd/iByvZULRf3sMTZhsmsL4lzTBvlZkJ6AVGAn62qfS82Bzmw6Qf6tQUminZORXRW/qHNbfgTTI32e3kzsLUgEJ6v\u0026#43;hYDer3V36sKTUFhmebXoVQZwiC7aFvH\u0026#43;whkig/OJVWPBpmlcyFEiQM3hRQjR7akt\u0026#43;RzmMY/8pI7xe05QQW41hcvdmbHeF6jylNfF/GyFW0PEfGpsT3ByxPsArrGbMw0p\u0026#43;pDpc/qgP5/BoCiJj8yg58qbZjfbeJvdzC5rtIa0vFoZbwkK5LQtoyEExcmLS0wHNmJiWcwJMTdmwQhwCdT/z2UB\u0026#43;ddQXCbc9X\u0026#43;m/kJpE8N/K1OTaNzDs3nG5g5ZTLRX0l0XRq0RSNtsx5FVI1bA7IGPQC/fWEAcCLJPFgYESwNmQcGsIpBndbeCd7taR8a6NP/6i7Vy5tIf1HZkIVvJdoxuzHG2gKnr1L\u0026#43;DL7evroHFGs8ODKHpdAw/6KsYGJFQ5OiybyVZZOoJrhdNf1wyoWCwE23joeL0hLy6JPE4QByFGfxUhdQVKzzACAYAzZwSKbPwdVRfb1jp2LtQwMXruunA33Cv623NBWllNAzHLKOkxj1Xt/5xDy3\u0026#43;quh6vc7QyAtxHV/tgmeV\u0026#43;K7F\u0026#43;C4lw7bk0R1\u0026#43;zKmL/Zx\u0026#43;2\u0026#43;fIM9TgJUtlIvB70jGDaTmku1dsmTBdUD7WLSDTr1s2CfewjlCoQGzk95J3nw1QEoAOo4D3LAxOjr3I4xMVRkPxvgw0QnHAOSGH\u0026#43;JRfuxXUtQOiWBUl3\u0026#43;ZeOAAAAA=\"\n  \n  data-src=\"/images/lazyimg/cloudflare_token-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"309\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloudflare_token-220x.webp 220w,\n/images/lazyimg/cloudflare_token-320x.webp 320w,\n/images/lazyimg/cloudflare_token-420x.webp 420w,\n/images/lazyimg/cloudflare_token-520x.webp 520w,\n/images/lazyimg/cloudflare_token-640x.webp 640w\"\n alt=\"cloudflare token\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eKeep this token handy as it will be used later.\u003c/p\u003e\n\u003ch2 id=\"creating-a-list\"\u003eCreating a list\u003c/h2\u003e\n\u003cp\u003eLog in to Cloudflare, navigate to Manage Account -\u0026gt; Configurations -\u0026gt; Lists. Under Lists, create a new list with type IP and name it \u0026ldquo;block_list.\u0026rdquo; It should look something like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/cloudflare_list-120x%20Gaussian.webp\"\n      \n     height=\"271\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloudflare_list-220x.webp 220w,\n/images/lazyimg/cloudflare_list-320x.webp 320w,\n/images/lazyimg/cloudflare_list-420x.webp 420w,\n/images/lazyimg/cloudflare_list-520x.webp 520w,\n/images/lazyimg/cloudflare_list-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/cloudflare_list-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"271\" width=\"640\" \n   srcset=\"/images/lazyimg/cloudflare_list-220x.webp 220w,\n/images/lazyimg/cloudflare_list-320x.webp 320w,\n/images/lazyimg/cloudflare_list-420x.webp 420w,\n/images/lazyimg/cloudflare_list-520x.webp 520w,\n/images/lazyimg/cloudflare_list-640x.webp 640w\"\n   alt=\"block_list\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/cloudflare_list-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/cloudflare_list-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"271\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/cloudflare_list-220x.webp 220w,\n/images/lazyimg/cloudflare_list-320x.webp 320w,\n/images/lazyimg/cloudflare_list-420x.webp 420w,\n/images/lazyimg/cloudflare_list-520x.webp 520w,\n/images/lazyimg/cloudflare_list-640x.webp 640w\"\n alt=\"block_list\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eMake sure to write down your user id plus the id of this list. You can get it by clicking edit and taking a look at the url. It should look something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ehttps://dash.cloudflare.com/\u0026lt;user id\u0026gt;/configurations/lists/\u0026lt;list id\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"modifying-the-list\"\u003eModifying the list\u003c/h2\u003e\n\u003cp\u003eTo modify the list, I made a small python script which uses some of the details that were recorded before.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/python3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eCalled by entryPoint.py, performs the addition or deletion of an item in a Cloudflare custom list.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eSupport for IPV6 is limited as it blocks the entire /64 subnet.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e requests\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e requests \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e Response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e json\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e ipaddress\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetIPList\u003c/span\u003e(apiEndpoint : str, headers : dict) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e json:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estatus_code \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejson()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Failed to fetch existing IP list. Status code: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eresponse\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estatus_code\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etext)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexit(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaddIPtoList\u003c/span\u003e(ipAddr : str, apiEndpoint : str, headers : dict) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e Response:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e: ipAddr}]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epost(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders, data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eremoveIPFromList\u003c/span\u003e(ipId : str, apiEndpoint : str, headers : dict) \u003cspan style=\"color:#f92672\"\u003e-\u0026gt;\u003c/span\u003e Response:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;items\u0026#34;\u003c/span\u003e: [{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: ipId}]}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edelete(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders, data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e response\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e __name__ \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;__main__\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Usage: ./modifyBanList.py \u0026lt;ip\u0026gt; \u0026lt;add|del\u0026gt;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexit(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ipAddr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        addr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e ipaddress\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eIPv6Address(ipAddr)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        first_64_bits \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e str(addr\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexploded)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esplit(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e)[:\u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipAddr \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(first_64_bits) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;::/64\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eexcept\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003epass\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    action \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    listId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    accountId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    email \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    apiKey \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    apiEndpoint \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://api.cloudflare.com/client/v4/accounts/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eaccountId\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/rules/lists/\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003elistId\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e/items\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    headers \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;X-Auth-Email\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eemail\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;X-Auth-Key\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eapiKey\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Content-Type\u0026#39;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;application/json\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    existingIpList \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e getIPList(apiEndpoint,headers)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(existingIpList)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e action \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;del\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ipId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e existingIpList[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;result\u0026#39;\u003c/span\u003e]:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e item[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ip\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e ipAddr:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                ipId \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e item[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;items\u0026#34;\u003c/span\u003e: [{\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e: ipId}]}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e ipId \u003cspan style=\"color:#f92672\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edelete(apiEndpoint,headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders,data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e any(item[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ip\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e ipAddr \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e item \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e existingIpList[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;result\u0026#39;\u003c/span\u003e]):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        payload \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e: ipAddr\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        response \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e requests\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epost(apiEndpoint, headers\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eheaders, data\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejson\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edumps(payload))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e response \u003cspan style=\"color:#f92672\"\u003eis\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e response\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estatus_code \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;IP address \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eipAddr\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eaction\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e to the custom IP list successfully.\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Failed to \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eaction\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e IP address \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eipAddr\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e to the custom IP list.\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis should add or remove any desired IP from the block list.\u003c/p\u003e\n\u003ch2 id=\"entry-point\"\u003eEntry Point\u003c/h2\u003e\n\u003cp\u003eMy Fail2Ban instance is a container which luckily enough has python. To make sure the script has all required dependencies, I made an entrypoint which then calls the previous script.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/usr/bin/python3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eCreates a virtual environment, installs dependencies, and then calls modifyBanList.py\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e os\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sys\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e len(sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Usage: ./entryPoint.py \u0026lt;ip\u0026gt; \u0026lt;add|del\u0026gt;\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    sys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexit(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evenv_dir \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;env\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003enot\u003c/span\u003e os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexists(venv_dir):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esystem(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eexecutable\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e -m venv \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003evenv_dir\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esystem(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(venv_dir, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bin\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;pip\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e install --upgrade requests ipaddress\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esystem(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003eos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(venv_dir, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bin\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;python\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e /data/action.d/modifyBanList.py \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003esys\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eargv[\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"cloudflareconf\"\u003eCloudflare.conf\u003c/h2\u003e\n\u003cp\u003eTo glue all of it together, a conf file will tell Fail2Ban how to call the script when a ban or unban action needs to take place.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eDefinition\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionban \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /data/action.d/entryPoint.py \u0026lt;ip\u0026gt; add\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eactionunban \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e /data/action.d/entryPoint.py \u0026lt;ip\u0026gt; del\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"jaild\"\u003eJail.d\u003c/h2\u003e\n\u003cp\u003eIn my config, I am directly using the jail.local and it looks something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eDEFAULT\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaction \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e cloudflare\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eSome next steps are to configure a filter, add it to the jail, and later use a VPN to generate some unsuccesful events. Once the ban takes place, it may take a few seconds to propapage on Cloudflare.\u003c/p\u003e\n\u003cp\u003eYou can take a look at these scripts \u003ca href=\"https://git.agrajag.cloud/kova/homelabscripts\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n","description":"Using Fail2Ban with Cloudflare on a free account to block IPs","image":"images/cloudflare_fail2ban_logs.webp","permalink":"https://kovasky.me/blogs/cloudflare_fail2ban/","title":"Using Fail2Ban with Cloudflare on a free account"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter creating my domain trust between AD and FreeIPA, I was left wanting to access restricted resources in Linux using my AD accounts. To circumvent this, I mapped a group from AD to FreeIPA and gave it the appropriate permissions.\u003c/p\u003e\n\u003ch2 id=\"create-the-group-in-ad\"\u003eCreate the group in AD\u003c/h2\u003e\n\u003cp\u003eThe first step would be to create a group in AD to which sudo will be mapped. In my case, I created a group named \u0026lsquo;sudo\u0026rsquo; to match the Linux counterpart. To do this, navigate to Server Manager -\u0026gt; Active Directory Users and Computers -\u0026gt; Users. Then, right-click and go to New -\u0026gt; Group. In the name, type \u0026lsquo;sudo\u0026rsquo;. After the item is created, it should look like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/sudo_group-120x%20Gaussian.webp\"\n      \n     height=\"730\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/sudo_group-220x.webp 220w,\n/images/lazyimg/sudo_group-320x.webp 320w,\n/images/lazyimg/sudo_group-420x.webp 420w,\n/images/lazyimg/sudo_group-520x.webp 520w,\n/images/lazyimg/sudo_group-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/sudo_group-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"730\" width=\"640\" \n   srcset=\"/images/lazyimg/sudo_group-220x.webp 220w,\n/images/lazyimg/sudo_group-320x.webp 320w,\n/images/lazyimg/sudo_group-420x.webp 420w,\n/images/lazyimg/sudo_group-520x.webp 520w,\n/images/lazyimg/sudo_group-640x.webp 640w\"\n   alt=\"sudo group in AD\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/sudo_group-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/sudo_group-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"730\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/sudo_group-220x.webp 220w,\n/images/lazyimg/sudo_group-320x.webp 320w,\n/images/lazyimg/sudo_group-420x.webp 420w,\n/images/lazyimg/sudo_group-520x.webp 520w,\n/images/lazyimg/sudo_group-640x.webp 640w\"\n alt=\"sudo group in AD\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"create-policies\"\u003eCreate policies\u003c/h2\u003e\n\u003cp\u003eNavigate to Policy -\u0026gt; Sudo -\u0026gt; Sudo Rules. Here, you can create a new rule or directly use the \u0026lsquo;All\u0026rsquo; rule. In my case, I created a rule titled \u0026lsquo;sudorule\u0026rsquo;.\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/ad_sudo_rule-120x%20Gaussian.webp\"\n      \n     height=\"424\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ad_sudo_rule-220x.webp 220w,\n/images/lazyimg/ad_sudo_rule-320x.webp 320w,\n/images/lazyimg/ad_sudo_rule-420x.webp 420w,\n/images/lazyimg/ad_sudo_rule-520x.webp 520w,\n/images/lazyimg/ad_sudo_rule-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/ad_sudo_rule-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"424\" width=\"640\" \n   srcset=\"/images/lazyimg/ad_sudo_rule-220x.webp 220w,\n/images/lazyimg/ad_sudo_rule-320x.webp 320w,\n/images/lazyimg/ad_sudo_rule-420x.webp 420w,\n/images/lazyimg/ad_sudo_rule-520x.webp 520w,\n/images/lazyimg/ad_sudo_rule-640x.webp 640w\"\n   alt=\"sudorule in FreeIPA\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/ad_sudo_rule-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/ad_sudo_rule-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"424\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/ad_sudo_rule-220x.webp 220w,\n/images/lazyimg/ad_sudo_rule-320x.webp 320w,\n/images/lazyimg/ad_sudo_rule-420x.webp 420w,\n/images/lazyimg/ad_sudo_rule-520x.webp 520w,\n/images/lazyimg/ad_sudo_rule-640x.webp 640w\"\n alt=\"sudorule in FreeIPA\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003cp\u003eTo allow commands, navigate to \u0026lsquo;Run Commands\u0026rsquo; and click \u0026lsquo;Any Command\u0026rsquo;. This will essentially make users root (very dangerous). It should look something like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        \n        srcset=\"/images/lazyimg/allow_any_command-120x%20Gaussian.webp\"\n      \n     height=\"457\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/allow_any_command-220x.webp 220w,\n/images/lazyimg/allow_any_command-320x.webp 320w,\n/images/lazyimg/allow_any_command-420x.webp 420w,\n/images/lazyimg/allow_any_command-520x.webp 520w,\n/images/lazyimg/allow_any_command-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/allow_any_command-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"457\" width=\"640\" \n   srcset=\"/images/lazyimg/allow_any_command-220x.webp 220w,\n/images/lazyimg/allow_any_command-320x.webp 320w,\n/images/lazyimg/allow_any_command-420x.webp 420w,\n/images/lazyimg/allow_any_command-520x.webp 520w,\n/images/lazyimg/allow_any_command-640x.webp 640w\"\n   alt=\"allow any command\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    \n    src=\"/images/lazyimg/allow_any_command-120x%20Gaussian.webp\"\n  \n  data-src=\"/images/lazyimg/allow_any_command-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"457\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/allow_any_command-220x.webp 220w,\n/images/lazyimg/allow_any_command-320x.webp 320w,\n/images/lazyimg/allow_any_command-420x.webp 420w,\n/images/lazyimg/allow_any_command-520x.webp 520w,\n/images/lazyimg/allow_any_command-640x.webp 640w\"\n alt=\"allow any command\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"add-the-external-group-to-the-sudo-rule\"\u003eAdd the external group to the sudo rule\u003c/h2\u003e\n\u003cp\u003eConnect to your FreeIPA server as an admin. Then issue the command\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eipa sudorule-add-user sudorule --groups \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;sudo@win.mydomain.com\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will map the external AD group to the sudo rule you just created. Navigate to the FreeIPA web interface under Policy -\u0026gt; Sudo -\u0026gt; Sudo Rules -\u0026gt; sudorule and It should look like:\u003c/p\u003e\n\n\n    \n\n\n    \n\n\n\n\n\n\n\n    \n    \n    \n\n\n\n\n\n\n\n\n\n\n\n    \n    \n        \n        \n        \n        \n        \n        \n\n\n\n\n\n\u003cpicture\u003e\n  \u003csource type=\"image/webp\"\n    \n      \n        srcset=\"data:image/webp;base64,UklGRmQFAABXRUJQVlA4WAoAAAAQAAAAdwAAGwAAQUxQSBoAAAABD6AQQADE37nRiIgYCAkI/0\u0026#43;LshbR/7R4AlZQOCAkBQAAUBkAnQEqeAAcAAAYACekNvMJXrWZ/qBlgG8W/st6I2rqrq/oX4h\u0026#43;bvff8M\u0026#43;z37gcgRkT9p/LL2E/pP5AcCH\u0026#43;u/kX\u0026#43;SG5a/rvkffEv7b\u0026#43;Yf\u0026#43;E9CjUCwMfzr\u0026#43;5ekHeDd2eoj/RP8N9wHxF/0/9y/K/2m/LX\u0026#43;q/wX44/YF/KP57/hv7V\u0026#43;6n\u0026#43;I///08etj9h/Yq/VU8cyl3QamrBhR2xutdE/P\u0026#43;fVPp5JvqpwoZVmmsChWZ9huW7t5lr\u0026#43;gG/\u0026#43;eA404svMKLxOAJFKI1THVrdtc310yZ1kAD\u0026#43;///uwHkZhpAxUFjSvf\u0026#43;f5NSH9zS/403nbOV8T1cObtZmpxafgJv9vr5r79ieoIg5zbOgXrN8YyP84jmHI90hFkoho2mFRfgQccqQJJeljL2yf67BbivWUCa1P9YJPQGW8GVrKe4BdyL0fy2VWce9QpjOTSVZ\u0026#43;Ucm34/9jtNHcvd/mRYDU44T7H8PogrgM5gXSvlh8omKQXVdZj6MOW/TK3cxBBmboK89h6Gcl/DuMR3QRhdsvtYUmUmGlW8Dx\u0026#43;F9gU9\u0026#43;90rL4kHg5Eibe5g3MObdk8bf1zsTf9Z80j/TmCsWg7JuNjvn5I\u0026#43;qg7L/OjuVkJ6tgrGvPPm6PUU7iK1OSh5tSINI8NUIPk1uE9XjIqnEllpxW9wPzObhEaSikxFr4HrKqiOMliX6uqGQDxFtMW2bBHtjcwb61FWe9AfftiHYYslRFQlwsQ3fAGzeF/zcPpJsCknd3Si\u0026#43;QPnEzV12YUeet/pgTUZG1vz2hjVaFC9HAeENlkXZ9kmNW/wCB/3yT\u0026#43;370cMrYeMBA7\u0026#43;noO/4//hpYOAxbLMXdGsw3iqgpml2ZvtV\u0026#43;Z1vxqWUxuhK01AEfWI4eZNSHOX32rfTzAnvJEKbqb\u0026#43;Hrrp85hzPi1miywADZSFGARdxcsURdD9aZ3fEUViNR9wUR5aI3j5eEuXBLy1TXolMn2\u0026#43;fdM4CZ036XmsAOD7ApRdPe0Bso1tUNRMMfSV0/Jpe7v5KpG3GKCcRdpOKPhKMeAvGeTVRp11Rul264E67E\u0026#43;lhsQbnA6wTpuY2lVT6FTsGxAsf11F66I\u0026#43;SQ6\u0026#43;5t9Xd/rWF6316g5D4bnf3KhOWo84Njz2eRX2r6WQ47wwigKBXFRA3S\u0026#43;/6vFfl6kgnjW9fFZQzD8DfR//B5gVUFRy\u0026#43;16hj9gChlb60ZiTknEgtUpz/O3S\u0026#43;RzCA4lSjbtorL77bV1hqI98t8hDCfSYd3FFJIZo1ggcXGNrom9erdhZB4qTtm9srQnWbLCt9Jbi5v/qu455G0Yg\u0026#43;P1gugeLBNvKL/QpW66DLrb9UdwaPh6ThkxmCaiYE5SYPU5yKt/51O9hVA9Ii8G7DTUHflvGwuni\u0026#43;BWf5mIO3xIp16DcHxCoFe7voxpx1A20X5ookfHX/VQziLl80sOO9wg5TBWw\u0026#43;oVXTkbkX/mcSmtRYGeP/Z515fIC/50aE83i8T0XffeishCY1cjNY2m5lmnXHIKXgZsz31P4i79CkDHTaXcZx4YrlgYzW0foJ1Z\u0026#43;/P7bsn/njexT1NPAlpmHJIHtQGAdNUarI3mXxni7xiIGNXd6laQABbNml/Na2urUjigL1zIcEpqfxgYGVmBSVcreW6j5Yvm31pK76yqEs5HNozirtecywg\u0026#43;VfwyUOh4hbeACPmcBlj1dja/ElIcUAltGJ8Rwd2QmoaHSY8NVppDQwSft9OGeTrfsLEt/dCMNothdc43TtkcJSdMUOI6cc\u0026#43;SGvx4nitp5P\u0026#43;k1rqzPqPQMAAAA=\"\n      \n     height=\"151\" width=\"640\" \n     data-sizes=\"auto\" data-srcset=\"/images/lazyimg/external_group_sudorule-220x.webp 220w,\n/images/lazyimg/external_group_sudorule-320x.webp 320w,\n/images/lazyimg/external_group_sudorule-420x.webp 420w,\n/images/lazyimg/external_group_sudorule-520x.webp 520w,\n/images/lazyimg/external_group_sudorule-640x.webp 640w\"\u003e\n  \n\n\n\n\u003cnoscript\u003e\n\n\n\n\n\n\n\u003cimg src=\"/images/lazyimg/external_group_sudorule-640x.webp\"\n  class=\"\" loading=\"lazy\"\n   height=\"151\" width=\"640\" \n   srcset=\"/images/lazyimg/external_group_sudorule-220x.webp 220w,\n/images/lazyimg/external_group_sudorule-320x.webp 320w,\n/images/lazyimg/external_group_sudorule-420x.webp 420w,\n/images/lazyimg/external_group_sudorule-520x.webp 520w,\n/images/lazyimg/external_group_sudorule-640x.webp 640w\"\n   alt=\"external group in sudorule\" \u003e\n\u003c/noscript\u003e\n\n\n\n\n\u003cimg\n\n  \n    src=\"data:image/webp;base64,UklGRmQFAABXRUJQVlA4WAoAAAAQAAAAdwAAGwAAQUxQSBoAAAABD6AQQADE37nRiIgYCAkI/0\u0026#43;LshbR/7R4AlZQOCAkBQAAUBkAnQEqeAAcAAAYACekNvMJXrWZ/qBlgG8W/st6I2rqrq/oX4h\u0026#43;bvff8M\u0026#43;z37gcgRkT9p/LL2E/pP5AcCH\u0026#43;u/kX\u0026#43;SG5a/rvkffEv7b\u0026#43;Yf\u0026#43;E9CjUCwMfzr\u0026#43;5ekHeDd2eoj/RP8N9wHxF/0/9y/K/2m/LX\u0026#43;q/wX44/YF/KP57/hv7V\u0026#43;6n\u0026#43;I///08etj9h/Yq/VU8cyl3QamrBhR2xutdE/P\u0026#43;fVPp5JvqpwoZVmmsChWZ9huW7t5lr\u0026#43;gG/\u0026#43;eA404svMKLxOAJFKI1THVrdtc310yZ1kAD\u0026#43;///uwHkZhpAxUFjSvf\u0026#43;f5NSH9zS/403nbOV8T1cObtZmpxafgJv9vr5r79ieoIg5zbOgXrN8YyP84jmHI90hFkoho2mFRfgQccqQJJeljL2yf67BbivWUCa1P9YJPQGW8GVrKe4BdyL0fy2VWce9QpjOTSVZ\u0026#43;Ucm34/9jtNHcvd/mRYDU44T7H8PogrgM5gXSvlh8omKQXVdZj6MOW/TK3cxBBmboK89h6Gcl/DuMR3QRhdsvtYUmUmGlW8Dx\u0026#43;F9gU9\u0026#43;90rL4kHg5Eibe5g3MObdk8bf1zsTf9Z80j/TmCsWg7JuNjvn5I\u0026#43;qg7L/OjuVkJ6tgrGvPPm6PUU7iK1OSh5tSINI8NUIPk1uE9XjIqnEllpxW9wPzObhEaSikxFr4HrKqiOMliX6uqGQDxFtMW2bBHtjcwb61FWe9AfftiHYYslRFQlwsQ3fAGzeF/zcPpJsCknd3Si\u0026#43;QPnEzV12YUeet/pgTUZG1vz2hjVaFC9HAeENlkXZ9kmNW/wCB/3yT\u0026#43;370cMrYeMBA7\u0026#43;noO/4//hpYOAxbLMXdGsw3iqgpml2ZvtV\u0026#43;Z1vxqWUxuhK01AEfWI4eZNSHOX32rfTzAnvJEKbqb\u0026#43;Hrrp85hzPi1miywADZSFGARdxcsURdD9aZ3fEUViNR9wUR5aI3j5eEuXBLy1TXolMn2\u0026#43;fdM4CZ036XmsAOD7ApRdPe0Bso1tUNRMMfSV0/Jpe7v5KpG3GKCcRdpOKPhKMeAvGeTVRp11Rul264E67E\u0026#43;lhsQbnA6wTpuY2lVT6FTsGxAsf11F66I\u0026#43;SQ6\u0026#43;5t9Xd/rWF6316g5D4bnf3KhOWo84Njz2eRX2r6WQ47wwigKBXFRA3S\u0026#43;/6vFfl6kgnjW9fFZQzD8DfR//B5gVUFRy\u0026#43;16hj9gChlb60ZiTknEgtUpz/O3S\u0026#43;RzCA4lSjbtorL77bV1hqI98t8hDCfSYd3FFJIZo1ggcXGNrom9erdhZB4qTtm9srQnWbLCt9Jbi5v/qu455G0Yg\u0026#43;P1gugeLBNvKL/QpW66DLrb9UdwaPh6ThkxmCaiYE5SYPU5yKt/51O9hVA9Ii8G7DTUHflvGwuni\u0026#43;BWf5mIO3xIp16DcHxCoFe7voxpx1A20X5ookfHX/VQziLl80sOO9wg5TBWw\u0026#43;oVXTkbkX/mcSmtRYGeP/Z515fIC/50aE83i8T0XffeishCY1cjNY2m5lmnXHIKXgZsz31P4i79CkDHTaXcZx4YrlgYzW0foJ1Z\u0026#43;/P7bsn/njexT1NPAlpmHJIHtQGAdNUarI3mXxni7xiIGNXd6laQABbNml/Na2urUjigL1zIcEpqfxgYGVmBSVcreW6j5Yvm31pK76yqEs5HNozirtecywg\u0026#43;VfwyUOh4hbeACPmcBlj1dja/ElIcUAltGJ8Rwd2QmoaHSY8NVppDQwSft9OGeTrfsLEt/dCMNothdc43TtkcJSdMUOI6cc\u0026#43;SGvx4nitp5P\u0026#43;k1rqzPqPQMAAAA=\"\n  \n  data-src=\"/images/lazyimg/external_group_sudorule-640x.webp\"\n  class=\"blur-up lazyload\"\n height=\"151\" width=\"640\" \n data-sizes=\"auto\" data-srcset=\"/images/lazyimg/external_group_sudorule-220x.webp 220w,\n/images/lazyimg/external_group_sudorule-320x.webp 320w,\n/images/lazyimg/external_group_sudorule-420x.webp 420w,\n/images/lazyimg/external_group_sudorule-520x.webp 520w,\n/images/lazyimg/external_group_sudorule-640x.webp 640w\"\n alt=\"external group in sudorule\" \u003e\n\n\u003c/picture\u003e\n\n    \n\n\n\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eOnce everything is set-up, members of this group should be limited/allowed to elements and commands as defined by the policies set in place.\u003c/p\u003e\n","description":"Map Active Directory groups in FreeIPA to control access to resources within Linux environments based on AD group memberships.","image":"images/mapping_sudo.webp","permalink":"https://kovasky.me/blogs/mapping_sudo/","title":"Map an Active Directory group to sudo in Linux"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter creating a trust in FreeIPA, I kept having to write the full domain alongside my username whenever I tried to access the system. These are the steps I took to log in only with my username.\u003c/p\u003e\n\u003ch2 id=\"editing-sssdconf\"\u003eEditing SSSD.conf\u003c/h2\u003e\n\u003cp\u003eNavigate to /etc/sssd/ and open sssd.conf in an elevated text editor. It should look something like\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eservices \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e nss, pam, ssh, sudo\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edomains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e lin.mydomain.com\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBefore [sssd], add your trusted domain. Something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003edomain/lin.mydomain.com/win.mydomain.com\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003euse_fully_qualified_names \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e false\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003esssd\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"restart-sssd-service\"\u003eRestart SSSD service\u003c/h3\u003e\n\u003cp\u003eAfter the modification has taken place, just restart the service with the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl restart sssd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou\u0026rsquo;re done! Next time you log in, you will only have to specify your username.\u003c/p\u003e\n","description":"Access an Active Directory (AD) trusted Linux host without specifying the domain.","image":"images/no_domain_login.webp","permalink":"https://kovasky.me/blogs/no_domain_login/","title":"Log in to Linux using AD credentials without specifying the domain"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI\u0026rsquo;ve been playing around with FreeIPA in my homelab for a while and have always wanted to enable seamless authentication between all my hosts regardless of their operating system. I stumbled upon the concept of cross-domain trusts between FreeIPA and Active Directory which allows us to achieve this.\u003c/p\u003e\n\u003cp\u003eThere is a caveat though, and that is that two-way trusts are still not fully implemented in FreeIPA, which means Windows users can authenticate against Linux hosts but Linux users can\u0026rsquo;t do the same the other way around.\u003c/p\u003e\n\u003ch2 id=\"creating-the-trust-on-your-freeipa-server\"\u003eCreating the trust (on your FreeIPA server)\u003c/h2\u003e\n\u003cp\u003eFirst, make sure that your FreeIPA server and your Active Directory do not share the same domain. You can have each of them be on a subdomain of the other or even create custom domains altogether. In my case, I went with lin.mydomain.com for FreeIPA and win.mydomain.com for Active Directory. Once the servers are set up with their respective domains, you can begin setting up the trust.\u003c/p\u003e\n\u003cp\u003eYou should have the following ports open:\nTCP ports: 53, 80, 88, 135, 138, 139, 389, 443, 445, 464, 636, 1024-1300\nUDP ports: 53, 88, 123, 138, 139, 389, 445, 464,\u003c/p\u003e\n\u003cp\u003eMake sure to install the ad trust package for FreeIPA:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eyum install \u003cspan style=\"color:#ae81ff\"\u003e\\*\u003c/span\u003eipa-server-trust-ad\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen proceed to run the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekinit \u0026lt;user with ipa admin privileges\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eipa-adtrust-install\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFollow the on-screen instructions to input your ad domain, domain admin, and password.\u003c/p\u003e\n\u003ch2 id=\"validating-the-trust-on-your-ad-server\"\u003eValidating the Trust (on your AD server)\u003c/h2\u003e\n\u003cp\u003eOn server manager, navigate to tools-\u0026gt;Active Directory Domains and Trusts. Right-click on your domain, and select properties. Click on Trusts, select the incoming trust for your FreeIPA domain, and click validate. Input your domain admin credentials.\u003c/p\u003e\n\u003ch2 id=\"validating-the-trust-on-your-freeipa-server\"\u003eValidating the Trust (on your FreeIPA server)\u003c/h2\u003e\n\u003cp\u003eTry to log in using \u003cem\u003ekinit \u003ca href=\"mailto:user@win.mydomain.local\"\u003euser@win.mydomain.local\u003c/a\u003e\u003c/em\u003e. If everything is right, this should succeed.\u003c/p\u003e\n","description":"Set up a cross-domain trust between FreeIPA and Active Directory to enable Windows authentication on Linux hosts.","image":"images/ad_trust.webp","permalink":"https://kovasky.me/blogs/ad_trust/","title":"Setting up a cross-domain trust between FreeIPA and AD"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eOne of the nodes in my lab runs pfSense and if the vm is down, my network is down. This prevents my nodes from reaching quorum, and thus preventing pfSense from starting. To solve this, I needed a way for the vm to start without quorum. This was achieved by creating a oneshot service that runs at system startup.\u003c/p\u003e\n\u003ch2 id=\"create-the-script\"\u003eCreate the script\u003c/h2\u003e\n\u003cp\u003eCreate a script in a folder of your choice, like \u003ccode\u003e/root/startpfSense.sh\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003ePlace the following inside it, replacing the vmID for the id of the vm you want to start:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esleep \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esystemctl stop pve-cluster\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epmxcfs -l\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eqm start $vmID\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esleep \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ekillall pmxcfs\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esystemctl start pve-cluster\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this, make sure to give it the proper permissions to make it executable.\u003c/p\u003e\n\u003ch2 id=\"create-the-service-file\"\u003eCreate the service file\u003c/h2\u003e\n\u003cp\u003eNow, create a service file like \u003ccode\u003e/etc/systemd/system/startpfSense.service\u003c/code\u003e and using a text editor add the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eUnit\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDescription\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eStart pfSense without quorum\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAfter\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epve-cluster.service\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eService\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etype\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eoneshot\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/root/startpfSense.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eInstall\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWantedBy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003emulti-user.target\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"enabling-the-service\"\u003eEnabling the service\u003c/h2\u003e\n\u003cp\u003eTo enable the service, you would do \u003ccode\u003esystemctl daemon-reload\u003c/code\u003e and later \u003ccode\u003esystemctl enable startpfSense.service\u003c/code\u003e. To check the status of the service, you would run \u003ccode\u003esystemctl status startpfSense\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eNow, your vm will be started on your next reboot.\u003c/p\u003e\n","description":"Start a vm on boot without quorum.","image":"images/oneshot.webp","permalink":"https://kovasky.me/blogs/oneshot/","title":"Starting a VM in Proxmox without Quorum"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eThis is just a post to describe my homelab setup and make it linkable where needed (like in my resume). This is most definitely subject to change at any time as I continue to play with new technologies and keep adding things!\u003c/p\u003e\n\u003ch2 id=\"hosts\"\u003eHosts\u003c/h2\u003e\n\u003cp\u003eMy homelab consists of a one node proxmox host and a terramaster NAS.\u003c/p\u003e\n\u003cp\u003eThe specs are:\u003c/p\u003e\n\u003ch5 id=\"dell-poweredge-t440\"\u003eDell Poweredge T440\u003c/h5\u003e\n\u003cul\u003e\n\u003cli\u003e2x Xeon Gold 6126 (48 logical cores)\u003c/li\u003e\n\u003cli\u003e128GB RAM\u003c/li\u003e\n\u003cli\u003e1x 118GB Intel Optane NVME\u003c/li\u003e\n\u003cli\u003e2x 1TB MX500 SSD\u003c/li\u003e\n\u003cli\u003e2x 8TB Toshiba SAS Drive\u003c/li\u003e\n\u003cli\u003e1x 14TB IronWolf Pro Drive\u003c/li\u003e\n\u003cli\u003e1x Nvidia Quadro M2000\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor storage I have a TerraMaster F2-220 running DSM through tinycore with 2x 6TB Ironwolf HDDs.\u003c/p\u003e\n\u003ch2 id=\"use-cases\"\u003eUse Cases\u003c/h2\u003e\n\u003cp\u003eMy homelab is mainly to have fun! I enjoy tinkering and learning new technologies so I put most of my free time in this :)\u003c/p\u003e\n\u003cp\u003eSome cool stuff im doing is the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epfSense directly hooked to my ISPs modem with BIND and Suricata to have control over my local network.\u003c/li\u003e\n\u003cli\u003eHomebridge to have remote access to my custom IP camera built using an ESP32.\u003c/li\u003e\n\u003cli\u003ePlex for viewing my media on the go.\u003c/li\u003e\n\u003cli\u003eWireGuard for outside access to my servers.\u003c/li\u003e\n\u003cli\u003eNginx + Authelia + Fail2Ban to expose services over the web as well as automatically ban unauthorized access attempts at a Cloudflare level.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"what-am-i-running\"\u003eWhat am I running?\u003c/h2\u003e\n\u003cp\u003eVMS:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epfSense\u003c/li\u003e\n\u003cli\u003eNTP Server\u003c/li\u003e\n\u003cli\u003eFreeIPA\u003c/li\u003e\n\u003cli\u003eAnsible\u003c/li\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003cli\u003eHomeBridge\u003c/li\u003e\n\u003cli\u003ePlex\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eContainers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAuthelia\u003c/li\u003e\n\u003cli\u003eDashy\u003c/li\u003e\n\u003cli\u003eFail2ban\u003c/li\u003e\n\u003cli\u003eGuacamole\u003c/li\u003e\n\u003cli\u003eKanboard\u003c/li\u003e\n\u003cli\u003eMariadb\u003c/li\u003e\n\u003cli\u003eMatomo\u003c/li\u003e\n\u003cli\u003eNginx Proxy Manager\u003c/li\u003e\n\u003cli\u003eOpenSpeedTest\u003c/li\u003e\n\u003cli\u003eOverseerr\u003c/li\u003e\n\u003cli\u003ePortioner\u003c/li\u003e\n\u003cli\u003eProwlarr\u003c/li\u003e\n\u003cli\u003eRadarr\u003c/li\u003e\n\u003cli\u003eRedis\u003c/li\u003e\n\u003cli\u003eSonarr\u003c/li\u003e\n\u003cli\u003eTransmission\u003c/li\u003e\n\u003cli\u003eUptime Kuma\u003c/li\u003e\n\u003cli\u003eWatchtower\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"diagram\"\u003eDiagram\u003c/h2\u003e\n\u003cp\u003eI will post a diagram here :)\u003c/p\u003e\n","description":"My homelab!","image":"images/homelab.webp","permalink":"https://kovasky.me/blogs/homelab/","title":"Homelab"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAfter tirelessly looking for a solution in order to dynamically create a whitelist for Suricata based on DNS, I decided to create my own.\u003c/p\u003e\n\u003ch2 id=\"download-the-necessary-files\"\u003eDownload the necessary files\u003c/h2\u003e\n\u003cp\u003eCreate a whitelist file with all the domains you wish whitelisted. A useful starting point is \u003ca href=\"https://github.com/anudeepND/whitelist\"\u003eanudeepND\u0026rsquo;s collection of commonly white listed domains\u003c/a\u003e. After that, download my \u003ca href=\"https://github.com/kovasky/homelabscripts/blob/main/pfSense/suricata/generateRules.py\"\u003egenerateRules.py\u003c/a\u003e script.\u003c/p\u003e\n\u003cp\u003ePlace these files in a directory of your choice on your pfSense host. For simplicity, I just placed them in /root. Finally, make the script executable by \u003ccode\u003echmod +x ./generateRules.py\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"modifying-suricatainc\"\u003eModifying suricata.inc\u003c/h2\u003e\n\u003cp\u003eNavigate to \u003ccode\u003e/usr/local/pkg/suricata/\u003c/code\u003e and using a text editor open \u003ccode\u003esuricata_defs.inc\u003c/code\u003e. Make the following modifications:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-php\" data-lang=\"php\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edefined\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;SURICATA_DEFAULT_RULES\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#a6e22e\"\u003edefine\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;SURICATA_DEFAULT_RULES\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003earray\u003c/span\u003e( \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;whitelist.rules\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;app-layer-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;decoder-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dhcp-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dnp3-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dns-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;files.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http2-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ipsec-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;kerberos-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;modbus-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mqtt-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;nfs-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ntp-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;smb-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;smtp-events.rules\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ssh-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;stream-events.rules\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tls-events.rules\u0026#34;\u003c/span\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe first element in the array will be our generated \u003ccode\u003ewhitelist.rules\u003c/code\u003e. This file can be named as you wish and it will appear as so in the web gui.\u003c/p\u003e\n\u003ch2 id=\"running-the-script\"\u003eRunning the script\u003c/h2\u003e\n\u003cp\u003eRun the script with the path to the dns whitelist as well as where you want the output file. For example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e./generateRules.py /root/dns_list.txt /root/whitelist.rules\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce the script has finished, you can copy/move it to \u003ccode\u003e/usr/local/share/suricata/rules/\u003c/code\u003e. If you open the Suricata web gui and select your interface, the new ruleset should appear. If not, you can try running \u003ccode\u003esuricata-update\u003c/code\u003e in terminal.\u003c/p\u003e\n\u003ch2 id=\"automating-the-generation-of-rules\"\u003eAutomating the generation of rules\u003c/h2\u003e\n\u003cp\u003eSince the IPs can change for any given domain, an easy way to update them would be to set up a cron job. Mine looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e * * * /root/update_rules.py /root/dns_list.txt /root/whitelist.rules\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e35\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e * * * mv /root/whitelist.rules /usr/local/share/suricata/rules/whitelist.rules \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e suricata-update\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter these steps are done, you are good to go and your domains will be whitelisted.\u003c/p\u003e\n","description":"Add a dns whitelist for Suricata in pfSense.","image":"images/suricata.webp","permalink":"https://kovasky.me/blogs/whitelist/","title":"Whitelisting in Suricata Package for pfSense"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eWhile setting up my hosts with FreeIPA, I noticed that home directories were not being created when logging in through ssh. Looking online it seems that most people just use NFS shares to keep home directories the same across devices but I did not want to set up NFS home shares. Fixing this in RHEL-based distros is easy with authconfig but debian-based distros do not come with this. To fix this in debian-based distros is as easy as modiyfing the pam.d config file.\u003c/p\u003e\n\u003ch2 id=\"modify-sshd-and-reload-pam\"\u003eModify sshd and reload pam\u003c/h2\u003e\n\u003cp\u003eOpen /etc/pam.d/sshd with your favourite text editor and add the following line:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esession required pam_mkhomedir.so skel\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/etc/skel/ umask\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0022\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this, no reload should be necessary but just in case we execute the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo pam-auth-update --force --package\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter following these steps, our host should automatically create a home directory when logging in through ssh using FreeIPA credentials.\u003c/p\u003e\n","description":"Auto create a local home directory in FreeIPA enrolled hosts.","image":"images/freeipa_home.webp","permalink":"https://kovasky.me/blogs/homecreation/","title":"Automatically create local home directory when logging in with FreeIPA"},{"content":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eI wanted to easily synchronize the time between my VMs and decided to set up an ntp server to accomplish this. Since a USB GPS device is relatively inexpensive, I thought it would be a great addition to the project.\u003c/p\u003e\n\u003cp\u003eFor the following examples, I used aptitude and vim.\u003c/p\u003e\n\u003ch2 id=\"prerequisite-packages\"\u003ePrerequisite Packages\u003c/h2\u003e\n\u003cp\u003eRun the following command to ensure we have the necessary packages:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt-get install gpsd gpsd-clients chrony\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"check-dev-for-gps\"\u003eCheck /dev for GPS\u003c/h2\u003e\n\u003cp\u003eOnce the gps is connected to the pc, we need to figure out the assigned device. This can be any of /dev/ttyUSB0, /dev/ttyACM0 or /dev/ttyAMA0.\u003c/p\u003e\n\u003cp\u003eIf unsure of which device it is, we can always run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecat /dev/$device\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe should be able to see a stream with coordinates and strings like \u0026ldquo;GPGGA\u0026rdquo; and \u0026ldquo;GPGSA\u0026rdquo;.\u003c/p\u003e\n\u003ch2 id=\"modify-gpsdconf-and-start-the-service\"\u003eModify gpsd.conf and start the service\u003c/h2\u003e\n\u003cp\u003eAfter getting the correct device, we will need to modify the configuration file located at \u0026ldquo;/etc/default/gpsd\u0026rdquo;. It should contain the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSTART_DAEMON\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUSBAUTO\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDEVICES\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/dev/ttyACM0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGPSD_OPTIONS\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;-n\u0026#34;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this we should enable and start the service:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl enable gpsd \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo systemctl start gpsd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"modify-chronyconf-and-start-the-service\"\u003eModify chrony.conf and start the service\u003c/h2\u003e\n\u003cp\u003eThe configuration file will either be in \u0026ldquo;/etc/chrony.conf\u0026rdquo; or \u0026ldquo;/etc/chrony/chrony.conf\u0026rdquo;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edriftfile /var/lib/chrony/chrony/drift\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eallow\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erefclock SHM \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e refid GPS precision 1e-1 offset 0.9999 delay 0.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erefclock SHM \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e refid PPS precision 1e-7\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter this we should enable and start the service:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo systemctl enable chronyd \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo systemctl start chronyd\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"checking-chrony-status\"\u003eChecking chrony status\u003c/h2\u003e\n\u003cp\u003eTheres a few things we can check to see if everything was set up correctly. To see if chrony takes in the gps data, we can run the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echronyc sources\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd to see if it is working as intended, we can run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echronyc tracking\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe output should look similar to the image at the top of this post.\u003c/p\u003e\n\u003ch2 id=\"done\"\u003eDone!\u003c/h2\u003e\n\u003cp\u003eAfter following these steps, we should have a working ntp server and all that is left is to point any client to the ip of the host running chrony.\u003c/p\u003e\n","description":"Set up an NTP server to keep hosts synchronized.","image":"images/chrony.webp","permalink":"https://kovasky.me/blogs/chronyd/","title":"NTP server with GPS and chrony"}]