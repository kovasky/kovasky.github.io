<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta http-equiv=accept-ch content="DPR, Viewport-Width, Width"><link rel=icon href=/fav.ico type=image/gif><link rel=apple-touch-icon href=/fav.png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><meta property="og:title" content="iDRAC 9 manual fan control on Dell PowerEdge servers"><meta property="og:description" content="iDRAC 9 manual fan control on Dell PowerEdge servers"><meta property="og:type" content="article"><meta property="og:url" content="https://kovasky.me/blogs/fan_control/"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2024-04-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-15T00:00:00+00:00"><meta property="og:site_name" content="Kovasky Buezo | Software Developer, Cybersecurity Enthusiast"><meta name=twitter:card content="summary"><meta name=twitter:title content="iDRAC 9 manual fan control on Dell PowerEdge servers"><meta name=twitter:description content="iDRAC 9 manual fan control on Dell PowerEdge servers"><link rel=stylesheet href=/bootstrap-5/css/bootstrap.min.css media=all><link rel=stylesheet href=https://kovasky.me/css/style.min.1dfda5296fa65beb8dd14a6f6b3f9be9be7891a13cc01e13114bf378f03edabc.css integrity="sha256-Hf2lKW+mW+uN0Upvaz+b6b54kaE8wB4TEUvzePA+2rw="><script src=https://kovasky.me/js/scripts.min.63cd948a67068774b66f61214f37a2c262c9b06ccebe6305578f06347f1e536e.js integrity="sha256-Y82UimcGh3S2b2EhTzeiwmLJsGzOvmMFV48GNH8eU24="></script>
<script src=https://kovasky.me/lazyimg/lazysizes/lazysizes.min.js async></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#eaedf0;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#18191a;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{font-size:1rem;font-weight:400;line-height:1.5;text-align:left}html{background-color:var(--background-color)!important}body::-webkit-scrollbar{height:0;width:8px;background-color:var(--background-color)}::-webkit-scrollbar-track{border-radius:1rem}::-webkit-scrollbar-thumb{border-radius:1rem;background:#b0b0b0;outline:1px solid var(--background-color)}#search-content::-webkit-scrollbar{width:.5em;height:.1em;background-color:var(--background-color)}</style><meta name=description content="iDRAC 9 manual fan control on Dell PowerEdge servers"><meta property="og:image" content="/images/blogs/fan_control/idrac.webp"><script defer src=/fontawesome-6/all-6.4.2.js></script><title>iDRAC 9 manual fan control on Dell PowerEdge servers</title></head><body class="light dark"><script>let localStorageValue=localStorage.getItem("pref-theme"),mediaQuery=window.matchMedia("(prefers-color-scheme: dark)").matches;switch(localStorageValue){case"dark":document.body.classList.add("dark");break;case"light":document.body.classList.remove("dark");break;default:mediaQuery&&document.body.classList.add("dark");break}</script><header id=profileHeader><nav class="pt-3 navbar navbar-expand-lg animate"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.ico width=30 height=30 class="d-inline-block align-top" alt=favicon>
Kovasky Buezo</a><div><input id=search autocomplete=off class="form-control mr-sm-2 d-none d-md-block" placeholder='Ctrl + k to Search...' aria-label=Search oninput=searchOnChange(event)></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text d-block d-md-none"><div class=nav-link><input id=search autocomplete=off class="form-control mr-sm-2" placeholder='Ctrl + k to Search...' aria-label=Search oninput=searchOnChange(event)></div></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About Me</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#experience aria-label=experience>Experience</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#achievements aria-label=achievements>Credentials</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Projects</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#education aria-label=education>Education</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#contact aria-label=contact>Contact</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li></ul></div></div></nav></header><div id=content><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><div class="title mb-5"><h1 class="text-center mb-4">iDRAC 9 manual fan control on Dell PowerEdge servers</h1><div class=text-center>Kovasky Buezo
<small>|</small>
Apr 15, 2024
<span id=readingTime>min read</span></div><div class=text-center><p>edited on: May 17, 2024</p></div></div><div class=featured-image><img class="img-fluid mx-auto d-block" src=/images/blogs/fan_control/idrac.webp alt="iDRAC 9 manual fan control on Dell PowerEdge servers"></div><article class="page-content p-2"><h2 id=intro>Intro</h2><p>I recently acquired a Dell Poweredge T440, and after installing a GPU the fans skyrocketed. This turned the server into a noise machine. To solve this, I created a script that disables third-party PCI mode and based on a threshold, set the fan speed to 20% or to be controlled by Dell&rsquo;s fan profile. These are the steps I took to make my T440 silent again.</p><h2 id=downgrading-idrac-9-firmware-to-3303030>Downgrading iDRAC 9 firmware to 3.30.30.30</h2><p>For this whole setup to work, iDRAC needs to be on firmware 3.30.30.30, as later firmware revisions remove the ability to control the fan speed. The firmware can be downloaded from <a href=https://www.dell.com/support/home/en-us>Dell&rsquo;s website</a>. To downgrade, navigate to your iDRAC&rsquo;s web admin page, and under Maintenance->System Update you can apply the downgrade. After the downgrade, make sure IPMI over LAN is enabled under iDRAC Settings->Connectivity->Network->IPMI Settings.</p><h2 id=script-to-control-the-fan-speed>Script to control the fan speed</h2><p>Once iDRAC is on firmware 3.30.30.30 and you can use IPMI over LAN, you can start using my script to control the fan speed. My script first checks that a VM has been up for 60 seconds. I added this check as PfSense is virtualized in my lab and as such needs to wait for it to be up to issue LAN commands. You can remove this check and the script will work as intended. Before running, make sure to fill in the blanks.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>check_start_time<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    local start_time<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local current_time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%s<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    local time_diff<span style=color:#f92672>=</span><span style=color:#66d9ef>$((</span>current_time <span style=color:#f92672>-</span> start_time<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $time_diff -ge <span style=color:#ae81ff>60</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>check_temperature<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    temp_lines<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ipmitool -I lanplus -H <span style=color:#e6db74>&#34;</span>$HOST<span style=color:#e6db74>&#34;</span> -U <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>&#34;</span> -P <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> sdr type temperature 2&gt;/dev/null | grep -e degrees | awk <span style=color:#e6db74>&#39;{print $(NF-2)}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    temp_arr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    readarray -t temp_arr <span style=color:#f92672>&lt;&lt;&lt;</span> <span style=color:#e6db74>&#34;</span>$temp_lines<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    sorted_temps<span style=color:#f92672>=(</span><span style=color:#66d9ef>$(</span>printf <span style=color:#e6db74>&#34;%s\n&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>temp_arr[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> | sort -nr<span style=color:#66d9ef>)</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    max_temp<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>sorted_temps[0]<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$max_temp<span style=color:#e6db74>&#34;</span> -le <span style=color:#ae81ff>60</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$CURRENT_PROFILE<span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;MANUAL&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># enable manual fan control</span>
</span></span><span style=display:flex><span>        ipmitool -I lanplus -H <span style=color:#e6db74>&#34;</span>$HOST<span style=color:#e6db74>&#34;</span> -U <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>&#34;</span> -P <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> raw 0x30 0x30 0x01 0x00 &amp;&gt; /dev/null
</span></span><span style=display:flex><span>        <span style=color:#75715e># set initial fan to 20%</span>
</span></span><span style=display:flex><span>        ipmitool -I lanplus -H <span style=color:#e6db74>&#34;</span>$HOST<span style=color:#e6db74>&#34;</span> -U <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>&#34;</span> -P <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> raw 0x30 0x30 0x02 0xff 0x14 &amp;&gt; /dev/null
</span></span><span style=display:flex><span>        LOW_TO_HIGH<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>        CURRENT_PROFILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MANUAL&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$max_temp<span style=color:#e6db74>&#34;</span> -le <span style=color:#ae81ff>65</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$CURRENT_PROFILE<span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;MANUAL2&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># enable manual fan control</span>
</span></span><span style=display:flex><span>        ipmitool -I lanplus -H <span style=color:#e6db74>&#34;</span>$HOST<span style=color:#e6db74>&#34;</span> -U <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>&#34;</span> -P <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> raw 0x30 0x30 0x01 0x00 &amp;&gt; /dev/null
</span></span><span style=display:flex><span>        <span style=color:#75715e># set initial fan to 30%</span>
</span></span><span style=display:flex><span>        ipmitool -I lanplus -H <span style=color:#e6db74>&#34;</span>$HOST<span style=color:#e6db74>&#34;</span> -U <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>&#34;</span> -P <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> raw 0x30 0x30 0x02 0xff 0x1e &amp;&gt; /dev/null
</span></span><span style=display:flex><span>        <span style=color:#75715e># set low_to_high used to determine wait time</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$CURRENT_PROFILE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;MANUAL&#34;</span><span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span> 
</span></span><span style=display:flex><span>            LOW_TO_HIGH<span style=color:#f92672>=</span>true 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            LOW_TO_HIGH<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span> 
</span></span><span style=display:flex><span>        CURRENT_PROFILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MANUAL2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$max_temp<span style=color:#e6db74>&#34;</span> -gt <span style=color:#ae81ff>65</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$CURRENT_PROFILE<span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;AUTO&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># enable Dell fan control</span>
</span></span><span style=display:flex><span>        ipmitool -I lanplus -H <span style=color:#e6db74>&#34;</span>$HOST<span style=color:#e6db74>&#34;</span> -U <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>&#34;</span> -P <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> raw 0x30 0x30 0x01 0x01 &amp;&gt; /dev/null
</span></span><span style=display:flex><span>        <span style=color:#75715e># set low_to_high used to determine wait time</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$CURRENT_PROFILE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;MANUAL2&#34;</span><span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span> 
</span></span><span style=display:flex><span>            LOW_TO_HIGH<span style=color:#f92672>=</span>true 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            LOW_TO_HIGH<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span> 
</span></span><span style=display:flex><span>        CURRENT_PROFILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;AUTO&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>disable_third_party_mode <span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># disable 3rd party pcie fan mode</span>
</span></span><span style=display:flex><span>    output<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>sshpass -p <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> ssh -o StrictHostKeyChecking<span style=color:#f92672>=</span>no <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>@</span>$HOST<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;racadm get system.pcieslotlfm&#34;</span> 2&gt;/dev/null<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    pcie_ports_count<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span>$output<span style=color:#e6db74>&#34;</span> | grep -c <span style=color:#e6db74>&#39;System.pcieslotlfm&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Iterate through each PCIe port and disable third party mode</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>((</span>i<span style=color:#f92672>=</span>1; i&lt;<span style=color:#f92672>=</span>pcie_ports_count; i++<span style=color:#f92672>))</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        sshpass -p <span style=color:#e6db74>&#34;</span>$PASS<span style=color:#e6db74>&#34;</span> ssh -o StrictHostKeyChecking<span style=color:#f92672>=</span>no <span style=color:#e6db74>&#34;</span>$USER<span style=color:#e6db74>@</span>$HOST<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;racadm set system.pcieslotlfm.</span>$i<span style=color:#e6db74>.lfmmode disabled&#34;</span> &amp;&gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HOST<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>USER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>PASS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>VMID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>CURRENT_PROFILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>LOW_TO_HIGH<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>start_time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ps -o lstart<span style=color:#f92672>=</span> -p <span style=color:#66d9ef>$(</span>cat /var/run/qemu-server/$VMID.pid<span style=color:#66d9ef>))</span>
</span></span><span style=display:flex><span>start_time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date -d <span style=color:#e6db74>&#34;</span>$start_time<span style=color:#e6db74>&#34;</span> +%s<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#f92672>[[</span> <span style=color:#66d9ef>$(</span>check_start_time <span style=color:#e6db74>&#34;</span>$start_time<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span> -eq <span style=color:#ae81ff>1</span> <span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>disable_third_party_mode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    check_temperature
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$CURRENT_PROFILE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;AUTO&#34;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;</span>$LOW_TO_HIGH<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> true<span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span> 
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>180</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> 
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>60</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span></span></span></code></pre></div><h2 id=automating-the-launching-of-the-script>Automating the launching of the script</h2><p>Instead of manually running this every time my server reboots, I created a service. To do so, I used the following service file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Description<span style=color:#f92672>=</span>User defined temperature fan control <span style=color:#66d9ef>for</span> iDrac <span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Type<span style=color:#f92672>=</span>simple
</span></span><span style=display:flex><span>ExecStart<span style=color:#f92672>=</span>/usr/local/sbin/fan_control.sh
</span></span><span style=display:flex><span>Restart<span style=color:#f92672>=</span>always
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>WantedBy<span style=color:#f92672>=</span>multi-user.target</span></span></code></pre></div><p>On my Proxmox install, the bash script is placed at /usr/local/sbin/fan_control.sh with the appropriate permissions and the service file is at /etc/systemd/system. After these files are created, it takes a &ldquo;systemctl daemon-reload&rdquo; and then a &ldquo;systemctl enable fan_control&rdquo; to start the service and make sure it starts every reboot.</p><h2 id=done>Done!</h2><p>Once everything is set up, your Dell server with iDRAC 9 should be extremely quiet.</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div id=stickySideBar class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#downgrading-idrac-9-firmware-to-3303030>Downgrading iDRAC 9 firmware to 3.30.30.30</a></li><li><a href=#script-to-control-the-fan-speed>Script to control the fan speed</a></li><li><a href=#automating-the-launching-of-the-script>Automating the launching of the script</a></li><li><a href=#done>Done!</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://kovasky.me/tags/dell target=_blank>Dell</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/idrac target=_blank>iDRAC</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/poweredge target=_blank>Poweredge</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/linux target=_blank>Linux</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/proxmox target=_blank>Proxmox</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/bash target=_blank>Bash</a></li></ul></aside><aside class=social><h5>Social</h5><div class=social-content><ul class=list-inline><li class="list-inline-item text-center"><a target=_blank href="https://twitter.com/share?text=iDRAC%209%20manual%20fan%20control%20on%20Dell%20PowerEdge%20servers&url=https%3a%2f%2fkovasky.me%2fblogs%2ffan_control%2f"><i class="fab fa-twitter"></i></a></li><li class="list-inline-item text-center"><a target=_blank href="https://api.whatsapp.com/send?text=iDRAC%209%20manual%20fan%20control%20on%20Dell%20PowerEdge%20servers: https%3a%2f%2fkovasky.me%2fblogs%2ffan_control%2f"><i class="fab fa-whatsapp"></i></a></li><li class="list-inline-item text-center"><a target=_blank href='mailto:?subject=iDRAC%209%20manual%20fan%20control%20on%20Dell%20PowerEdge%20servers&amp;body=Check%20out%20this%20site https%3a%2f%2fkovasky.me%2fblogs%2ffan_control%2f'><i class="fa fa-envelope"></i></a></li></ul></div></aside></div></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><div class=progress><div id=scroll-progress-bar class=progress-bar role=progressbar aria-valuenow=0 aria-valuemin=0 aria-valuemax=100></div></div><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}let stickySideBarElem=document.getElementById("stickySideBar"),stickyNavBar=!1;if(stickyNavBar){let e=document.getElementById("profileHeader"),t=e.offsetHeight+15;stickySideBarElem.style.top=t+"px"}else stickySideBarElem.style.top="50px"</script></div><footer><div class="container py-3" id=recent-posts><div class="h3 text-center text-secondary py-3">Recent Posts</div><div class="row justify-content-center"><div class="col-lg-4 col-md-6 pt-2"><div class="card h-100"><div class=card-header><a href=/blogs/no_consent/><img loading=lazy src=/images/blogs/no_consent/consent_form.webp class=card-img-top alt="Enable implicit consent for clients using Authelia OIDC"></a></div><div class="card-body bg-transparent p-3 shadow-sm"><a href=/blogs/no_consent/ class="primary-font card-title"><h5 class="card-title bg-transparent" title="Enable implicit consent for clients using Authelia OIDC">Enable implicit consent â€¦</h5></a><div class="card-text secondary-font"><p>Intro Enabling SSO for all self-hosted services that support it has been one of the best decisions in my homelab. It has created a seamless &ldquo;ecosystem&rdquo; experience for my friends and family (mainly myself ðŸ¥²). The problem is that every time I logged in to my services, it prompted me with a â€¦</p></div></div><div class="mt-auto card-footer"><span class=float-start>Jun 2, 2024</span>
<a href=/blogs/no_consent/ class="float-end btn btn-outline-info btn-sm">Read</a></div></div></div><div class="col-lg-4 col-md-6 pt-2"><div class="card h-100"><div class=card-header><a href=/blogs/plausible/><img loading=lazy src=/images/blogs/plausible/plausible_google.webp class=card-img-top alt="Set up Plausible Analytics Community Edition (self-hosted)"></a></div><div class="card-body bg-transparent p-3 shadow-sm"><a href=/blogs/plausible/ class="primary-font card-title"><h5 class="card-title bg-transparent" title="Set up Plausible Analytics Community Edition (self-hosted)">Set up Plausible â€¦</h5></a><div class="card-text secondary-font"><p>Intro In the search for an open-source Google Analytics alternative, two options stood out Matomo and Plausible. I wanted the tool to be privacy-friendly and that it did not require cookies, avoiding those pesky consent prompts. I did not find a straightforward guide to self-host Plausible with a â€¦</p></div></div><div class="mt-auto card-footer"><span class=float-start>May 13, 2024</span>
<a href=/blogs/plausible/ class="float-end btn btn-outline-info btn-sm">Read</a></div></div></div><div class="col-lg-4 col-md-6 pt-2"><div class="card h-100"><div class=card-header><a href=/blogs/get_outline/><img loading=lazy src=/images/blogs/get_outline/outline_wiki.webp class=card-img-top alt="Set up Outline Wiki with local object storage and OIDC integration"></a></div><div class="card-body bg-transparent p-3 shadow-sm"><a href=/blogs/get_outline/ class="primary-font card-title"><h5 class="card-title bg-transparent" title="Set up Outline Wiki with local object storage and OIDC integration">Set up Outline Wiki with â€¦</h5></a><div class="card-text secondary-font"><p>Intro I started using Notion&rsquo;s free tier as a knowledge bank for a side project. It&rsquo;s measley 1000 blocks were capped quickly and searching for an alternative lead to Outline. Outline is 100% free, selfhostable, and has a very similar featureset.
Most of the guides out there configure â€¦</p></div></div><div class="mt-auto card-footer"><span class=float-start>May 7, 2024</span>
<a href=/blogs/get_outline/ class="float-end btn btn-outline-info btn-sm">Read</a></div></div></div></div></div><div class="text-center pt-2"><span class=px-1><a href=https://github.com/kovasky aria-label=github><svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792"><path d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5T1376 1664h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5H416q-119 0-203.5-84.5T128 1376V416q0-119 84.5-203.5T416 128h960q119 0 203.5 84.5T1664 416z"/></svg></a></span><span class=px-1><a href=https://www.linkedin.com/in/kovaskybuezo/ aria-label=linkedin><svg xmlns="http://www.w3.org/2000/svg" width="2.4em" height="2.4em" fill="#fff" aria-label="LinkedIn" viewBox="0 0 512 512"><rect width="512" height="512" fill="#0077b5" rx="15%"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a></span></div><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center"><div class=pb-2><a href=https://kovasky.me title="Kovasky Buezo | Software Developer, Cybersecurity Enthusiast"><img alt="Footer logo" src=/fav.ico height=40px width=40px></a></div>&copy; 2024 All rights reserved<div class=text-secondary>Made with
<span class=text-danger>&#10084;</span></div></div></div></div></footer><script src=/bootstrap-5/js/bootstrap.bundle.min.js></script>
<script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script defer data-domain=kovasky.me src=https://plausible.agrajag.cloud/js/script.js></script><section id=search-content class=py-2><div class=container id=search-results></div></section></body></html>