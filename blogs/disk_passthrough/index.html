<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta http-equiv=accept-ch content="DPR, Viewport-Width, Width"><link rel=icon href=/fav.ico type=image/gif><link rel=apple-touch-icon href=/fav.png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><meta property="og:title" content="Disk passthrough for vms in Proxmox"><meta property="og:description" content="Disk passthrough for vms in Proxmox."><meta property="og:type" content="article"><meta property="og:url" content="https://kovasky.me/blogs/disk_passthrough/"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2024-04-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-04T00:00:00+00:00"><meta property="og:site_name" content="Kovasky Buezo | Software Developer, Cybersecurity Enthusiast"><meta name=twitter:card content="summary"><meta name=twitter:title content="Disk passthrough for vms in Proxmox"><meta name=twitter:description content="Disk passthrough for vms in Proxmox."><link rel=stylesheet href=/bootstrap-5/css/bootstrap.min.css media=all><link rel=stylesheet href=https://kovasky.me/css/style.min.1dfda5296fa65beb8dd14a6f6b3f9be9be7891a13cc01e13114bf378f03edabc.css integrity="sha256-Hf2lKW+mW+uN0Upvaz+b6b54kaE8wB4TEUvzePA+2rw="><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#eaedf0;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#18191a;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{font-size:1rem;font-weight:400;line-height:1.5;text-align:left}html{background-color:var(--background-color)!important}body::-webkit-scrollbar{height:0;width:8px;background-color:var(--background-color)}::-webkit-scrollbar-track{border-radius:1rem}::-webkit-scrollbar-thumb{border-radius:1rem;background:#b0b0b0;outline:1px solid var(--background-color)}#search-content::-webkit-scrollbar{width:.5em;height:.1em;background-color:var(--background-color)}</style><meta name=description content="Disk passthrough for vms in Proxmox."><link rel=stylesheet href=/css/single.css><script defer src=/fontawesome-6/all-6.4.2.js></script><title>Disk passthrough for vms in Proxmox | Kovasky Buezo | Software Developer, Cybersecurity Enthusiast</title></head><body class="light dark"><script>let localStorageValue=localStorage.getItem("pref-theme"),mediaQuery=window.matchMedia("(prefers-color-scheme: dark)").matches;switch(localStorageValue){case"dark":document.body.classList.add("dark");break;case"light":document.body.classList.remove("dark");break;default:mediaQuery&&document.body.classList.add("dark");break}</script><header id=profileHeader><nav class="pt-3 navbar navbar-expand-lg animate"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.ico width=30 height=30 class="d-inline-block align-top" alt=favicon>
Kovasky Buezo</a><div><input id=search autocomplete=off class="form-control mr-sm-2 d-none d-md-block" placeholder='Ctrl + k to Search...' aria-label=Search oninput=searchOnChange(event)></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text d-block d-md-none"><div class=nav-link><input id=search autocomplete=off class="form-control mr-sm-2" placeholder='Ctrl + k to Search...' aria-label=Search oninput=searchOnChange(event)></div></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About Me</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#experience aria-label=experience>Experience</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#achievements aria-label=achievements>Credentials</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Projects</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#education aria-label=education>Education</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#contact aria-label=contact>Contact</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li></ul></div></div></nav></header><div id=content><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><div class="title mb-5"><h1 class="text-center mb-4">Disk passthrough for vms in Proxmox</h1><div class=text-center>Kovasky Buezo
<small>|</small>
Apr 4, 2024
<span id=readingTime>min read</span></div><div class=text-center></div></div><div class=featured-image><img class="img-fluid mx-auto d-block" src=/images/blogs/truenas_disk.webp alt="Disk passthrough for vms in Proxmox"></div><article class="page-content p-2"><h2 id=intro>Intro</h2><p>It has always been recommended to give ZFS full disk control, so after placing my raid card in HBA mode, I went ahead and gave full disk control to my TrueNAS vm.</p><h2 id=figuring-out-the-id-of-the-disk>Figuring out the id of the disk</h2><p>Typically, disks are labeled as /dev/sdX, but this can change when adding other drives or moving them around. To circumvent this, it is better to figure out the specific id of the disk to be passed through. To do this, execute the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lshw -class disk -class storage</span></span></code></pre></div><p>Write down the serial and then issue the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls /dev/disk/by-id/ | grep &lt;serial&gt;</span></span></code></pre></div><p>Write this down, as it will be needed for the passthrough.</p><h2 id=map-the-drive-to-the-vm>Map the drive to the vm</h2><p>After you&rsquo;ve found the id of the disk, you can issue the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>qm set &lt;vm_id&gt; -scsi&lt;disk_number&gt; /dev/disk/by-id/&lt;disk_id&gt;</span></span></code></pre></div><p>Navigate to /etc/pve/qemu-server. Locate your vm configuration by vm id and open the file for edition.</p><p>It should look something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span>scsi&lt;disk_number&gt;: /dev/disk/by-id/&lt;disk_id&gt;,size<span style=color:#f92672>=</span>&lt;disk_size&gt;
</span></span><span style=display:flex><span>...</span></span></code></pre></div><p>If left untouched and multiple disks are passed through, TrueNAS will complain about duplicate serials. To fix this, you have to add the serial option. It should now look like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span>scsi&lt;disk_number&gt;: /dev/disk/by-id/&lt;disk_id&gt;,serial<span style=color:#f92672>=</span>&lt;serial&gt;,size<span style=color:#f92672>=</span>&lt;disk_size&gt;
</span></span><span style=display:flex><span>...</span></span></code></pre></div><p>This will now passthrough the disk with a unique serial.</p><h2 id=done>Done!</h2><p>Reboot the vm and the disk should appear.</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div id=stickySideBar class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#figuring-out-the-id-of-the-disk>Figuring out the id of the disk</a></li><li><a href=#map-the-drive-to-the-vm>Map the drive to the vm</a></li><li><a href=#done>Done!</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://kovasky.me/tags/proxmox target=_blank>Proxmox</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/linux target=_blank>Linux</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/passthrough target=_blank>Passthrough</a></li><li class=list-inline-item><a href=https://kovasky.me/tags/truenas target=_blank>TrueNas</a></li></ul></aside><aside class=social><h5>Social</h5><div class=social-content><ul class=list-inline><li class="list-inline-item text-center"><a target=_blank href="https://twitter.com/share?text=Disk%20passthrough%20for%20vms%20in%20Proxmox&url=https%3a%2f%2fkovasky.me%2fblogs%2fdisk_passthrough%2f"><i class="fab fa-twitter"></i></a></li><li class="list-inline-item text-center"><a target=_blank href="https://api.whatsapp.com/send?text=Disk%20passthrough%20for%20vms%20in%20Proxmox: https%3a%2f%2fkovasky.me%2fblogs%2fdisk_passthrough%2f"><i class="fab fa-whatsapp"></i></a></li><li class="list-inline-item text-center"><a target=_blank href='mailto:?subject=Disk%20passthrough%20for%20vms%20in%20Proxmox&amp;body=Check%20out%20this%20site https%3a%2f%2fkovasky.me%2fblogs%2fdisk_passthrough%2f'><i class="fa fa-envelope"></i></a></li></ul></div></aside></div></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><div class=progress><div id=scroll-progress-bar class=progress-bar role=progressbar aria-valuenow=0 aria-valuemin=0 aria-valuemax=100></div></div><script src=/js/scrollProgressBar.js></script>
<script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}let stickySideBarElem=document.getElementById("stickySideBar"),stickyNavBar=!1;if(stickyNavBar){let e=document.getElementById("profileHeader"),t=e.offsetHeight+15;stickySideBarElem.style.top=t+"px"}else stickySideBarElem.style.top="50px"</script><script src=/js/readingTime.js></script></div><footer><div class="container py-3" id=recent-posts><div class="h3 text-center text-secondary py-3">Recent Posts</div><div class="row justify-content-center"><div class="col-lg-4 col-md-6 pt-2"><div class="card h-100"><div class=card-header><a href=/blogs/get_outline/><img loading=lazy src=/images/blogs/outline_wiki.webp class=card-img-top alt="Set up Outline Wiki with local object storage and OIDC integration"></a></div><div class="card-body bg-transparent p-3 shadow-sm"><a href=/blogs/get_outline/ class="primary-font card-title"><h5 class="card-title bg-transparent" title="Set up Outline Wiki with local object storage and OIDC integration">Set up Outline Wiki with …</h5></a><div class="card-text secondary-font"><p>Intro I started using Notion&rsquo;s free tier as a knowledge bank for a side project. It&rsquo;s measley 1000 blocks were capped quickly and searching for an alternative lead to Outline. Outline is 100% free, selfhostable, and has a very similar featureset.
Most of the guides out there configure …</p></div></div><div class="mt-auto card-footer"><span class=float-start>May 7, 2024</span>
<a href=/blogs/get_outline/ class="float-end btn btn-outline-info btn-sm">Read</a></div></div></div><div class="col-lg-4 col-md-6 pt-2"><div class="card h-100"><div class=card-header><a href=/blogs/plex_ramdisk/><img loading=lazy src=/images/blogs/plex_ramdisk.webp class=card-img-top alt="Set up a ramdisk for Plex"></a></div><div class="card-body bg-transparent p-3 shadow-sm"><a href=/blogs/plex_ramdisk/ class="primary-font card-title"><h5 class="card-title bg-transparent" title="Set up a ramdisk for Plex">Set up a ramdisk for Plex</h5></a><div class="card-text secondary-font"><p>Intro Always on the lookout to decrease writes on my consumer SSDs, I stumbled upon the idea of a ramdisk for Plex transcodes. In theory it should offer a performance boost, but in practice I did not really notice any improvements besides lowering SSD writes.
Editing fstab Navigate to /etc/fstab and …</p></div></div><div class="mt-auto card-footer"><span class=float-start>May 1, 2024</span>
<a href=/blogs/plex_ramdisk/ class="float-end btn btn-outline-info btn-sm">Read</a></div></div></div><div class="col-lg-4 col-md-6 pt-2"><div class="card h-100"><div class=card-header><a href=/blogs/fan_control/><img loading=lazy src=/images/blogs/idrac.webp class=card-img-top alt="iDRAC 9 manual fan control on Dell PowerEdge servers"></a></div><div class="card-body bg-transparent p-3 shadow-sm"><a href=/blogs/fan_control/ class="primary-font card-title"><h5 class="card-title bg-transparent" title="iDRAC 9 manual fan control on Dell PowerEdge servers">iDRAC 9 manual fan …</h5></a><div class="card-text secondary-font"><p>Intro I recently acquired a Dell Poweredge T440, and after installing a GPU the fans skyrocketed. This turned the server into a noise machine. To solve this, I created a script that disables third-party PCI mode and based on a threshold, set the fan speed to 20% or to be controlled by Dell&rsquo;s …</p></div></div><div class="mt-auto card-footer"><span class=float-start>Apr 15, 2024</span>
<a href=/blogs/fan_control/ class="float-end btn btn-outline-info btn-sm">Read</a></div></div></div></div></div><div class="text-center pt-2"><span class=px-1><a href=https://github.com/kovasky aria-label=github><svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792"><path d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5T1376 1664h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105T1386 856q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27T578 459.5 492 446q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5T484 1274q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5H416q-119 0-203.5-84.5T128 1376V416q0-119 84.5-203.5T416 128h960q119 0 203.5 84.5T1664 416z"/></svg></a></span><span class=px-1><a href=https://www.linkedin.com/in/kovaskybuezo/ aria-label=linkedin><svg xmlns="http://www.w3.org/2000/svg" width="2.4em" height="2.4em" fill="#fff" aria-label="LinkedIn" viewBox="0 0 512 512"><rect width="512" height="512" fill="#0077b5" rx="15%"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a></span></div><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center"><div class=pb-2><a href=https://kovasky.me title="Kovasky Buezo | Software Developer, Cybersecurity Enthusiast"><img alt="Footer logo" src=/fav.ico height=40px width=40px></a></div>&copy; 2024 All rights reserved<div class=text-secondary>Made with
<span class=text-danger>&#10084;</span></div></div></div></div></footer><script src=/bootstrap-5/js/bootstrap.bundle.min.js></script>
<script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script src=/js/search.js></script><section id=search-content class=py-2><div class=container id=search-results></div></section></body></html>